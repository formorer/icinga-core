<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Icinga Plugins</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.75.1">
<meta name="keywords" content="Supervision, Icinga, Nagios, Linux">
<link rel="home" href="index.html" title="Icinga Version 1.3 Documentation">
<link rel="up" href="ch05.html" title="Chapter 5. The Basics">
<link rel="prev" href="ch05.html" title="Chapter 5. The Basics">
<link rel="next" href="macros.html" title="Understanding Macros and How They Work">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<CENTER><IMG src="../images/logofullsize.png" border="0" alt="Icinga" title="Icinga"></CENTER>
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Icinga Plugins</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch05.html">Prev</a> </td>
<th width="60%" align="center">Chapter 5. The Basics</th>
<td width="20%" align="right"> <a accesskey="n" href="macros.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="section" title="Icinga Plugins">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="plugins"></a><a name="Icinga_plugins"></a>Icinga Plugins</h2></div></div></div>
  

  <p><span class="bold"><strong>Introduction</strong></span></p>

  <p>Unlike many other monitoring tools, Icinga does not include any internal mechanisms for checking the status of hosts and
  services on your network. Instead, Icinga relies on external programs (called plugins) to do all the dirty work.</p>

  <p><span class="bold"><strong>What Are Plugins?</strong></span></p>

  <p>Plugins are compiled executables or scripts (Perl scripts, shell scripts, etc.) that can be run from a command line to check the
  status or a host or service. Icinga uses the results from plugins to determine the current status of hosts and services on your
  network.</p>

  <p>Icinga will execute a plugin whenever there is a need to check the status of a service or host. The plugin does
  <span class="emphasis"><em>something</em></span> (notice the very general term) to perform the check and then simply returns the results to Icinga.
  Icinga will process the results that it receives from the plugin and take any necessary actions (running <a class="link" href="eventhandlers.html" title="Event Handlers">event handlers</a>, sending out <a class="link" href="notifications.html" title="Notifications">notifications</a>, etc).</p>

  <p><span class="bold"><strong>Plugins As An Abstraction Layer</strong></span></p>

  <p><span class="inlinemediaobject"><img src="../images/plugins.png"></span></p>

  <p>Plugins act as an abstraction layer between the monitoring logic present in the Icinga daemon and the actual services and
  hosts that are being monitored.</p>

  <p>The upside of this type of plugin architecture is that you can monitor just about anything you can think of. If you can automate the
  process of checking something, you can monitor it with Icinga. There are already a lot of plugins that have been created in order
  to monitor basic resources such as processor load, disk usage, ping rates, etc. If you want to monitor something else, take a look at the
  documentation on <a class="link" href="pluginapi.html" title="Icinga Plugin API">writing plugins</a> and roll your own. Its simple!</p>

  <p>The downside to this type of plugin architecture is the fact that Icinga has absolutely no idea what it is that you're
  monitoring. You could be monitoring network traffic statistics, data error rates, room temperate, CPU voltage, fan speed, processor load,
  disk space, or the ability of your super-fantastic toaster to properly brown your bread in the morning... Icinga doesn't understand
  the specifics of what's being monitored - it just tracks changes in the <span class="emphasis"><em>state</em></span> of those resources. Only the plugins
  themselves know exactly what they're monitoring and how to perform the actual checks.</p>

  <p><span class="bold"><strong>What Plugins Are Available?</strong></span></p>

  <p>There are plugins currently available to monitor many different kinds of devices and services, including:</p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>HTTP, POP3, IMAP, FTP, SSH, DHCP</p>
    </li>
<li class="listitem">
      <p>CPU Load, Disk Usage, Memory Usage, Current Users</p>
    </li>
<li class="listitem">
      <p>Unix/Linux, Windows, and Netware Servers</p>
    </li>
<li class="listitem">
      <p>Routers and Switches</p>
    </li>
<li class="listitem">
      <p>etc.</p>
    </li>
</ul></div>

  <p><span class="bold"><strong>Obtaining Plugins</strong></span></p>

  <p>Plugins are not distributed with Icinga, but you can download the official Nagios plugins and many additional plugins
  created and maintained by Nagios and Icinga users from the following locations:</p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>Nagios Plugins Project: <a class="link" href="http://nagiosplug.sourceforge.net/" target="_top">http://nagiosplug.sourceforge.net/</a></p>
    </li>
<li class="listitem">
      <p>Nagios Downloads Page: <a class="link" href="http://www.nagios.org/download/" target="_top">http://www.nagios.org/download/</a></p>
    </li>
<li class="listitem">
      <p>IcingaExchange.org: <a class="link" href="http://www.monitoringexchange.org" target="_top">http://www.monitoringexchange.org</a></p>
    </li>
</ul></div>

  <p><a name="plugins-howto"></a><span class="bold"><strong>How Do I Use Plugin X?</strong></span></p>

  <p>Most all plugins will display basic usage information when you execute them using '-h' or '--help' on the command line. For example,
  if you want to know how the check_http plugin works or what options it accepts, you should try executing the following command:</p>

  <pre class="screen"> ./check_http --help</pre>

  <a name="plugins-hints"></a>

  <div class="important" title="Important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="../images/important.png"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top">
    <p>Always execute the plugin using the Icinga user because some plugins will create temporary files. If you're testing plugins
    with another user then the Icinga user may not have the permissions to overwrite existing files.</p>

    <p>Don't call the plugin using relative paths (i.e <span class="emphasis"><em>./check_test_plugin</em></span>). Always use absolute paths because
    that's the way Icinga does it (i.e. <span class="emphasis"><em>/usr/local/icinga/libexec/check_test_plugin</em></span>).</p>
  </td></tr>
</table></div>

  <p><span class="bold"><strong>Integrating a new plugin</strong></span></p>

  <p>If you want to integrate a new plugin then please read the documentation (if any) before installing it. It may contain important
  information about the prerequisites like additional packages, (perl) modules and on how to install the plugin together with hints for your
  distribution.</p>

  <p>Sometimes you have to compile the plugin preparing the compile process using "./configure" with or without options. Please check the
  file config.log for errors regarding missing (devel) packages before issuing the actual compile command (mostly "make" or "make all"). In
  most cases the plugin is copied to the plugins directory (i.e. <span class="emphasis"><em>/usr/local/icinga/libexec</em></span>) during "make install".</p>

  <p>Sometimes you have to alter the plugin to reflect your environment (i.e. path to "utils.pm", ...). Normally you have to copy it
  manually to the plugins directory (i.e. <span class="emphasis"><em>/usr/local/icinga/libexec</em></span>).</p>

  <p>After the installation of the plugin call it from the command line using the appropriate options. If this works then you can
  integrate it into Icinga.</p>

  <p>Let's imagine you used the following call on the command line</p>

  <pre class="programlisting"> /usr/local/icinga/libexec/sample-plugin.pl -H 192.168.1.2 -a argument1 -p parameter -n 5</pre>

  <p>The command definition has to contain two directives</p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>command_name: this is a short name identifying the command, let's use <span class="emphasis"><em>check_sample</em></span></p>
    </li>
<li class="listitem">
      <p>command_line: here you define the command to execute. You can specify the command you executed on the command line but that
      would be very inflexible. Normally the plugin directory (/usr/local/icinga/libexec) remains the same so we can use a <a class="link" href="macrolist.html#macrolist-user">$USERn$</a> variable which is defined in resource.cfg. The IP-address changes from host to host. There is
      a macro called <a class="link" href="macrolist.html#macrolist-hostaddress">$HOSTADDRESS$</a> which we can use for that purpose. The value of the
      arguments may vary so these should be flexible, too. This may lead to the following definition:</p>
    </li>
</ul></div>

  <pre class="programlisting"> define command{ 
    command_name check_sample
    command_line $USER1$/sample-plugin.pl -H $HOSTADDRESS$ -a $ARG1$ -p $ARG2$ -n $ARG3$
    }</pre>

  <p>Then we have to define the check_command directive which is part of the host/service definition starting with the short name
  followed by the arguments separated by exclamation marks (!):</p>

  <pre class="programlisting"> check_command check_sample!argument1!parameter!5</pre>

  <p>As you can see the IP-address is not specified because it is taken from the host definition.</p>

  <p>Check the configuration using "/etc/init.d/icinga show-errors" and resolve any errors before issuing "/etc/init.d/icinga restart".
  Wait until the object is checked and look at the status details. There might be errors.</p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>"...resulted in a return code of 127"</p>

      <p>This means the plugin was not found at the specified location or that a file called from within the plugin was not found. If you
      use $USERn$ macros calling the plugin then make sure that the macro really points to the location where the plugin is (is the macro
      defined in resource.cfg?). Notification commands often call a mail program. Make sure that the path to the mail program is
      correct.</p>
    </li>
<li class="listitem">
      <p>"...resulted in a return code of 13"</p>

      <p>Mostly this indicates a permissions problem. The user might not be able to access / execute the plugin and/or other related
      files. This might happen if you tested a plugin as root which creates temporary files. The Icinga user is not allowed to
      overwrite these files.</p>
    </li>
</ul></div>

  <p><span class="bold"><strong>Plugin API</strong></span></p>

  <p>You can find information on the technical aspects of plugins, as well as how to go about creating your own custom plugins <a class="link" href="pluginapi.html" title="Icinga Plugin API">here</a>.</p>

  <a class="indexterm" name="id5031353"></a>

  <a class="indexterm" name="id5031373"></a>

  <a class="indexterm" name="id5031374"></a>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch05.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch05.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="macros.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 5. The Basics </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Understanding Macros and How They Work</td>
</tr>
</table>
</div>
<P class="copyright">© 2009-2011 Icinga Development Team, http://www.icinga.org</P>
</body>
</html>
