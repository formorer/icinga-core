<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Icinga-core: base/broker.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icinga_logo4-300x109.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Icinga-core&#160;<span id="projectnumber">1.4.0</span></div>
   <div id="projectbrief">next gen monitoring</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('broker_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">base/broker.c</div>  </div>
</div>
<div class="contents">
<a href="broker_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * BROKER.C - Event broker routines for Icinga</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (c) 2002-2008 Ethan Galstad (egalstad@nagios.org)</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (c) 2009-2011 Nagios Core Development Team and Community Contributors</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (c) 2009-2011 Icinga Development Team (http://www.icinga.org)</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * License:</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00012"></a>00012 <span class="comment"> * it under the terms of the GNU General Public License version 2 as</span>
<a name="l00013"></a>00013 <span class="comment"> * published by the Free Software Foundation.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00016"></a>00016 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00017"></a>00017 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00018"></a>00018 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00021"></a>00021 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00022"></a>00022 <span class="comment"> * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> *****************************************************************************/</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;../include/config.h&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;../include/common.h&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;../include/icinga.h&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;../include/broker.h&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;../include/nebcallbacks.h&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;../include/nebstructs.h&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;../include/nebmods.h&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a>;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="keyword">extern</span> time_t <a class="code" href="broker_8c.html#a2b5a4f2875a1a545f44ac2faad7a6b67">program_start</a>;
<a name="l00038"></a>00038 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#ad99d124d1c85c3b69de36466353f295e">nagios_pid</a>;
<a name="l00039"></a>00039 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#a4255d3efd1474d8e9d267e4b1559c1f9">daemon_mode</a>;
<a name="l00040"></a>00040 <span class="keyword">extern</span> time_t <a class="code" href="broker_8c.html#aeb85ffd1c5c7f91fe9ccb3e4f58584a2">last_command_check</a>;
<a name="l00041"></a>00041 <span class="keyword">extern</span> time_t <a class="code" href="broker_8c.html#aa087a80bdb1191f94e86f0a83d5c2eed">last_log_rotation</a>;
<a name="l00042"></a>00042 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#aeab76c66fa95f6b3a22143bade01cbe9">enable_notifications</a>;
<a name="l00043"></a>00043 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#ab7c771c65ac24bc0d04ddae988128f8a">execute_service_checks</a>;
<a name="l00044"></a>00044 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#ac2cfe61062d4e6db6236a829ee16864a">accept_passive_service_checks</a>;
<a name="l00045"></a>00045 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#af4ed1772a5decb43a2711b6d560a0737">execute_host_checks</a>;
<a name="l00046"></a>00046 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#a1f08a9399cbf8d1781f7921cb39ad461">accept_passive_host_checks</a>;
<a name="l00047"></a>00047 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#adf8bd6fb1b3fc3cf7750d887773feace">enable_event_handlers</a>;
<a name="l00048"></a>00048 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#a03e994eebc8f1e065991e7f8994a7059">obsess_over_services</a>;
<a name="l00049"></a>00049 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#a879982dc6cb9e3e1e23c49eba4f7bc12">obsess_over_hosts</a>;
<a name="l00050"></a>00050 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#a2dff02e57dcb9656ac523b8f6d548ee4">enable_flap_detection</a>;
<a name="l00051"></a>00051 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#ad9af8e808ce1df2c763d260502b58e4c">enable_failure_prediction</a>;
<a name="l00052"></a>00052 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#a3cef48503f834db51896cd2262c4ddbd">process_performance_data</a>;
<a name="l00053"></a>00053 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="broker_8c.html#a9586ccf6845ee26a92ae931feb52a467">aggregate_status_updates</a>;
<a name="l00054"></a>00054 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="broker_8c.html#a786e354f5a91ca30fe28ede97505e181">modified_host_process_attributes</a>;
<a name="l00055"></a>00055 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="broker_8c.html#aa128280b704d982e64c50a9427cf5f71">modified_service_process_attributes</a>;
<a name="l00056"></a>00056 <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="broker_8c.html#a2cd88e2da654d6d1d2c52e79d0174109">global_host_event_handler</a>;
<a name="l00057"></a>00057 <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="broker_8c.html#a0073f89db72fa9c3474b5a1327382784">global_service_event_handler</a>;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#ifdef USE_EVENT_BROKER</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">/******************************************************************/</span>
<a name="l00065"></a>00065 <span class="comment">/************************* EVENT FUNCTIONS ************************/</span>
<a name="l00066"></a>00066 <span class="comment">/******************************************************************/</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">/* sends program data (starts, restarts, stops, etc.) to broker */</span>
<a name="l00070"></a>00070 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#ac3b3a920cabd7e78a5edf10d5025e915">broker_program_state</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00071"></a>00071         <a class="code" href="structnebstruct__process__struct.html">nebstruct_process_data</a> ds;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a9a4d5ccb47a3165108b230870921ba89">BROKER_PROGRAM_STATE</a>))
<a name="l00074"></a>00074                 <span class="keywordflow">return</span>;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00077"></a>00077         ds.<a class="code" href="structnebstruct__process__struct.html#a14b5652c17edc10f1516360ae0f2786d">type</a>=type;
<a name="l00078"></a>00078         ds.<a class="code" href="structnebstruct__process__struct.html#a603574f3d3914b0ef0a485e89cbbdb11">flags</a>=flags;
<a name="l00079"></a>00079         ds.<a class="code" href="structnebstruct__process__struct.html#a2f539af2cbbda22940fdd70f1b9a26e0">attr</a>=attr;
<a name="l00080"></a>00080         ds.<a class="code" href="structnebstruct__process__struct.html#a670db0b51c0baa9d31df016ded99a045">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="comment">/* make callbacks */</span>
<a name="l00083"></a>00083         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#abf8e809ca321c5a124f74d7f05e33468">NEBCALLBACK_PROCESS_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="keywordflow">return</span>;
<a name="l00086"></a>00086         }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">/* send timed event data to broker */</span>
<a name="l00090"></a>00090 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a1496a9cc8f907d214c9d9f06b6e7314a">broker_timed_event</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structtimed__event__struct.html">timed_event</a> *event, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00091"></a>00091         <a class="code" href="structnebstruct__timed__event__struct.html">nebstruct_timed_event_data</a> ds;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#ae7714f52765b98563ab2214ace60e6e7">BROKER_TIMED_EVENTS</a>))
<a name="l00094"></a>00094                 <span class="keywordflow">return</span>;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <span class="keywordflow">if</span>(event==NULL)
<a name="l00097"></a>00097                 <span class="keywordflow">return</span>;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00100"></a>00100         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a4c6bfa2b23371b240ef0e91ce9561cc1">type</a>=type;
<a name="l00101"></a>00101         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a9fc4fb666c3b8a59a24f493377d0c189">flags</a>=flags;
<a name="l00102"></a>00102         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a6e21c7691b6c73ede1957178395ae80f">attr</a>=attr;
<a name="l00103"></a>00103         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a016fda90a2f765cbe6f472d11cfb9897">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a6b6058189b2b9f49fa4726185b8f61d0">event_type</a>=<span class="keyword">event</span>-&gt;event_type;
<a name="l00106"></a>00106         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a967c119dd6ec43593873662df8bde7da">recurring</a>=<span class="keyword">event</span>-&gt;recurring;
<a name="l00107"></a>00107         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a7cb1a14aa7dcdc7144f8ad828fa53e59">run_time</a>=<span class="keyword">event</span>-&gt;run_time;
<a name="l00108"></a>00108         ds.<a class="code" href="structnebstruct__timed__event__struct.html#aa8cab4effa39f12325fe7f6e44a0ef8f">event_data</a>=<span class="keyword">event</span>-&gt;event_data;
<a name="l00109"></a>00109         ds.<a class="code" href="structnebstruct__timed__event__struct.html#a6a20a187ebe8e9e61a054efbd448bc0b">event_ptr</a>=(<span class="keywordtype">void</span> *)event;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="comment">/* make callbacks */</span>
<a name="l00112"></a>00112         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a4013f4db3a05529e2e41d4d34ee9486f">NEBCALLBACK_TIMED_EVENT_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         <span class="keywordflow">return</span>;
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="comment">/* send log data to broker */</span>
<a name="l00120"></a>00120 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#aad879d0d3f4dc826a1012840c8c7fe0d">broker_log_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">char</span> *data, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> data_type, time_t entry_time, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00121"></a>00121         <a class="code" href="structnebstruct__log__struct.html">nebstruct_log_data</a> ds;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a0f87e06a8af5010fe9806d97f4cde04e">BROKER_LOGGED_DATA</a>))
<a name="l00124"></a>00124                 <span class="keywordflow">return</span>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00127"></a>00127         ds.<a class="code" href="structnebstruct__log__struct.html#ad1405eee271be2a2d5b637aa8ce2b1db">type</a>=type;
<a name="l00128"></a>00128         ds.<a class="code" href="structnebstruct__log__struct.html#a15a455a8ea3ba70816080c765fca0b84">flags</a>=flags;
<a name="l00129"></a>00129         ds.<a class="code" href="structnebstruct__log__struct.html#affee6ddd9963cd3823e15a2a6cfb9e1f">attr</a>=attr;
<a name="l00130"></a>00130         ds.<a class="code" href="structnebstruct__log__struct.html#a9cf2ba856653d3383d6ca9ac170a008c">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         ds.<a class="code" href="structnebstruct__log__struct.html#a93ffeafdbb0bf2735526ad6a61d7901a">entry_time</a>=entry_time;
<a name="l00133"></a>00133         ds.<a class="code" href="structnebstruct__log__struct.html#ad2e1dab8723a9b395b4eeab3cd33d605">data_type</a>=data_type;
<a name="l00134"></a>00134         ds.<a class="code" href="structnebstruct__log__struct.html#ad2c6a6e3933e0e412e43eeeab4ffe197">data</a>=data;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136         <span class="comment">/* make callbacks */</span>
<a name="l00137"></a>00137         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a42017187f8d50fac8bf165752fbaa7ac">NEBCALLBACK_LOG_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="keywordflow">return</span>;
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment">/* send system command data to broker */</span>
<a name="l00145"></a>00145 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#ae213b3f01554239ba25daa95b2af16f7">broker_system_command</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keyword">struct</span> timeval <a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>, <span class="keyword">struct</span> timeval <a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>, <span class="keywordtype">double</span> exectime, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> early_timeout, <span class="keywordtype">int</span> retcode, <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *output, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00146"></a>00146         <a class="code" href="structnebstruct__system__command__struct.html">nebstruct_system_command_data</a> ds;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a966053ef8a3c789b765d8fd94a760e6b">BROKER_SYSTEM_COMMANDS</a>))
<a name="l00149"></a>00149                 <span class="keywordflow">return</span>;
<a name="l00150"></a>00150         
<a name="l00151"></a>00151         <span class="keywordflow">if</span>(cmd==NULL)
<a name="l00152"></a>00152                 <span class="keywordflow">return</span>;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00155"></a>00155         ds.<a class="code" href="structnebstruct__system__command__struct.html#aa54ba27a286527e563b418722b62901c">type</a>=type;
<a name="l00156"></a>00156         ds.<a class="code" href="structnebstruct__system__command__struct.html#a879e3288a45af4e745981b34524ccdcf">flags</a>=flags;
<a name="l00157"></a>00157         ds.<a class="code" href="structnebstruct__system__command__struct.html#ad98038b13171324c53dc0200d6bb36d0">attr</a>=attr;
<a name="l00158"></a>00158         ds.<a class="code" href="structnebstruct__system__command__struct.html#a571e17505bd2260f92ec669619af510c">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         ds.<a class="code" href="structnebstruct__system__command__struct.html#aabd7905a54ec7a55939a6a9298498b35">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00161"></a>00161         ds.<a class="code" href="structnebstruct__system__command__struct.html#a4f9fec51aefe1144cec5cfdab9c6ecb6">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00162"></a>00162         ds.<a class="code" href="structnebstruct__system__command__struct.html#a491344d4ef516b046903ef16f03012bd">timeout</a>=timeout;
<a name="l00163"></a>00163         ds.<a class="code" href="structnebstruct__system__command__struct.html#a6258eee1c8480123df202edd80d3aefe">command_line</a>=cmd;
<a name="l00164"></a>00164         ds.<a class="code" href="structnebstruct__system__command__struct.html#ae22961332aa833a4981d504a4cca73b4">early_timeout</a>=early_timeout;
<a name="l00165"></a>00165         ds.<a class="code" href="structnebstruct__system__command__struct.html#a65c7ee0d31f81407a8d6c69cd0c32f7e">execution_time</a>=exectime;
<a name="l00166"></a>00166         ds.<a class="code" href="structnebstruct__system__command__struct.html#a4afe8f79bde1f22e3f310a88ced3a0a1">return_code</a>=retcode;
<a name="l00167"></a>00167         ds.<a class="code" href="structnebstruct__system__command__struct.html#a40bf309017dddebe69fa00a5be3b8a5a">output</a>=output;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         <span class="comment">/* make callbacks */</span>
<a name="l00170"></a>00170         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#ab56dffe6b7777c569611a4767e7ef707">NEBCALLBACK_SYSTEM_COMMAND_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         <span class="keywordflow">return</span>;
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">/* send event handler data to broker */</span>
<a name="l00178"></a>00178 <span class="keywordtype">int</span> <a class="code" href="broker_8h.html#a8d60c55ce026e4398632950c6856ae2c">broker_event_handler</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> eventhandler_type, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> state, <span class="keywordtype">int</span> state_type, <span class="keyword">struct</span> timeval start_time, <span class="keyword">struct</span> timeval end_time, <span class="keywordtype">double</span> exectime, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> early_timeout, <span class="keywordtype">int</span> retcode, <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *cmdline, <span class="keywordtype">char</span> *output, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00179"></a>00179         <a class="code" href="structservice__struct.html">service</a> *temp_service=NULL;
<a name="l00180"></a>00180         <a class="code" href="structhost__struct.html">host</a> *temp_host=NULL;
<a name="l00181"></a>00181         <span class="keywordtype">char</span> *command_buf=NULL;
<a name="l00182"></a>00182         <span class="keywordtype">char</span> *command_name=NULL;
<a name="l00183"></a>00183         <span class="keywordtype">char</span> *command_args=NULL;
<a name="l00184"></a>00184         <a class="code" href="structnebstruct__event__handler__struct.html">nebstruct_event_handler_data</a> ds;
<a name="l00185"></a>00185         <span class="keywordtype">int</span> return_code=<a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a6217243ea573480f3f3ba4236b6ad447">BROKER_EVENT_HANDLERS</a>))
<a name="l00188"></a>00188                 <span class="keywordflow">return</span> <a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00189"></a>00189         
<a name="l00190"></a>00190         <span class="keywordflow">if</span>(data==NULL)
<a name="l00191"></a>00191                 <span class="keywordflow">return</span> <a class="code" href="include_2common_8h.html#a8fe83ac76edc595f6b98cd4a4127aed5">ERROR</a>;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         <span class="comment">/* get command name/args */</span>
<a name="l00194"></a>00194         <span class="keywordflow">if</span>(cmd!=NULL){
<a name="l00195"></a>00195                 command_buf=(<span class="keywordtype">char</span> *)strdup(cmd);
<a name="l00196"></a>00196                 command_name=strtok(command_buf,<span class="stringliteral">&quot;!&quot;</span>);
<a name="l00197"></a>00197                 command_args=strtok(NULL,<span class="stringliteral">&quot;\x0&quot;</span>);
<a name="l00198"></a>00198                 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00201"></a>00201         ds.<a class="code" href="structnebstruct__event__handler__struct.html#aa8b8ea67aaae4e1423289efd5c6b35e4">type</a>=type;
<a name="l00202"></a>00202         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a35215866a4cbc5862f7bb73a5d402ce7">flags</a>=flags;
<a name="l00203"></a>00203         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a0f7ea191735b7b8603a5b9e5cd55adf1">attr</a>=attr;
<a name="l00204"></a>00204         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a5e445e3f9047b090d112bbcba04ba04a">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a55e45e36d80bdf53f84f17dd7c728a35">eventhandler_type</a>=eventhandler_type;
<a name="l00207"></a>00207         <span class="keywordflow">if</span>(eventhandler_type==<a class="code" href="icinga_8h.html#a9f58cfda7b4844cd82e8917b36514134">SERVICE_EVENTHANDLER</a> || eventhandler_type==<a class="code" href="icinga_8h.html#a557b8b10bda634063b3edccdf019e644">GLOBAL_SERVICE_EVENTHANDLER</a>){
<a name="l00208"></a>00208                 temp_service=(<a class="code" href="structservice__struct.html">service</a> *)data;
<a name="l00209"></a>00209                 ds.<a class="code" href="structnebstruct__event__handler__struct.html#a7ee86a9f6892e8ee80da1695c3a4234f">host_name</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00210"></a>00210                 ds.<a class="code" href="structnebstruct__event__handler__struct.html#aa13aa94895de34a17e96044e81347b0d">service_description</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00211"></a>00211                 }
<a name="l00212"></a>00212         <span class="keywordflow">else</span>{
<a name="l00213"></a>00213                 temp_host=(<a class="code" href="structhost__struct.html">host</a> *)data;
<a name="l00214"></a>00214                 ds.<a class="code" href="structnebstruct__event__handler__struct.html#a7ee86a9f6892e8ee80da1695c3a4234f">host_name</a>=temp_host-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00215"></a>00215                 ds.<a class="code" href="structnebstruct__event__handler__struct.html#aa13aa94895de34a17e96044e81347b0d">service_description</a>=NULL;
<a name="l00216"></a>00216                 }
<a name="l00217"></a>00217         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a2dc2b95403310ee925248e6b7c6dad64">object_ptr</a>=data;
<a name="l00218"></a>00218         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a89890cc3b92a3dc7e7b420b430ca0033">state</a>=state;
<a name="l00219"></a>00219         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a40969875c93645303fc511e446c2c44c">state_type</a>=state_type;
<a name="l00220"></a>00220         ds.<a class="code" href="structnebstruct__event__handler__struct.html#ab74da5a79b5f8adfcf77be9c2f19472e">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00221"></a>00221         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a37c0ccd1f9dc05eb6185bfe4e15b0702">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00222"></a>00222         ds.<a class="code" href="structnebstruct__event__handler__struct.html#af62923573a6050705cf15e063051fb58">timeout</a>=timeout;
<a name="l00223"></a>00223         ds.<a class="code" href="structnebstruct__event__handler__struct.html#accfe4ddd9e542196a0055b375508d85e">command_name</a>=command_name;
<a name="l00224"></a>00224         ds.<a class="code" href="structnebstruct__event__handler__struct.html#ae907116f6de1401732d8295f2f0d0788">command_args</a>=command_args;
<a name="l00225"></a>00225         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a8c6580279f4c3ad5ee4c3460a9b608d3">command_line</a>=cmdline;
<a name="l00226"></a>00226         ds.<a class="code" href="structnebstruct__event__handler__struct.html#ab50d2a324ba7b95fd63b9317dae52c01">early_timeout</a>=early_timeout;
<a name="l00227"></a>00227         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a04b0de30a0a730b7094aa47b39c556dd">execution_time</a>=exectime;
<a name="l00228"></a>00228         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a7ba67ea385d43b79a341324750e9aa95">return_code</a>=retcode;
<a name="l00229"></a>00229         ds.<a class="code" href="structnebstruct__event__handler__struct.html#a762543b097d0e7df83b6481f25a203e2">output</a>=output;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="comment">/* make callbacks */</span>
<a name="l00232"></a>00232         return_code=<a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#aa724e4357e3e7b9c154b2351deac1099">NEBCALLBACK_EVENT_HANDLER_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="comment">/* free memory */</span>
<a name="l00235"></a>00235         <a class="code" href="include_2common_8h.html#a9b12a99aae3efc49af9be50afc17b526">my_free</a>(command_buf);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         <span class="keywordflow">return</span> return_code;
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="comment">/* send host check data to broker */</span>
<a name="l00244"></a>00244 <span class="keywordtype">int</span> <a class="code" href="broker_8h.html#a7a70fd5a4b2d6afbcaa8bbb5436a065a">broker_host_check</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structhost__struct.html">host</a> *hst, <span class="keywordtype">int</span> check_type, <span class="keywordtype">int</span> state, <span class="keywordtype">int</span> state_type, <span class="keyword">struct</span> timeval start_time, <span class="keyword">struct</span> timeval end_time, <span class="keywordtype">char</span> *cmd, <span class="keywordtype">double</span> latency, <span class="keywordtype">double</span> exectime, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> early_timeout, <span class="keywordtype">int</span> retcode, <span class="keywordtype">char</span> *cmdline, <span class="keywordtype">char</span> *output, <span class="keywordtype">char</span> *long_output, <span class="keywordtype">char</span> *perfdata, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00245"></a>00245         <span class="keywordtype">char</span> *command_buf=NULL;
<a name="l00246"></a>00246         <span class="keywordtype">char</span> *command_name=NULL;
<a name="l00247"></a>00247         <span class="keywordtype">char</span> *command_args=NULL;
<a name="l00248"></a>00248         <a class="code" href="structnebstruct__host__check__struct.html">nebstruct_host_check_data</a> ds;
<a name="l00249"></a>00249         <span class="keywordtype">int</span> return_code=<a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#ad53e55554ef085eeea087c7ee1efb6b4">BROKER_HOST_CHECKS</a>))
<a name="l00252"></a>00252                 <span class="keywordflow">return</span> <a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00253"></a>00253         
<a name="l00254"></a>00254         <span class="keywordflow">if</span>(hst==NULL)
<a name="l00255"></a>00255                 <span class="keywordflow">return</span> <a class="code" href="include_2common_8h.html#a8fe83ac76edc595f6b98cd4a4127aed5">ERROR</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="comment">/* get command name/args */</span>
<a name="l00258"></a>00258         <span class="keywordflow">if</span>(cmd!=NULL){
<a name="l00259"></a>00259                 command_buf=(<span class="keywordtype">char</span> *)strdup(cmd);
<a name="l00260"></a>00260                 command_name=strtok(command_buf,<span class="stringliteral">&quot;!&quot;</span>);
<a name="l00261"></a>00261                 command_args=strtok(NULL,<span class="stringliteral">&quot;\x0&quot;</span>);
<a name="l00262"></a>00262                 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00265"></a>00265         ds.<a class="code" href="structnebstruct__host__check__struct.html#a7af7692903483e825ad18d7501a82c40">type</a>=type;
<a name="l00266"></a>00266         ds.<a class="code" href="structnebstruct__host__check__struct.html#a18a3421a0c341e6e8b43ee2d0aab18a3">flags</a>=flags;
<a name="l00267"></a>00267         ds.<a class="code" href="structnebstruct__host__check__struct.html#a8c8a8ce758f08dd94f96f7d2e9a0669b">attr</a>=attr;
<a name="l00268"></a>00268         ds.<a class="code" href="structnebstruct__host__check__struct.html#a0a3c6cfeb05ad5f10c1e9f36f710f0b8">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         ds.<a class="code" href="structnebstruct__host__check__struct.html#a6cda0b84da80a13daa7144243c215c92">host_name</a>=hst-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00271"></a>00271         ds.<a class="code" href="structnebstruct__host__check__struct.html#a9b9ddd93406ae9c72af81d9e18138250">object_ptr</a>=(<span class="keywordtype">void</span> *)hst;
<a name="l00272"></a>00272         ds.<a class="code" href="structnebstruct__host__check__struct.html#a3dfa64023a378eaccd7c680ae1a24817">check_type</a>=check_type;
<a name="l00273"></a>00273         ds.<a class="code" href="structnebstruct__host__check__struct.html#a7b0f43939bdae82ac1abba3c0dda36f7">current_attempt</a>=hst-&gt;current_attempt;
<a name="l00274"></a>00274         ds.<a class="code" href="structnebstruct__host__check__struct.html#a91478bed19bccd964dca67464fe60e76">max_attempts</a>=hst-&gt;<a class="code" href="structhost__struct.html#a091388e27be66d35e87ed643567079c5">max_attempts</a>;
<a name="l00275"></a>00275         ds.<a class="code" href="structnebstruct__host__check__struct.html#ac6cd8d46cd541bf4c2dcc950911a9900">state</a>=state;
<a name="l00276"></a>00276         ds.<a class="code" href="structnebstruct__host__check__struct.html#aeae897cf181e887d49129414b14f837a">state_type</a>=state_type;
<a name="l00277"></a>00277         ds.<a class="code" href="structnebstruct__host__check__struct.html#a725334236ac3ffb20eea9094668d56f9">timeout</a>=timeout;
<a name="l00278"></a>00278         ds.<a class="code" href="structnebstruct__host__check__struct.html#a578da873ca4a79b9c6b5b9e5ab38ab0a">command_name</a>=command_name;
<a name="l00279"></a>00279         ds.<a class="code" href="structnebstruct__host__check__struct.html#a2eb3961cf55c4920a9b2e8fa3cf01ca0">command_args</a>=command_args;
<a name="l00280"></a>00280         ds.<a class="code" href="structnebstruct__host__check__struct.html#ac91b8082d5e7e95d9d142b8816567cab">command_line</a>=cmdline;
<a name="l00281"></a>00281         ds.<a class="code" href="structnebstruct__host__check__struct.html#a37c26cab657aa110dfc5852a1ac18c51">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00282"></a>00282         ds.<a class="code" href="structnebstruct__host__check__struct.html#a6eaf653dd63e84d271e052b65d7f3e63">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00283"></a>00283         ds.<a class="code" href="structnebstruct__host__check__struct.html#a6032095d57a6594da710a39521098760">early_timeout</a>=early_timeout;
<a name="l00284"></a>00284         ds.<a class="code" href="structnebstruct__host__check__struct.html#a8ea4f94ffd7cbb6527f1ae6b2b243ae5">execution_time</a>=exectime;
<a name="l00285"></a>00285         ds.<a class="code" href="structnebstruct__host__check__struct.html#ab8d49d2fc2b766f78590b56d6ea8b8bb">latency</a>=latency;
<a name="l00286"></a>00286         ds.<a class="code" href="structnebstruct__host__check__struct.html#ae810dca8d03f1156b2618da496e776c2">return_code</a>=retcode;
<a name="l00287"></a>00287         ds.<a class="code" href="structnebstruct__host__check__struct.html#a4e2d11d67177f38aba2a86aaca2f0dc5">output</a>=output;
<a name="l00288"></a>00288         ds.<a class="code" href="structnebstruct__host__check__struct.html#ae9592e8e9d3e383d0bd8c36c68cec5a6">long_output</a>=long_output;
<a name="l00289"></a>00289         ds.<a class="code" href="structnebstruct__host__check__struct.html#a59c6520e1648f485575d22e6d5128958">perf_data</a>=perfdata;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="comment">/* make callbacks */</span>
<a name="l00292"></a>00292         return_code=<a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a7b9426da5bfaabe3f8b8efe36f04ead6">NEBCALLBACK_HOST_CHECK_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="comment">/* free data */</span>
<a name="l00295"></a>00295         <a class="code" href="include_2common_8h.html#a9b12a99aae3efc49af9be50afc17b526">my_free</a>(command_buf);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="keywordflow">return</span> return_code;
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="comment">/* send service check data to broker */</span>
<a name="l00303"></a>00303 <span class="keywordtype">int</span> <a class="code" href="broker_8h.html#af573dd59adab1dbd5041b80ae07b6245">broker_service_check</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structservice__struct.html">service</a> *svc, <span class="keywordtype">int</span> check_type, <span class="keyword">struct</span> timeval start_time, <span class="keyword">struct</span> timeval end_time, <span class="keywordtype">char</span> *cmd, <span class="keywordtype">double</span> latency, <span class="keywordtype">double</span> exectime, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> early_timeout, <span class="keywordtype">int</span> retcode, <span class="keywordtype">char</span> *cmdline, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00304"></a>00304         <span class="keywordtype">char</span> *command_buf=NULL;
<a name="l00305"></a>00305         <span class="keywordtype">char</span> *command_name=NULL;
<a name="l00306"></a>00306         <span class="keywordtype">char</span> *command_args=NULL;
<a name="l00307"></a>00307         <a class="code" href="structnebstruct__service__check__struct.html">nebstruct_service_check_data</a> ds;
<a name="l00308"></a>00308         <span class="keywordtype">int</span> return_code=<a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a80e08235cf75f52f2bf43818ec9cf62d">BROKER_SERVICE_CHECKS</a>))
<a name="l00311"></a>00311                 <span class="keywordflow">return</span> <a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00312"></a>00312         
<a name="l00313"></a>00313         <span class="keywordflow">if</span>(svc==NULL)
<a name="l00314"></a>00314                 <span class="keywordflow">return</span> <a class="code" href="include_2common_8h.html#a8fe83ac76edc595f6b98cd4a4127aed5">ERROR</a>;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="comment">/* get command name/args */</span>
<a name="l00317"></a>00317         <span class="keywordflow">if</span>(cmd!=NULL){
<a name="l00318"></a>00318                 command_buf=(<span class="keywordtype">char</span> *)strdup(cmd);
<a name="l00319"></a>00319                 command_name=strtok(command_buf,<span class="stringliteral">&quot;!&quot;</span>);
<a name="l00320"></a>00320                 command_args=strtok(NULL,<span class="stringliteral">&quot;\x0&quot;</span>);
<a name="l00321"></a>00321                 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00324"></a>00324         ds.<a class="code" href="structnebstruct__service__check__struct.html#a72409875024519201f50659f005f6dc1">type</a>=type;
<a name="l00325"></a>00325         ds.<a class="code" href="structnebstruct__service__check__struct.html#a563c85db843eeb9b7e4462fb566b36b3">flags</a>=flags;
<a name="l00326"></a>00326         ds.<a class="code" href="structnebstruct__service__check__struct.html#a890718235eb7db1cb1ab99793e47f44a">attr</a>=attr;
<a name="l00327"></a>00327         ds.<a class="code" href="structnebstruct__service__check__struct.html#aa105fbeb3280d3081fdda28b57b71901">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         ds.<a class="code" href="structnebstruct__service__check__struct.html#a7f49de3dd202d77bdb3bdc9d3f5a1c72">host_name</a>=svc-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00330"></a>00330         ds.<a class="code" href="structnebstruct__service__check__struct.html#a379afb776d90af76b93618b6e34fd55b">service_description</a>=svc-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00331"></a>00331         ds.<a class="code" href="structnebstruct__service__check__struct.html#ae0d7fb615c76a28e9bb4d9e8d17be2e3">object_ptr</a>=(<span class="keywordtype">void</span> *)svc;
<a name="l00332"></a>00332         ds.<a class="code" href="structnebstruct__service__check__struct.html#a56499ca31625af8ce3379c7ea37c8e0c">check_type</a>=check_type;
<a name="l00333"></a>00333         ds.<a class="code" href="structnebstruct__service__check__struct.html#aadb0caee7c8456b65d1c1f9897f92be8">current_attempt</a>=svc-&gt;current_attempt;
<a name="l00334"></a>00334         ds.<a class="code" href="structnebstruct__service__check__struct.html#a9bc6220cfd2b138a492cebf0d8359609">max_attempts</a>=svc-&gt;<a class="code" href="structservice__struct.html#a4cc582ba5131b3efd4cfbf6389bbe938">max_attempts</a>;
<a name="l00335"></a>00335         ds.<a class="code" href="structnebstruct__service__check__struct.html#a7d8a7b7153a5de7da40ce001553f2d80">state</a>=svc-&gt;current_state;
<a name="l00336"></a>00336         ds.<a class="code" href="structnebstruct__service__check__struct.html#acb8897f645dae7a935040c5b8925129d">state_type</a>=svc-&gt;state_type;
<a name="l00337"></a>00337         ds.<a class="code" href="structnebstruct__service__check__struct.html#a12f40682d1a195efd40f19a1a4ab97b1">timeout</a>=timeout;
<a name="l00338"></a>00338         ds.<a class="code" href="structnebstruct__service__check__struct.html#a200a5262585f4ae73f47174dece1567b">command_name</a>=command_name;
<a name="l00339"></a>00339         ds.<a class="code" href="structnebstruct__service__check__struct.html#a5754e472442dd9f9f829c97250434813">command_args</a>=command_args;
<a name="l00340"></a>00340         ds.<a class="code" href="structnebstruct__service__check__struct.html#a7e1a56a3ab453ec34ce159b0981e1ec6">command_line</a>=cmdline;
<a name="l00341"></a>00341         ds.<a class="code" href="structnebstruct__service__check__struct.html#a1cd90715ac40702b8c2b9f7510496a42">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00342"></a>00342         ds.<a class="code" href="structnebstruct__service__check__struct.html#a36ce1c128a8ad375a0da1753e3fd4559">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00343"></a>00343         ds.<a class="code" href="structnebstruct__service__check__struct.html#ad3465fb1b8a66d8a0b6892f27502be91">early_timeout</a>=early_timeout;
<a name="l00344"></a>00344         ds.<a class="code" href="structnebstruct__service__check__struct.html#abbf26f65ef5b52aeea52dff14fc74068">execution_time</a>=exectime;
<a name="l00345"></a>00345         ds.<a class="code" href="structnebstruct__service__check__struct.html#affad8ed6f2fc8677593be4eb549d6c01">latency</a>=latency;
<a name="l00346"></a>00346         ds.<a class="code" href="structnebstruct__service__check__struct.html#a5045eb74d36a5e7fb870c036ec336d49">return_code</a>=retcode;
<a name="l00347"></a>00347         ds.<a class="code" href="structnebstruct__service__check__struct.html#a34b2430cf90eedbc2e027e96616e0e77">output</a>=svc-&gt;plugin_output;
<a name="l00348"></a>00348         ds.<a class="code" href="structnebstruct__service__check__struct.html#a5c84af8f94e89dccf645e4d418f1436a">long_output</a>=svc-&gt;long_plugin_output;
<a name="l00349"></a>00349         ds.<a class="code" href="structnebstruct__service__check__struct.html#a00fe8f2cbe571808d891f234f812eb7c">perf_data</a>=svc-&gt;perf_data;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="comment">/* make callbacks */</span>
<a name="l00352"></a>00352         return_code=<a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#aa9d1e2d3f3a0fd148e8ad2f1edae4563">NEBCALLBACK_SERVICE_CHECK_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <span class="comment">/* free data */</span>
<a name="l00355"></a>00355         <a class="code" href="include_2common_8h.html#a9b12a99aae3efc49af9be50afc17b526">my_free</a>(command_buf);
<a name="l00356"></a>00356 
<a name="l00357"></a>00357         <span class="keywordflow">return</span> return_code;
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 <span class="comment">/* send comment data to broker */</span>
<a name="l00363"></a>00363 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#aa62cb77b8a0fc98fac1cf4f9a4a100eb">broker_comment_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> comment_type, <span class="keywordtype">int</span> entry_type, <span class="keywordtype">char</span> *<a class="code" href="avail_8c.html#a02aa7a3fdc25e6809e64d0ac48ad68dc">host_name</a>, <span class="keywordtype">char</span> *svc_description, time_t entry_time, <span class="keywordtype">char</span> *author_name, <span class="keywordtype">char</span> *<a class="code" href="cmd_8c.html#a7fa8a08726d2ff86eea2cd94a5980c68">comment_data</a>, <span class="keywordtype">int</span> persistent, <span class="keywordtype">int</span> source, <span class="keywordtype">int</span> expires, time_t expire_time, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> comment_id, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00364"></a>00364         <a class="code" href="structnebstruct__comment__struct.html">nebstruct_comment_data</a> ds;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a01d15d55a9f1261dd6233dc2f8d0b58e">BROKER_COMMENT_DATA</a>))
<a name="l00367"></a>00367                 <span class="keywordflow">return</span>;
<a name="l00368"></a>00368         
<a name="l00369"></a>00369         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00370"></a>00370         ds.<a class="code" href="structnebstruct__comment__struct.html#af23937aef1f2cb877942b8ef581f3b87">type</a>=type;
<a name="l00371"></a>00371         ds.<a class="code" href="structnebstruct__comment__struct.html#a1628a57e0931e2871744176a298b2120">flags</a>=flags;
<a name="l00372"></a>00372         ds.<a class="code" href="structnebstruct__comment__struct.html#a37ebe7648df01e0c6f895857e680e0e2">attr</a>=attr;
<a name="l00373"></a>00373         ds.<a class="code" href="structnebstruct__comment__struct.html#a8fc73c356ffcc0bef124f7bbb9bbc2ba">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375         ds.<a class="code" href="structnebstruct__comment__struct.html#aa867bf7a9b497c276fa7aa9089b33660">comment_type</a>=comment_type;
<a name="l00376"></a>00376         ds.<a class="code" href="structnebstruct__comment__struct.html#a64fc9fa6716ec32341adc5540e492788">entry_type</a>=entry_type;
<a name="l00377"></a>00377         ds.<a class="code" href="structnebstruct__comment__struct.html#a1100940462de02f41c70224c3b20ab0e">host_name</a>=<a class="code" href="avail_8c.html#a02aa7a3fdc25e6809e64d0ac48ad68dc">host_name</a>;
<a name="l00378"></a>00378         ds.<a class="code" href="structnebstruct__comment__struct.html#a4a1d94858d3fbfdbb225f1d1d2f9c7eb">service_description</a>=svc_description;
<a name="l00379"></a>00379         ds.<a class="code" href="structnebstruct__comment__struct.html#ada3c98b2c4ddcb06fbc685b1a74e875c">object_ptr</a>=NULL; <span class="comment">/* not implemented yet */</span>
<a name="l00380"></a>00380         ds.<a class="code" href="structnebstruct__comment__struct.html#a8ed2c72c0be06c9ee899e21988720fa4">entry_time</a>=entry_time;
<a name="l00381"></a>00381         ds.<a class="code" href="structnebstruct__comment__struct.html#aa92cfc04db5ae94547c10597b01f6584">author_name</a>=author_name;
<a name="l00382"></a>00382         ds.<a class="code" href="structnebstruct__comment__struct.html#abc9b8387b7ff1c39462e623e147ee4cb">comment_data</a>=<a class="code" href="cmd_8c.html#a7fa8a08726d2ff86eea2cd94a5980c68">comment_data</a>;
<a name="l00383"></a>00383         ds.<a class="code" href="structnebstruct__comment__struct.html#aac5b7009c6933810d1322e98fb3106c4">persistent</a>=persistent;
<a name="l00384"></a>00384         ds.<a class="code" href="structnebstruct__comment__struct.html#adb04c432f175bb5fc0b8b8bd676671fc">source</a>=source;
<a name="l00385"></a>00385         ds.<a class="code" href="structnebstruct__comment__struct.html#a62d0e01c5671035b344751e5395faa90">expires</a>=expires;
<a name="l00386"></a>00386         ds.<a class="code" href="structnebstruct__comment__struct.html#a7a167e031d5f286850e6ebe258a52da4">expire_time</a>=expire_time;
<a name="l00387"></a>00387         ds.<a class="code" href="structnebstruct__comment__struct.html#a82338c3c25c5f8089fb862ab59085edf">comment_id</a>=comment_id;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="comment">/* make callbacks */</span>
<a name="l00390"></a>00390         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#aa429c3363aa98e8d4a74cc53352fadd0">NEBCALLBACK_COMMENT_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         <span class="keywordflow">return</span>;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="comment">/* send downtime data to broker */</span>
<a name="l00398"></a>00398 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a22348239bb4e65a374b5a95f21e9cd92">broker_downtime_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> downtime_type, <span class="keywordtype">char</span> *host_name, <span class="keywordtype">char</span> *svc_description, time_t entry_time, <span class="keywordtype">char</span> *author_name, <span class="keywordtype">char</span> *comment_data, time_t start_time, time_t end_time, <span class="keywordtype">int</span> <a class="code" href="cmd_8c.html#a86dfe359cca7409a5923c131a5bf68a9">fixed</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="cmd_8c.html#ac9cc43b1e9b15d8034bb1a6cc9e4af71">triggered_by</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="cmd_8c.html#ae81de36d17fc64f5a94560d0885d98f9">duration</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> downtime_id, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00399"></a>00399         <a class="code" href="structnebstruct__downtime__struct.html">nebstruct_downtime_data</a> ds;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#aa1294c7c3f9155db178df59472148602">BROKER_DOWNTIME_DATA</a>))
<a name="l00402"></a>00402                 <span class="keywordflow">return</span>;
<a name="l00403"></a>00403         
<a name="l00404"></a>00404         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00405"></a>00405         ds.<a class="code" href="structnebstruct__downtime__struct.html#a4576f61295dd29892dba8dde7a5b4136">type</a>=type;
<a name="l00406"></a>00406         ds.<a class="code" href="structnebstruct__downtime__struct.html#a64089eb687dfdc49ee8e746b444bfa1d">flags</a>=flags;
<a name="l00407"></a>00407         ds.<a class="code" href="structnebstruct__downtime__struct.html#a7df61df1db38475d253e301c83871004">attr</a>=attr;
<a name="l00408"></a>00408         ds.<a class="code" href="structnebstruct__downtime__struct.html#ac6ef342af40bfbb94a06d9101a9f6a3c">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         ds.<a class="code" href="structnebstruct__downtime__struct.html#ab3a4bc7df24478b46a790ed4b5f5dba7">downtime_type</a>=downtime_type;
<a name="l00411"></a>00411         ds.<a class="code" href="structnebstruct__downtime__struct.html#ad4b7b8911a020016079dfcabc29a6f50">host_name</a>=<a class="code" href="avail_8c.html#a02aa7a3fdc25e6809e64d0ac48ad68dc">host_name</a>;
<a name="l00412"></a>00412         ds.<a class="code" href="structnebstruct__downtime__struct.html#a735685f19349580240f90183831d9e5e">service_description</a>=svc_description;
<a name="l00413"></a>00413         ds.<a class="code" href="structnebstruct__downtime__struct.html#af65efa69d0243def2ab5adb531fb587d">object_ptr</a>=NULL; <span class="comment">/* not implemented yet */</span>
<a name="l00414"></a>00414         ds.<a class="code" href="structnebstruct__downtime__struct.html#a9229f66d0ff5af56e5176b82ad0b984f">entry_time</a>=entry_time;
<a name="l00415"></a>00415         ds.<a class="code" href="structnebstruct__downtime__struct.html#a4a86c96c72391495f0dbf8456a38eced">author_name</a>=author_name;
<a name="l00416"></a>00416         ds.<a class="code" href="structnebstruct__downtime__struct.html#aa78c2dd8a56664fcce7116509b6e0fde">comment_data</a>=<a class="code" href="cmd_8c.html#a7fa8a08726d2ff86eea2cd94a5980c68">comment_data</a>;
<a name="l00417"></a>00417         ds.<a class="code" href="structnebstruct__downtime__struct.html#ac085289c9d691834dffb4d2373e3d1dd">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00418"></a>00418         ds.<a class="code" href="structnebstruct__downtime__struct.html#ac43fb610a591bde28755a7b3e9e965c2">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00419"></a>00419         ds.<a class="code" href="structnebstruct__downtime__struct.html#a64e66117a65e4cbe64f315d22f3b71c5">fixed</a>=<a class="code" href="cmd_8c.html#a86dfe359cca7409a5923c131a5bf68a9">fixed</a>;
<a name="l00420"></a>00420         ds.<a class="code" href="structnebstruct__downtime__struct.html#a7c0f1e6a7155da8e01897330b4ee916d">duration</a>=<a class="code" href="cmd_8c.html#ae81de36d17fc64f5a94560d0885d98f9">duration</a>;
<a name="l00421"></a>00421         ds.<a class="code" href="structnebstruct__downtime__struct.html#a49f7d713cac6051ab59f39b21b313724">triggered_by</a>=<a class="code" href="cmd_8c.html#ac9cc43b1e9b15d8034bb1a6cc9e4af71">triggered_by</a>;
<a name="l00422"></a>00422         ds.<a class="code" href="structnebstruct__downtime__struct.html#a31fe7e542b5c70a2c8738a3a2ca030e8">downtime_id</a>=downtime_id;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="comment">/* make callbacks */</span>
<a name="l00425"></a>00425         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a7a2bcc79f96f51bbd3a876c1efb75996">NEBCALLBACK_DOWNTIME_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00426"></a>00426 
<a name="l00427"></a>00427         <span class="keywordflow">return</span>;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">/* send flapping data to broker */</span>
<a name="l00433"></a>00433 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#ab56fc5b054a905bfcf88a75b9ef09199">broker_flapping_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> flapping_type, <span class="keywordtype">void</span> *data, <span class="keywordtype">double</span> percent_change, <span class="keywordtype">double</span> high_threshold, <span class="keywordtype">double</span> low_threshold, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00434"></a>00434         <a class="code" href="structnebstruct__flapping__struct.html">nebstruct_flapping_data</a> ds;
<a name="l00435"></a>00435         <a class="code" href="structhost__struct.html">host</a> *temp_host=NULL;
<a name="l00436"></a>00436         <a class="code" href="structservice__struct.html">service</a> *temp_service=NULL;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#adebdc11bd58885affa5459053dde0ede">BROKER_FLAPPING_DATA</a>))
<a name="l00439"></a>00439                 <span class="keywordflow">return</span>;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="keywordflow">if</span>(data==NULL)
<a name="l00442"></a>00442                 <span class="keywordflow">return</span>;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00445"></a>00445         ds.<a class="code" href="structnebstruct__flapping__struct.html#a920a18b9ab65c87c6601b2ac8ddc3e02">type</a>=type;
<a name="l00446"></a>00446         ds.<a class="code" href="structnebstruct__flapping__struct.html#a773cd52ecef56596e76944e401316b9e">flags</a>=flags;
<a name="l00447"></a>00447         ds.<a class="code" href="structnebstruct__flapping__struct.html#adf56744a2d4cf86a4f5bfb33a13bc61f">attr</a>=attr;
<a name="l00448"></a>00448         ds.<a class="code" href="structnebstruct__flapping__struct.html#afbdd9f713dbcc0c29bf90f97ee992bd7">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         ds.<a class="code" href="structnebstruct__flapping__struct.html#a3b2c1f9f4c28e65b8db174e44f20d361">flapping_type</a>=flapping_type;
<a name="l00451"></a>00451         <span class="keywordflow">if</span>(flapping_type==<a class="code" href="icinga_8h.html#ab33d7bfba664fe4b79452e4dfab827f4">SERVICE_FLAPPING</a>){
<a name="l00452"></a>00452                 temp_service=(<a class="code" href="structservice__struct.html">service</a> *)data;
<a name="l00453"></a>00453                 ds.<a class="code" href="structnebstruct__flapping__struct.html#a240fad87d17f21c2431cd74c4d270104">host_name</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00454"></a>00454                 ds.<a class="code" href="structnebstruct__flapping__struct.html#a7b3a540e7cc957294c6c89b4b0cb6d54">service_description</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00455"></a>00455                 ds.<a class="code" href="structnebstruct__flapping__struct.html#a516dc768bd061397a0b54d8159e15171">comment_id</a>=temp_service-&gt;flapping_comment_id;
<a name="l00456"></a>00456                 }
<a name="l00457"></a>00457         <span class="keywordflow">else</span>{
<a name="l00458"></a>00458                 temp_host=(<a class="code" href="structhost__struct.html">host</a> *)data;
<a name="l00459"></a>00459                 ds.<a class="code" href="structnebstruct__flapping__struct.html#a240fad87d17f21c2431cd74c4d270104">host_name</a>=temp_host-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00460"></a>00460                 ds.<a class="code" href="structnebstruct__flapping__struct.html#a7b3a540e7cc957294c6c89b4b0cb6d54">service_description</a>=NULL;
<a name="l00461"></a>00461                 ds.<a class="code" href="structnebstruct__flapping__struct.html#a516dc768bd061397a0b54d8159e15171">comment_id</a>=temp_host-&gt;flapping_comment_id;
<a name="l00462"></a>00462                 }
<a name="l00463"></a>00463         ds.<a class="code" href="structnebstruct__flapping__struct.html#ae515bdf27e12b33c13a3de187f0d5146">object_ptr</a>=data;
<a name="l00464"></a>00464         ds.<a class="code" href="structnebstruct__flapping__struct.html#a65839b8a8921f3312a6e7a0d020d6e14">percent_change</a>=percent_change;
<a name="l00465"></a>00465         ds.<a class="code" href="structnebstruct__flapping__struct.html#a29bba767ffe48e7d487e8f73cc442a27">high_threshold</a>=high_threshold;
<a name="l00466"></a>00466         ds.<a class="code" href="structnebstruct__flapping__struct.html#af9052b6cd2b447307b15f6c4af34d1f0">low_threshold</a>=low_threshold;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <span class="comment">/* make callbacks */</span>
<a name="l00469"></a>00469         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a679f59d58b0df1f0492716440cda07dd">NEBCALLBACK_FLAPPING_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471         <span class="keywordflow">return</span>;
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 <span class="comment">/* sends program status updates to broker */</span>
<a name="l00476"></a>00476 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a99aaccd8c6ee48a0802b987cc0fe066a">broker_program_status</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00477"></a>00477         <a class="code" href="structnebstruct__program__status__struct.html">nebstruct_program_status_data</a> ds;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a7a3aca8f12e598610579df8892f76a84">BROKER_STATUS_DATA</a>))
<a name="l00480"></a>00480                 <span class="keywordflow">return</span>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00483"></a>00483         ds.<a class="code" href="structnebstruct__program__status__struct.html#af45edec618482c077803fd38f2d6fef7">type</a>=type;
<a name="l00484"></a>00484         ds.<a class="code" href="structnebstruct__program__status__struct.html#a110eafb8d6e2e8bed44acdfcc84770b7">flags</a>=flags;
<a name="l00485"></a>00485         ds.<a class="code" href="structnebstruct__program__status__struct.html#a7387ed4b79334cf3b7bed51df228a832">attr</a>=attr;
<a name="l00486"></a>00486         ds.<a class="code" href="structnebstruct__program__status__struct.html#a524e6070d1ef5fdcab053537aad071ad">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         ds.<a class="code" href="structnebstruct__program__status__struct.html#ae9c18a117c8b2b85720f79a28a8e4d2f">program_start</a>=<a class="code" href="broker_8c.html#a2b5a4f2875a1a545f44ac2faad7a6b67">program_start</a>;
<a name="l00489"></a>00489         ds.<a class="code" href="structnebstruct__program__status__struct.html#a3f359ec7e494f3b42ce0fe81ea61979d">pid</a>=<a class="code" href="broker_8c.html#ad99d124d1c85c3b69de36466353f295e">nagios_pid</a>;
<a name="l00490"></a>00490         ds.<a class="code" href="structnebstruct__program__status__struct.html#a2c2199ed1746fdccc450d234d3480b54">daemon_mode</a>=<a class="code" href="broker_8c.html#a4255d3efd1474d8e9d267e4b1559c1f9">daemon_mode</a>;
<a name="l00491"></a>00491         ds.<a class="code" href="structnebstruct__program__status__struct.html#a6f8b2dcbdf74e4972e4a61314314d413">last_command_check</a>=<a class="code" href="broker_8c.html#aeb85ffd1c5c7f91fe9ccb3e4f58584a2">last_command_check</a>;
<a name="l00492"></a>00492         ds.<a class="code" href="structnebstruct__program__status__struct.html#a2242cbeeda458af5ae27524e8f2039f4">last_log_rotation</a>=<a class="code" href="broker_8c.html#aa087a80bdb1191f94e86f0a83d5c2eed">last_log_rotation</a>;
<a name="l00493"></a>00493         ds.<a class="code" href="structnebstruct__program__status__struct.html#afd2afbf51a1b2bc6d869195df09ee27c">notifications_enabled</a>=<a class="code" href="broker_8c.html#aeab76c66fa95f6b3a22143bade01cbe9">enable_notifications</a>;
<a name="l00494"></a>00494         ds.<a class="code" href="structnebstruct__program__status__struct.html#acf0f6ad023942c0772f43fce28f8551d">active_service_checks_enabled</a>=<a class="code" href="broker_8c.html#ab7c771c65ac24bc0d04ddae988128f8a">execute_service_checks</a>;
<a name="l00495"></a>00495         ds.<a class="code" href="structnebstruct__program__status__struct.html#af96ebce87a58510046d966a6fdbfbf83">passive_service_checks_enabled</a>=<a class="code" href="broker_8c.html#ac2cfe61062d4e6db6236a829ee16864a">accept_passive_service_checks</a>;
<a name="l00496"></a>00496         ds.<a class="code" href="structnebstruct__program__status__struct.html#aae7e6bf3df9b4c2e9eb21fe345641249">active_host_checks_enabled</a>=<a class="code" href="broker_8c.html#af4ed1772a5decb43a2711b6d560a0737">execute_host_checks</a>;
<a name="l00497"></a>00497         ds.<a class="code" href="structnebstruct__program__status__struct.html#a5d00105779706fbf9900305a35b48b68">passive_host_checks_enabled</a>=<a class="code" href="broker_8c.html#a1f08a9399cbf8d1781f7921cb39ad461">accept_passive_host_checks</a>;
<a name="l00498"></a>00498         ds.<a class="code" href="structnebstruct__program__status__struct.html#ac807e22679445a60494bbc3e0e808adc">event_handlers_enabled</a>=<a class="code" href="broker_8c.html#adf8bd6fb1b3fc3cf7750d887773feace">enable_event_handlers</a>;
<a name="l00499"></a>00499         ds.<a class="code" href="structnebstruct__program__status__struct.html#a111ca78a00c72b931e968ee1192a85ac">flap_detection_enabled</a>=<a class="code" href="broker_8c.html#a2dff02e57dcb9656ac523b8f6d548ee4">enable_flap_detection</a>;
<a name="l00500"></a>00500         ds.<a class="code" href="structnebstruct__program__status__struct.html#a27e016a1ccaccea772a03bb725a46535">failure_prediction_enabled</a>=<a class="code" href="broker_8c.html#ad9af8e808ce1df2c763d260502b58e4c">enable_failure_prediction</a>;
<a name="l00501"></a>00501         ds.<a class="code" href="structnebstruct__program__status__struct.html#a67ac77a9456f1721a38001ee82e8138d">process_performance_data</a>=<a class="code" href="broker_8c.html#a3cef48503f834db51896cd2262c4ddbd">process_performance_data</a>;
<a name="l00502"></a>00502         ds.<a class="code" href="structnebstruct__program__status__struct.html#af6a80bee6495a9bf70a8fffb8ba757af">obsess_over_hosts</a>=<a class="code" href="broker_8c.html#a879982dc6cb9e3e1e23c49eba4f7bc12">obsess_over_hosts</a>;
<a name="l00503"></a>00503         ds.<a class="code" href="structnebstruct__program__status__struct.html#affd33e8da752c3f9464ea19cd7e84d40">obsess_over_services</a>=<a class="code" href="broker_8c.html#a03e994eebc8f1e065991e7f8994a7059">obsess_over_services</a>;
<a name="l00504"></a>00504         ds.<a class="code" href="structnebstruct__program__status__struct.html#a03af4abc6ec5c474f17fa7ab6bad747b">modified_host_attributes</a>=<a class="code" href="broker_8c.html#a786e354f5a91ca30fe28ede97505e181">modified_host_process_attributes</a>;
<a name="l00505"></a>00505         ds.<a class="code" href="structnebstruct__program__status__struct.html#aa50765e18526291a2d34db6ff2b49d85">modified_service_attributes</a>=<a class="code" href="broker_8c.html#aa128280b704d982e64c50a9427cf5f71">modified_service_process_attributes</a>;
<a name="l00506"></a>00506         ds.<a class="code" href="structnebstruct__program__status__struct.html#a7a269531bb7e77e9701baa3adbdf70b8">global_host_event_handler</a>=<a class="code" href="broker_8c.html#a2cd88e2da654d6d1d2c52e79d0174109">global_host_event_handler</a>;
<a name="l00507"></a>00507         ds.<a class="code" href="structnebstruct__program__status__struct.html#ae5ff12724fd5dc8f8862beac5a95fbca">global_service_event_handler</a>=<a class="code" href="broker_8c.html#a0073f89db72fa9c3474b5a1327382784">global_service_event_handler</a>;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509         <span class="comment">/* make callbacks */</span>
<a name="l00510"></a>00510         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a161e4790421f92e4e9b98cadc895388d">NEBCALLBACK_PROGRAM_STATUS_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00511"></a>00511 
<a name="l00512"></a>00512         <span class="keywordflow">return</span>;
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 <span class="comment">/* sends host status updates to broker */</span>
<a name="l00518"></a>00518 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a914e562b934c07b8084b88c2a09d4293">broker_host_status</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structhost__struct.html">host</a> *hst, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00519"></a>00519         <a class="code" href="structnebstruct__host__status__struct.html">nebstruct_host_status_data</a> ds;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_STATUS_DATA))
<a name="l00522"></a>00522                 <span class="keywordflow">return</span>;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00525"></a>00525         ds.<a class="code" href="structnebstruct__host__status__struct.html#a93a24e19c3e8e2cd12b55276775152fa">type</a>=type;
<a name="l00526"></a>00526         ds.<a class="code" href="structnebstruct__host__status__struct.html#a16b9c2cdcd595b70b46ea78b4faa397f">flags</a>=flags;
<a name="l00527"></a>00527         ds.<a class="code" href="structnebstruct__host__status__struct.html#a27522a10c2cc67fb8fd740793e0c58c2">attr</a>=attr;
<a name="l00528"></a>00528         ds.<a class="code" href="structnebstruct__host__status__struct.html#a6c29f4ad195973131bcaca9e40df9fac">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530         ds.<a class="code" href="structnebstruct__host__status__struct.html#a9ed6e11c3cb00ca431923b1187062b8e">object_ptr</a>=(<span class="keywordtype">void</span> *)hst;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <span class="comment">/* make callbacks */</span>
<a name="l00533"></a>00533         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#aabb4189dde152da2d2d09d94f2414da0">NEBCALLBACK_HOST_STATUS_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         <span class="keywordflow">return</span>;
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 <span class="comment">/* sends service status updates to broker */</span>
<a name="l00541"></a>00541 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a9a77f3280f56e686b8a60b136f4ed96a">broker_service_status</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structservice__struct.html">service</a> *svc, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00542"></a>00542         <a class="code" href="structnebstruct__service__status__struct.html">nebstruct_service_status_data</a> ds;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_STATUS_DATA))
<a name="l00545"></a>00545                 <span class="keywordflow">return</span>;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00548"></a>00548         ds.<a class="code" href="structnebstruct__service__status__struct.html#ad828da6d1f2305cd50104d60a3855c08">type</a>=type;
<a name="l00549"></a>00549         ds.<a class="code" href="structnebstruct__service__status__struct.html#a849316c5d9584b0cf27d292098ac3445">flags</a>=flags;
<a name="l00550"></a>00550         ds.<a class="code" href="structnebstruct__service__status__struct.html#a259d9b069b753e869fe531b11caf7054">attr</a>=attr;
<a name="l00551"></a>00551         ds.<a class="code" href="structnebstruct__service__status__struct.html#a9997900cbc7ab244228a13d60631e5ea">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553         ds.<a class="code" href="structnebstruct__service__status__struct.html#a63a8793e440d7c3169824a657e149dd4">object_ptr</a>=(<span class="keywordtype">void</span> *)svc;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         <span class="comment">/* make callbacks */</span>
<a name="l00556"></a>00556         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#ac941726d038fb259629b059668731a66">NEBCALLBACK_SERVICE_STATUS_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558         <span class="keywordflow">return</span>;
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="comment">/* sends contact status updates to broker */</span>
<a name="l00564"></a>00564 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a017f0a44e3811bf863eca4544a55c022">broker_contact_status</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structcontact__struct.html">contact</a> *cntct, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00565"></a>00565         <a class="code" href="structnebstruct__service__status__struct.html">nebstruct_service_status_data</a> ds;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_STATUS_DATA))
<a name="l00568"></a>00568                 <span class="keywordflow">return</span>;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00571"></a>00571         ds.<a class="code" href="structnebstruct__service__status__struct.html#ad828da6d1f2305cd50104d60a3855c08">type</a>=type;
<a name="l00572"></a>00572         ds.<a class="code" href="structnebstruct__service__status__struct.html#a849316c5d9584b0cf27d292098ac3445">flags</a>=flags;
<a name="l00573"></a>00573         ds.<a class="code" href="structnebstruct__service__status__struct.html#a259d9b069b753e869fe531b11caf7054">attr</a>=attr;
<a name="l00574"></a>00574         ds.<a class="code" href="structnebstruct__service__status__struct.html#a9997900cbc7ab244228a13d60631e5ea">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         ds.<a class="code" href="structnebstruct__service__status__struct.html#a63a8793e440d7c3169824a657e149dd4">object_ptr</a>=(<span class="keywordtype">void</span> *)cntct;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         <span class="comment">/* make callbacks */</span>
<a name="l00579"></a>00579         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a964bd30568870d7d1ec53b743105d957">NEBCALLBACK_CONTACT_STATUS_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         <span class="keywordflow">return</span>;
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 <span class="comment">/* send notification data to broker */</span>
<a name="l00587"></a>00587 <span class="keywordtype">int</span> <a class="code" href="broker_8h.html#ab80be3f9f81f94afd9840ad738adbd92">broker_notification_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> notification_type, <span class="keywordtype">int</span> reason_type, <span class="keyword">struct</span> timeval start_time, <span class="keyword">struct</span> timeval end_time, <span class="keywordtype">void</span> *data, <span class="keywordtype">char</span> *ack_author, <span class="keywordtype">char</span> *ack_data, <span class="keywordtype">int</span> escalated, <span class="keywordtype">int</span> contacts_notified, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00588"></a>00588         <a class="code" href="structnebstruct__notification__struct.html">nebstruct_notification_data</a> ds;
<a name="l00589"></a>00589         <a class="code" href="structhost__struct.html">host</a> *temp_host=NULL;
<a name="l00590"></a>00590         <a class="code" href="structservice__struct.html">service</a> *temp_service=NULL;
<a name="l00591"></a>00591         <span class="keywordtype">int</span> return_code=<a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a4c889bf43e5587e7cc644829e7cb6e28">BROKER_NOTIFICATIONS</a>))
<a name="l00594"></a>00594                 <span class="keywordflow">return</span> return_code;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00597"></a>00597         ds.<a class="code" href="structnebstruct__notification__struct.html#a52ac372f9bd54cad593e26dcab8a6059">type</a>=type;
<a name="l00598"></a>00598         ds.<a class="code" href="structnebstruct__notification__struct.html#a63cf513356408ea9eab5975eb732ef86">flags</a>=flags;
<a name="l00599"></a>00599         ds.<a class="code" href="structnebstruct__notification__struct.html#af03e9984aed60ec721c9e19f3b11b181">attr</a>=attr;
<a name="l00600"></a>00600         ds.<a class="code" href="structnebstruct__notification__struct.html#a63d28d1f8ea06ff7072f208f04365ec3">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         ds.<a class="code" href="structnebstruct__notification__struct.html#a7a3b96fb26eb65681878d7faf53ca934">notification_type</a>=notification_type;
<a name="l00603"></a>00603         ds.<a class="code" href="structnebstruct__notification__struct.html#a76b91a5bef8911755a66ea40b0529686">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00604"></a>00604         ds.<a class="code" href="structnebstruct__notification__struct.html#aed10cce7393ac33237026698b5e5295d">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00605"></a>00605         ds.<a class="code" href="structnebstruct__notification__struct.html#afa1854dce1b9ca0a808dd054d21cad8b">reason_type</a>=reason_type;
<a name="l00606"></a>00606         <span class="keywordflow">if</span>(notification_type==<a class="code" href="icinga_8h.html#abd21c89e7e1001036dd9710065df5836">SERVICE_NOTIFICATION</a>){
<a name="l00607"></a>00607                 temp_service=(<a class="code" href="structservice__struct.html">service</a> *)data;
<a name="l00608"></a>00608                 ds.<a class="code" href="structnebstruct__notification__struct.html#a1481472829eb06981a60dd3ac4b7cbb3">host_name</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00609"></a>00609                 ds.<a class="code" href="structnebstruct__notification__struct.html#ac0af98e00d297f5b4ce254e9aa37a741">service_description</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00610"></a>00610                 ds.<a class="code" href="structnebstruct__notification__struct.html#aa17728f6573aa3824420aa288cf4d993">state</a>=temp_service-&gt;current_state;
<a name="l00611"></a>00611                 ds.<a class="code" href="structnebstruct__notification__struct.html#af8ea1364432a2391fa3bde9099ce9ade">output</a>=temp_service-&gt;plugin_output;
<a name="l00612"></a>00612                 }
<a name="l00613"></a>00613         <span class="keywordflow">else</span>{
<a name="l00614"></a>00614                 temp_host=(<a class="code" href="structhost__struct.html">host</a> *)data;
<a name="l00615"></a>00615                 ds.<a class="code" href="structnebstruct__notification__struct.html#a1481472829eb06981a60dd3ac4b7cbb3">host_name</a>=temp_host-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00616"></a>00616                 ds.<a class="code" href="structnebstruct__notification__struct.html#ac0af98e00d297f5b4ce254e9aa37a741">service_description</a>=NULL;
<a name="l00617"></a>00617                 ds.<a class="code" href="structnebstruct__notification__struct.html#aa17728f6573aa3824420aa288cf4d993">state</a>=temp_host-&gt;current_state;
<a name="l00618"></a>00618                 ds.<a class="code" href="structnebstruct__notification__struct.html#af8ea1364432a2391fa3bde9099ce9ade">output</a>=temp_host-&gt;plugin_output;
<a name="l00619"></a>00619                 }
<a name="l00620"></a>00620         ds.<a class="code" href="structnebstruct__notification__struct.html#a0519042048c87a63e12ff72bd2b00017">object_ptr</a>=data;
<a name="l00621"></a>00621         ds.<a class="code" href="structnebstruct__notification__struct.html#a443aa4b67da30730bb7cfee6701bf46a">ack_author</a>=ack_author;
<a name="l00622"></a>00622         ds.<a class="code" href="structnebstruct__notification__struct.html#a673e37bede389d4049ed747665ea9d86">ack_data</a>=ack_data;
<a name="l00623"></a>00623         ds.<a class="code" href="structnebstruct__notification__struct.html#ad0a4fe6b721a8549f60f9fcdf6b88b49">escalated</a>=escalated;
<a name="l00624"></a>00624         ds.<a class="code" href="structnebstruct__notification__struct.html#a2399907df83192ccb52ae67835013517">contacts_notified</a>=contacts_notified;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         <span class="comment">/* make callbacks */</span>
<a name="l00627"></a>00627         return_code=<a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#aa9f2b13d8ac6547ee1797583d457ef5a">NEBCALLBACK_NOTIFICATION_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <span class="keywordflow">return</span> return_code;
<a name="l00630"></a>00630         }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 <span class="comment">/* send contact notification data to broker */</span>
<a name="l00635"></a>00635 <span class="keywordtype">int</span> <a class="code" href="broker_8h.html#a667dc6da6778e169de3f0ed257cb4682">broker_contact_notification_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> notification_type, <span class="keywordtype">int</span> reason_type, <span class="keyword">struct</span> timeval start_time, <span class="keyword">struct</span> timeval end_time, <span class="keywordtype">void</span> *data, <a class="code" href="structcontact__struct.html">contact</a> *cntct, <span class="keywordtype">char</span> *ack_author, <span class="keywordtype">char</span> *ack_data, <span class="keywordtype">int</span> escalated, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00636"></a>00636         <a class="code" href="structnebstruct__contact__notification__struct.html">nebstruct_contact_notification_data</a> ds;
<a name="l00637"></a>00637         <a class="code" href="structhost__struct.html">host</a> *temp_host=NULL;
<a name="l00638"></a>00638         <a class="code" href="structservice__struct.html">service</a> *temp_service=NULL;
<a name="l00639"></a>00639         <span class="keywordtype">int</span> return_code=<a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00640"></a>00640 
<a name="l00641"></a>00641         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_NOTIFICATIONS))
<a name="l00642"></a>00642                 <span class="keywordflow">return</span> return_code;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00645"></a>00645         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a44fc48aec32bde7e4727fe4d35fb7102">type</a>=type;
<a name="l00646"></a>00646         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a9b05179a94ea326d9e92ef5e707319a0">flags</a>=flags;
<a name="l00647"></a>00647         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#ad38a9beac5a5c3aae5743f2cd7013cdf">attr</a>=attr;
<a name="l00648"></a>00648         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#ac9d19de7eeb78999aa350b7f0f28706c">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a51c1ae340d4ce9e759d50f41046e6a92">notification_type</a>=notification_type;
<a name="l00651"></a>00651         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a9a070678ebe3b88d6964a74479b0bead">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00652"></a>00652         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a61e8674b3388474f84743d1e1deafa5d">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00653"></a>00653         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#ac5f0ace69955c2d839e084250b82b3b8">reason_type</a>=reason_type;
<a name="l00654"></a>00654         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#aeb84fba1e80211d468f75f6e0a86c543">contact_name</a>=cntct-&gt;<a class="code" href="structcontact__struct.html#a03f0162d096aaf82e3f64c70a53be2b1">name</a>;
<a name="l00655"></a>00655         <span class="keywordflow">if</span>(notification_type==<a class="code" href="icinga_8h.html#abd21c89e7e1001036dd9710065df5836">SERVICE_NOTIFICATION</a>){
<a name="l00656"></a>00656                 temp_service=(<a class="code" href="structservice__struct.html">service</a> *)data;
<a name="l00657"></a>00657                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a9774d8372ecded35320f2f5c5ec11308">host_name</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00658"></a>00658                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a3146f704ad4f81e705f2f3cd4b081432">service_description</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00659"></a>00659                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#adc9f283025796471ed8a99b039233a1d">state</a>=temp_service-&gt;current_state;
<a name="l00660"></a>00660                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#aef7ddf310a2c5b0892af7e956197b617">output</a>=temp_service-&gt;plugin_output;
<a name="l00661"></a>00661                 }
<a name="l00662"></a>00662         <span class="keywordflow">else</span>{
<a name="l00663"></a>00663                 temp_host=(<a class="code" href="structhost__struct.html">host</a> *)data;
<a name="l00664"></a>00664                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a9774d8372ecded35320f2f5c5ec11308">host_name</a>=temp_host-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00665"></a>00665                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a3146f704ad4f81e705f2f3cd4b081432">service_description</a>=NULL;
<a name="l00666"></a>00666                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#adc9f283025796471ed8a99b039233a1d">state</a>=temp_host-&gt;current_state;
<a name="l00667"></a>00667                 ds.<a class="code" href="structnebstruct__contact__notification__struct.html#aef7ddf310a2c5b0892af7e956197b617">output</a>=temp_host-&gt;plugin_output;
<a name="l00668"></a>00668                 }
<a name="l00669"></a>00669         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#ae7fd976dcc21231520e995692529ca2a">object_ptr</a>=data;
<a name="l00670"></a>00670         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a7e48a4a5666a4aec1915f0f4fa268e6a">contact_ptr</a>=(<span class="keywordtype">void</span> *)cntct;
<a name="l00671"></a>00671         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#ab1e5d9a510d1757f9242997e515b0650">ack_author</a>=ack_author;
<a name="l00672"></a>00672         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a1c2cd190b82843e465dce98e5a0b8a71">ack_data</a>=ack_data;
<a name="l00673"></a>00673         ds.<a class="code" href="structnebstruct__contact__notification__struct.html#a17390e5a45ec409182a33ae9f3aa22cf">escalated</a>=escalated;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         <span class="comment">/* make callbacks */</span>
<a name="l00676"></a>00676         return_code=<a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#acc1403ffa7970f73de45d81df71c28a5">NEBCALLBACK_CONTACT_NOTIFICATION_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         <span class="keywordflow">return</span> return_code;
<a name="l00679"></a>00679         }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="comment">/* send contact notification data to broker */</span>
<a name="l00683"></a>00683 <span class="keywordtype">int</span> <a class="code" href="broker_8h.html#a69a87803946dc1d75e15c76df494521a">broker_contact_notification_method_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> notification_type, <span class="keywordtype">int</span> reason_type, <span class="keyword">struct</span> timeval start_time, <span class="keyword">struct</span> timeval end_time, <span class="keywordtype">void</span> *data, <a class="code" href="structcontact__struct.html">contact</a> *cntct, <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *ack_author, <span class="keywordtype">char</span> *ack_data, <span class="keywordtype">int</span> escalated, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00684"></a>00684         <a class="code" href="structnebstruct__contact__notification__method__struct.html">nebstruct_contact_notification_method_data</a> ds;
<a name="l00685"></a>00685         <a class="code" href="structhost__struct.html">host</a> *temp_host=NULL;
<a name="l00686"></a>00686         <a class="code" href="structservice__struct.html">service</a> *temp_service=NULL;
<a name="l00687"></a>00687         <span class="keywordtype">char</span> *command_buf=NULL;
<a name="l00688"></a>00688         <span class="keywordtype">char</span> *command_name=NULL;
<a name="l00689"></a>00689         <span class="keywordtype">char</span> *command_args=NULL;
<a name="l00690"></a>00690         <span class="keywordtype">int</span> return_code=<a class="code" href="include_2common_8h.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_NOTIFICATIONS))
<a name="l00693"></a>00693                 <span class="keywordflow">return</span> return_code;
<a name="l00694"></a>00694 
<a name="l00695"></a>00695         <span class="comment">/* get command name/args */</span>
<a name="l00696"></a>00696         <span class="keywordflow">if</span>(cmd!=NULL){
<a name="l00697"></a>00697                 command_buf=(<span class="keywordtype">char</span> *)strdup(cmd);
<a name="l00698"></a>00698                 command_name=strtok(command_buf,<span class="stringliteral">&quot;!&quot;</span>);
<a name="l00699"></a>00699                 command_args=strtok(NULL,<span class="stringliteral">&quot;\x0&quot;</span>);
<a name="l00700"></a>00700                 }
<a name="l00701"></a>00701 
<a name="l00702"></a>00702         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00703"></a>00703         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a75740b5472cd9b1b00931c23cd32ec4e">type</a>=type;
<a name="l00704"></a>00704         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a2f134c8fa2f1b20dd759a2bae3b74b07">flags</a>=flags;
<a name="l00705"></a>00705         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a4d0ed6e9a4ab08224fb597fa40ff8367">attr</a>=attr;
<a name="l00706"></a>00706         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#ae8b2cd1848251b3b455f2bd578f92c9c">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a464d9f8975d076ad96191eb04f22ee37">notification_type</a>=notification_type;
<a name="l00709"></a>00709         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#acb093f4d7b5777e250fb7790b040917f">start_time</a>=<a class="code" href="cmd_8c.html#ad20e89e0c86aa812dc3a8e2fb7b5777b">start_time</a>;
<a name="l00710"></a>00710         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#ab1fb05456a5b3120f15b9770328e88ee">end_time</a>=<a class="code" href="cmd_8c.html#a1e324d62e65642694c00de363bf8a8ba">end_time</a>;
<a name="l00711"></a>00711         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a6bf86fdee80cd8c660df61e4cd891faf">reason_type</a>=reason_type;
<a name="l00712"></a>00712         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#ace44d94252b0eb30ce9fa2ad10aefa2e">contact_name</a>=cntct-&gt;<a class="code" href="structcontact__struct.html#a03f0162d096aaf82e3f64c70a53be2b1">name</a>;
<a name="l00713"></a>00713         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a3319927dfb957e86910a7a7fa1def14a">command_name</a>=command_name;
<a name="l00714"></a>00714         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a3431e437878019e4bb4abbb2b20986a2">command_args</a>=command_args;
<a name="l00715"></a>00715         <span class="keywordflow">if</span>(notification_type==<a class="code" href="icinga_8h.html#abd21c89e7e1001036dd9710065df5836">SERVICE_NOTIFICATION</a>){
<a name="l00716"></a>00716                 temp_service=(<a class="code" href="structservice__struct.html">service</a> *)data;
<a name="l00717"></a>00717                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a47d38da5ab779fef2c80baed1a987b0e">host_name</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00718"></a>00718                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#ababc5328b47826ccfbdeac8aa8048190">service_description</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00719"></a>00719                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a200908a45e2dd1e16fa5345e6026c6ef">state</a>=temp_service-&gt;current_state;
<a name="l00720"></a>00720                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a80f802f51b02483a26363b61d7979807">output</a>=temp_service-&gt;plugin_output;
<a name="l00721"></a>00721                 }
<a name="l00722"></a>00722         <span class="keywordflow">else</span>{
<a name="l00723"></a>00723                 temp_host=(<a class="code" href="structhost__struct.html">host</a> *)data;
<a name="l00724"></a>00724                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a47d38da5ab779fef2c80baed1a987b0e">host_name</a>=temp_host-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00725"></a>00725                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#ababc5328b47826ccfbdeac8aa8048190">service_description</a>=NULL;
<a name="l00726"></a>00726                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a200908a45e2dd1e16fa5345e6026c6ef">state</a>=temp_host-&gt;current_state;
<a name="l00727"></a>00727                 ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a80f802f51b02483a26363b61d7979807">output</a>=temp_host-&gt;plugin_output;
<a name="l00728"></a>00728                 }
<a name="l00729"></a>00729         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a4aaf3de97ac6607f463c40e581efe07a">object_ptr</a>=data;
<a name="l00730"></a>00730         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a2c04bd82a195ed1c0d678d7159faea97">contact_ptr</a>=(<span class="keywordtype">void</span> *)cntct;
<a name="l00731"></a>00731         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#afeed308dbec7fb22abdc6c07b827c5d2">ack_author</a>=ack_author;
<a name="l00732"></a>00732         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#a12b20c0854ff5bafe6bbd29d86efcb81">ack_data</a>=ack_data;
<a name="l00733"></a>00733         ds.<a class="code" href="structnebstruct__contact__notification__method__struct.html#aa155f79fc0b386f7558cc3475fd653d0">escalated</a>=escalated;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735         <span class="comment">/* make callbacks */</span>
<a name="l00736"></a>00736         return_code=<a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#acfd938f6714a0dd894ef034c3172d5c5">NEBCALLBACK_CONTACT_NOTIFICATION_METHOD_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         <span class="comment">/* free memory */</span>
<a name="l00739"></a>00739         <a class="code" href="include_2common_8h.html#a9b12a99aae3efc49af9be50afc17b526">my_free</a>(command_buf);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741         <span class="keywordflow">return</span> return_code;
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744 
<a name="l00745"></a>00745 <span class="comment">/* sends adaptive programs updates to broker */</span>
<a name="l00746"></a>00746 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a30d9ce40b6e032819f01f375fe9b8f60">broker_adaptive_program_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> <a class="code" href="cmd_8c.html#aad8add9cf04edfe6e0a2e03d448bca52">command_type</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modhattr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modhattrs, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modsattr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modsattrs, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00747"></a>00747         <a class="code" href="structnebstruct__adaptive__program__data__struct.html">nebstruct_adaptive_program_data</a> ds;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#ace5c2da2e8cd37899c065124bd2cc574">BROKER_ADAPTIVE_DATA</a>))
<a name="l00750"></a>00750                 <span class="keywordflow">return</span>;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00753"></a>00753         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a052f18df149b1837ab3510c2b2c6423e">type</a>=type;
<a name="l00754"></a>00754         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a53ffe8924e4dffdc3e22a55144417e5d">flags</a>=flags;
<a name="l00755"></a>00755         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a3ad99466b39175c55d87699b7ba2096a">attr</a>=attr;
<a name="l00756"></a>00756         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a424a580df8138570567b8e79c68f94d8">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00757"></a>00757 
<a name="l00758"></a>00758         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a63a13db0f5ef9ba922bd479016ac7507">command_type</a>=<a class="code" href="cmd_8c.html#aad8add9cf04edfe6e0a2e03d448bca52">command_type</a>;
<a name="l00759"></a>00759         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a6c1540ab2574eaa6ff6148a42f8859a4">modified_host_attribute</a>=modhattr;
<a name="l00760"></a>00760         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a3b0e08ca755cbde2d17af8176155b8a1">modified_host_attributes</a>=modhattrs;
<a name="l00761"></a>00761         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#af190a41c0d0408c1cb3c8991fc3ca9b9">modified_service_attribute</a>=modsattr;
<a name="l00762"></a>00762         ds.<a class="code" href="structnebstruct__adaptive__program__data__struct.html#a3108f7dc76ca66f2b9477b23dc433747">modified_service_attributes</a>=modsattrs;
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         <span class="comment">/* make callbacks */</span>
<a name="l00765"></a>00765         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#ad98f1819e841463db5474ea5fd2cabc3">NEBCALLBACK_ADAPTIVE_PROGRAM_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00766"></a>00766 
<a name="l00767"></a>00767         <span class="keywordflow">return</span>;
<a name="l00768"></a>00768         }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="comment">/* sends adaptive host updates to broker */</span>
<a name="l00772"></a>00772 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#aeb47668f99917f970ebd953ad61214ab">broker_adaptive_host_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structhost__struct.html">host</a> *hst, <span class="keywordtype">int</span> command_type, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modattr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modattrs, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00773"></a>00773         <a class="code" href="structnebstruct__adaptive__host__data__struct.html">nebstruct_adaptive_host_data</a> ds;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_ADAPTIVE_DATA))
<a name="l00776"></a>00776                 <span class="keywordflow">return</span>;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00779"></a>00779         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#a11f6bb6ce70a0b5acd1f900ca605f293">type</a>=type;
<a name="l00780"></a>00780         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#a3f0d483243b54f7597f0cd4616e763be">flags</a>=flags;
<a name="l00781"></a>00781         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#a794cee48487a20e8ca857d505b16f0d6">attr</a>=attr;
<a name="l00782"></a>00782         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#af94bc20dfb1b07164d57d3c41c294c34">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00783"></a>00783 
<a name="l00784"></a>00784         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#ad24697362f1217b05371335fdf5946c6">command_type</a>=<a class="code" href="cmd_8c.html#aad8add9cf04edfe6e0a2e03d448bca52">command_type</a>;
<a name="l00785"></a>00785         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#aa03b009293bec06f27631cb24db24bfe">modified_attribute</a>=modattr;
<a name="l00786"></a>00786         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#aeaaf792c37b19a2dbc68d9287c34fae8">modified_attributes</a>=modattrs;
<a name="l00787"></a>00787         ds.<a class="code" href="structnebstruct__adaptive__host__data__struct.html#a94048fe1e627a1b63731ca4b3878b77f">object_ptr</a>=(<span class="keywordtype">void</span> *)hst;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         <span class="comment">/* make callbacks */</span>
<a name="l00790"></a>00790         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a979d03e11cc90963a6e662811f639b71">NEBCALLBACK_ADAPTIVE_HOST_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792         <span class="keywordflow">return</span>;
<a name="l00793"></a>00793         }
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 <span class="comment">/* sends adaptive service updates to broker */</span>
<a name="l00797"></a>00797 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a59461fa27745f06188640424746f3fbd">broker_adaptive_service_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structservice__struct.html">service</a> *svc, <span class="keywordtype">int</span> command_type, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modattr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modattrs, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00798"></a>00798         <a class="code" href="structnebstruct__adaptive__service__data__struct.html">nebstruct_adaptive_service_data</a> ds;
<a name="l00799"></a>00799 
<a name="l00800"></a>00800         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_ADAPTIVE_DATA))
<a name="l00801"></a>00801                 <span class="keywordflow">return</span>;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00804"></a>00804         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#a3bc2115020ac0109dd60183ef7bc276a">type</a>=type;
<a name="l00805"></a>00805         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#a03f1e7f6f731c775985668dd18fb0e21">flags</a>=flags;
<a name="l00806"></a>00806         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#a9db7c408da042a6900bb5aee62f21af1">attr</a>=attr;
<a name="l00807"></a>00807         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#ae90f14e497db6ca037dd4712ed8a150e">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#a6378842bd11d89e775a2505ba9c2f0d8">command_type</a>=<a class="code" href="cmd_8c.html#aad8add9cf04edfe6e0a2e03d448bca52">command_type</a>;
<a name="l00810"></a>00810         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#a6a0deac72edc20f747dc7485e2bb0afa">modified_attribute</a>=modattr;
<a name="l00811"></a>00811         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#a664533b7423c421ebb1034a65a92f8d0">modified_attributes</a>=modattrs;
<a name="l00812"></a>00812         ds.<a class="code" href="structnebstruct__adaptive__service__data__struct.html#acfca2838dc692f9bd2b4e77832696f42">object_ptr</a>=(<span class="keywordtype">void</span> *)svc;
<a name="l00813"></a>00813 
<a name="l00814"></a>00814         <span class="comment">/* make callbacks */</span>
<a name="l00815"></a>00815         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#ae3b4cde61a663c4c93a92cc8e5637900">NEBCALLBACK_ADAPTIVE_SERVICE_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <span class="keywordflow">return</span>;
<a name="l00818"></a>00818         }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <span class="comment">/* sends adaptive contact updates to broker */</span>
<a name="l00822"></a>00822 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a881b7da4c71271013276d65b5053e8d8">broker_adaptive_contact_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <a class="code" href="structcontact__struct.html">contact</a> *cntct, <span class="keywordtype">int</span> command_type, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modattr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modattrs, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modhattr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modhattrs, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modsattr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> modsattrs, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00823"></a>00823         <a class="code" href="structnebstruct__adaptive__contact__data__struct.html">nebstruct_adaptive_contact_data</a> ds;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_ADAPTIVE_DATA))
<a name="l00826"></a>00826                 <span class="keywordflow">return</span>;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00829"></a>00829         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a0563e8b76d6776d8f9c84bc9db2c3dd6">type</a>=type;
<a name="l00830"></a>00830         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a9bc53fcdfa5e36cd441458ad3513992f">flags</a>=flags;
<a name="l00831"></a>00831         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#aa363965b41afb12a004a42d566e126d6">attr</a>=attr;
<a name="l00832"></a>00832         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a7b806e827b9dd6449beda90fe4ddf563">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a552da1962a55a5a2bf92bb8c4f0e808f">command_type</a>=<a class="code" href="cmd_8c.html#aad8add9cf04edfe6e0a2e03d448bca52">command_type</a>;
<a name="l00835"></a>00835         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a35578531dc92dcdd46e843f951f1677e">modified_attribute</a>=modattr;
<a name="l00836"></a>00836         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#ae12d81526b8d3ca8ea65730180615e65">modified_attributes</a>=modattrs;
<a name="l00837"></a>00837         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#af3ee85066e2947192bc8d5f6ed4dde02">modified_host_attribute</a>=modhattr;
<a name="l00838"></a>00838         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a7858bc04cb7e889fba4326d574782871">modified_host_attributes</a>=modhattrs;
<a name="l00839"></a>00839         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a61678746bad8779effb1f0982b233824">modified_service_attribute</a>=modsattr;
<a name="l00840"></a>00840         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#aef3b5c9b096633190756c3868870e358">modified_service_attributes</a>=modsattrs;
<a name="l00841"></a>00841         ds.<a class="code" href="structnebstruct__adaptive__contact__data__struct.html#a40a9d5790b78d89a93c75db734881543">object_ptr</a>=(<span class="keywordtype">void</span> *)cntct;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         <span class="comment">/* make callbacks */</span>
<a name="l00844"></a>00844         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a5bfadda34e6d9bd0f0b7ef35685ce411">NEBCALLBACK_ADAPTIVE_CONTACT_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00845"></a>00845 
<a name="l00846"></a>00846         <span class="keywordflow">return</span>;
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849 
<a name="l00850"></a>00850 <span class="comment">/* sends external commands to broker */</span>
<a name="l00851"></a>00851 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#abec8b53d0eead29b540a5e2bdfc741ab">broker_external_command</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> command_type, time_t entry_time, <span class="keywordtype">char</span> *command_string, <span class="keywordtype">char</span> *command_args, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00852"></a>00852         <a class="code" href="structnebstruct__external__command__struct.html">nebstruct_external_command_data</a> ds;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a06fc4d3806a6501cf3138808a4c1c1b5">BROKER_EXTERNALCOMMAND_DATA</a>))
<a name="l00855"></a>00855                 <span class="keywordflow">return</span>;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00858"></a>00858         ds.<a class="code" href="structnebstruct__external__command__struct.html#ac92765437d80aa146d5cc8a74647ed75">type</a>=type;
<a name="l00859"></a>00859         ds.<a class="code" href="structnebstruct__external__command__struct.html#af5f8d1c3d93d811848204ea2d3c95d4d">flags</a>=flags;
<a name="l00860"></a>00860         ds.<a class="code" href="structnebstruct__external__command__struct.html#a692480a84bd1973a5ff361556b762849">attr</a>=attr;
<a name="l00861"></a>00861         ds.<a class="code" href="structnebstruct__external__command__struct.html#a4ee2678a685fbdaef4e22bb9651dbaf4">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863         ds.<a class="code" href="structnebstruct__external__command__struct.html#a219e991d99325cba02bc61e1e4daaf79">command_type</a>=<a class="code" href="cmd_8c.html#aad8add9cf04edfe6e0a2e03d448bca52">command_type</a>;
<a name="l00864"></a>00864         ds.<a class="code" href="structnebstruct__external__command__struct.html#a81158fd216813b91084441c54d248d12">entry_time</a>=entry_time;
<a name="l00865"></a>00865         ds.<a class="code" href="structnebstruct__external__command__struct.html#a5010c2273b26eae2a02dbe03e7a2f93b">command_string</a>=command_string;
<a name="l00866"></a>00866         ds.<a class="code" href="structnebstruct__external__command__struct.html#a8cf32a1364d38ea1ccbe5f2ec1ba45b9">command_args</a>=command_args;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868         <span class="comment">/* make callbacks */</span>
<a name="l00869"></a>00869         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a569abd7a194711f198e89e8bd5228e7e">NEBCALLBACK_EXTERNAL_COMMAND_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871         <span class="keywordflow">return</span>;
<a name="l00872"></a>00872         }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874 
<a name="l00875"></a>00875 <span class="comment">/* brokers aggregated status dumps */</span>
<a name="l00876"></a>00876 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#a31984da27d9770e9dcd80417cf2c4ef9">broker_aggregated_status_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00877"></a>00877         <a class="code" href="structnebstruct__aggregated__status__struct.html">nebstruct_aggregated_status_data</a> ds;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; BROKER_STATUS_DATA))
<a name="l00880"></a>00880                 <span class="keywordflow">return</span>;
<a name="l00881"></a>00881 
<a name="l00882"></a>00882         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00883"></a>00883         ds.<a class="code" href="structnebstruct__aggregated__status__struct.html#a45f548eec57d3f306a98ea7ec597a92a">type</a>=type;
<a name="l00884"></a>00884         ds.<a class="code" href="structnebstruct__aggregated__status__struct.html#a19c26b6055f829b181aa2571c97903f0">flags</a>=flags;
<a name="l00885"></a>00885         ds.<a class="code" href="structnebstruct__aggregated__status__struct.html#a5c6ceeca98b703691406c15224afc767">attr</a>=attr;
<a name="l00886"></a>00886         ds.<a class="code" href="structnebstruct__aggregated__status__struct.html#adb6a82311c7d1651c3d71fa9c01c71fa">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888         <span class="comment">/* make callbacks */</span>
<a name="l00889"></a>00889         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#af969bf6f53be4986bbe59f6e104724f0">NEBCALLBACK_AGGREGATED_STATUS_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891         <span class="keywordflow">return</span>;
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 <span class="comment">/* brokers retention data */</span>
<a name="l00896"></a>00896 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#ae9ac61e2e4279d17774b59b1c0fd72ae">broker_retention_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00897"></a>00897         <a class="code" href="structnebstruct__retention__struct.html">nebstruct_retention_data</a> ds;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a5283835ae5948e1db6c699616fc4596a">BROKER_RETENTION_DATA</a>))
<a name="l00900"></a>00900                 <span class="keywordflow">return</span>;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00903"></a>00903         ds.<a class="code" href="structnebstruct__retention__struct.html#a2efff518f25b1a18440a31b99e292a0d">type</a>=type;
<a name="l00904"></a>00904         ds.<a class="code" href="structnebstruct__retention__struct.html#ab66b4b13c2ec30ec95ee12d3f48a013b">flags</a>=flags;
<a name="l00905"></a>00905         ds.<a class="code" href="structnebstruct__retention__struct.html#a6a6da190cd42858c2f406d2f896939ec">attr</a>=attr;
<a name="l00906"></a>00906         ds.<a class="code" href="structnebstruct__retention__struct.html#aa13167a81f415d55405d255eac0430ee">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         <span class="comment">/* make callbacks */</span>
<a name="l00909"></a>00909         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a76b0ed838568971d0f353e0fefca487d">NEBCALLBACK_RETENTION_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00910"></a>00910 
<a name="l00911"></a>00911         <span class="keywordflow">return</span>;
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 
<a name="l00915"></a>00915 <span class="comment">/* send acknowledgement data to broker */</span>
<a name="l00916"></a>00916 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#af84f2c57831905f96c0770e4c717bc85">broker_acknowledgement_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> acknowledgement_type, <span class="keywordtype">void</span> *data, <span class="keywordtype">char</span> *ack_author, <span class="keywordtype">char</span> *ack_data, <span class="keywordtype">int</span> subtype, <span class="keywordtype">int</span> notify_contacts, <span class="keywordtype">int</span> <a class="code" href="cmd_8c.html#a404216d63ec51b55963dd8445d96cbc8">persistent_comment</a>, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00917"></a>00917         <a class="code" href="structnebstruct__acknowledgement__struct.html">nebstruct_acknowledgement_data</a> ds;
<a name="l00918"></a>00918         <a class="code" href="structhost__struct.html">host</a> *temp_host=NULL;
<a name="l00919"></a>00919         <a class="code" href="structservice__struct.html">service</a> *temp_service=NULL;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#abb3165a4707f79ca45181b5bed205ef6">BROKER_ACKNOWLEDGEMENT_DATA</a>))
<a name="l00922"></a>00922                 <span class="keywordflow">return</span>;
<a name="l00923"></a>00923         
<a name="l00924"></a>00924         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00925"></a>00925         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#ac06e0847206c2afea62f5da41eb06001">type</a>=type;
<a name="l00926"></a>00926         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#ad458f014b5d4d3fbae774c9893bb1117">flags</a>=flags;
<a name="l00927"></a>00927         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a4b1c3edb36fc000fae742326154712b6">attr</a>=attr;
<a name="l00928"></a>00928         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a07d59d16b3a291a333007a7f1826dfbc">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a8dd20259996cbd430e587ba1e20f0d59">acknowledgement_type</a>=acknowledgement_type;
<a name="l00931"></a>00931         <span class="keywordflow">if</span>(acknowledgement_type==<a class="code" href="include_2common_8h.html#ae612b5f54edd2f78d577b06a7688eb96">SERVICE_ACKNOWLEDGEMENT</a>){
<a name="l00932"></a>00932                 temp_service=(<a class="code" href="structservice__struct.html">service</a> *)data;
<a name="l00933"></a>00933                 ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#aebdda9fbfad470b1ddce51aa0a24d60d">host_name</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00934"></a>00934                 ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#abcaca01ef0957c2c82ef7f17fc9e38c2">service_description</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00935"></a>00935                 ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a727a1fdcc28e6f9b231823a489898865">state</a>=temp_service-&gt;current_state;
<a name="l00936"></a>00936                 }
<a name="l00937"></a>00937         <span class="keywordflow">else</span>{
<a name="l00938"></a>00938                 temp_host=(<a class="code" href="structhost__struct.html">host</a> *)data;
<a name="l00939"></a>00939                 ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#aebdda9fbfad470b1ddce51aa0a24d60d">host_name</a>=temp_host-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00940"></a>00940                 ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#abcaca01ef0957c2c82ef7f17fc9e38c2">service_description</a>=NULL;
<a name="l00941"></a>00941                 ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a727a1fdcc28e6f9b231823a489898865">state</a>=temp_host-&gt;current_state;
<a name="l00942"></a>00942                 }
<a name="l00943"></a>00943         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a09abe520133f0f8e5c546497a08099a0">object_ptr</a>=data;
<a name="l00944"></a>00944         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#ac9b1e498f21a89102f2de8a250e95bce">author_name</a>=ack_author;
<a name="l00945"></a>00945         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#aa94d2f88adee1bfa36e00cd49b856d7f">comment_data</a>=ack_data;
<a name="l00946"></a>00946         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a0593ad8d275675b0f6a9d7f9c9c8effd">is_sticky</a>=(subtype==<a class="code" href="include_2common_8h.html#a20d768ff427f46df3c3c1abbd31a081e">ACKNOWLEDGEMENT_STICKY</a>)?<a class="code" href="include_2common_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>:<a class="code" href="include_2common_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00947"></a>00947         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a2d4db103c0f38b21d5ee12d7dcd10ef7">notify_contacts</a>=notify_contacts;
<a name="l00948"></a>00948         ds.<a class="code" href="structnebstruct__acknowledgement__struct.html#a197302875f73688c7d82cf051fed439d">persistent_comment</a>=<a class="code" href="cmd_8c.html#a404216d63ec51b55963dd8445d96cbc8">persistent_comment</a>;
<a name="l00949"></a>00949 
<a name="l00950"></a>00950         <span class="comment">/* make callbacks */</span>
<a name="l00951"></a>00951         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#ac32b7fe1941ac718906ff15cdd997ade">NEBCALLBACK_ACKNOWLEDGEMENT_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953         <span class="keywordflow">return</span>;
<a name="l00954"></a>00954         }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 <span class="comment">/* send state change data to broker */</span>
<a name="l00958"></a>00958 <span class="keywordtype">void</span> <a class="code" href="broker_8h.html#ac69448de6b76cb439d08a588e4780290">broker_statechange_data</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> attr, <span class="keywordtype">int</span> statechange_type, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> state, <span class="keywordtype">int</span> state_type, <span class="keywordtype">int</span> current_attempt, <span class="keywordtype">int</span> max_attempts, <span class="keyword">struct</span> timeval *timestamp){
<a name="l00959"></a>00959         <a class="code" href="structnebstruct__statechange__struct.html">nebstruct_statechange_data</a> ds;
<a name="l00960"></a>00960         <a class="code" href="structhost__struct.html">host</a> *temp_host=NULL;
<a name="l00961"></a>00961         <a class="code" href="structservice__struct.html">service</a> *temp_service=NULL;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963         <span class="keywordflow">if</span>(!(<a class="code" href="broker_8c.html#a6dd9e21f0c5cd86be9c0bb8575387430">event_broker_options</a> &amp; <a class="code" href="broker_8h.html#a087a82d6b84e2e402c23714f80958853">BROKER_STATECHANGE_DATA</a>))
<a name="l00964"></a>00964                 <span class="keywordflow">return</span>;
<a name="l00965"></a>00965         
<a name="l00966"></a>00966         <span class="comment">/* fill struct with relevant data */</span>
<a name="l00967"></a>00967         ds.<a class="code" href="structnebstruct__statechange__struct.html#a28b66c15016014297410ca6b8473b003">type</a>=type;
<a name="l00968"></a>00968         ds.<a class="code" href="structnebstruct__statechange__struct.html#aeda82ac165032766cb9ec20e0f68835e">flags</a>=flags;
<a name="l00969"></a>00969         ds.<a class="code" href="structnebstruct__statechange__struct.html#adffe9bd5a631d9162a9d1167e7e8c903">attr</a>=attr;
<a name="l00970"></a>00970         ds.<a class="code" href="structnebstruct__statechange__struct.html#acc3f9d49e4579f6b1e9f9a8e58d43bf7">timestamp</a>=<a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(timestamp);
<a name="l00971"></a>00971 
<a name="l00972"></a>00972         ds.<a class="code" href="structnebstruct__statechange__struct.html#ab13915580010764a553a13fca20cdf2a">statechange_type</a>=statechange_type;
<a name="l00973"></a>00973         <span class="keywordflow">if</span>(statechange_type==<a class="code" href="icinga_8h.html#af82dfae1d9b2488e658dd0736826bcf6">SERVICE_STATECHANGE</a>){
<a name="l00974"></a>00974                 temp_service=(<a class="code" href="structservice__struct.html">service</a> *)data;
<a name="l00975"></a>00975                 ds.<a class="code" href="structnebstruct__statechange__struct.html#aca6f48588a28aad12e064ae5dde674ed">host_name</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#ac8e06ecb2bddf149916fa2f6e4077836">host_name</a>;
<a name="l00976"></a>00976                 ds.<a class="code" href="structnebstruct__statechange__struct.html#ab42047ec498d7252cab4c4cf0de8bede">service_description</a>=temp_service-&gt;<a class="code" href="structservice__struct.html#a646fc0478ea62db804e9cd8c84f53ad9">description</a>;
<a name="l00977"></a>00977                 ds.<a class="code" href="structnebstruct__statechange__struct.html#add1681c03562956f4c915f27985dfe59">output</a>=temp_service-&gt;plugin_output;
<a name="l00978"></a>00978                 }
<a name="l00979"></a>00979         <span class="keywordflow">else</span>{
<a name="l00980"></a>00980                 temp_host=(<a class="code" href="structhost__struct.html">host</a> *)data;
<a name="l00981"></a>00981                 ds.<a class="code" href="structnebstruct__statechange__struct.html#aca6f48588a28aad12e064ae5dde674ed">host_name</a>=temp_host-&gt;<a class="code" href="structhost__struct.html#a29629acc48c023596d81b061b5f135f7">name</a>;
<a name="l00982"></a>00982                 ds.<a class="code" href="structnebstruct__statechange__struct.html#ab42047ec498d7252cab4c4cf0de8bede">service_description</a>=NULL;
<a name="l00983"></a>00983                 ds.<a class="code" href="structnebstruct__statechange__struct.html#add1681c03562956f4c915f27985dfe59">output</a>=temp_host-&gt;plugin_output;
<a name="l00984"></a>00984                 }
<a name="l00985"></a>00985         ds.<a class="code" href="structnebstruct__statechange__struct.html#aafb10674b07ac01dc90b9eeffb9016d4">object_ptr</a>=data;
<a name="l00986"></a>00986         ds.<a class="code" href="structnebstruct__statechange__struct.html#a7b2cae0c66a68f9324b2aa90c49587bd">state</a>=state;
<a name="l00987"></a>00987         ds.<a class="code" href="structnebstruct__statechange__struct.html#aaa46b443af5995e26848c8a8f7b98e32">state_type</a>=state_type;
<a name="l00988"></a>00988         ds.<a class="code" href="structnebstruct__statechange__struct.html#adc595e97debc8a51db480ee8b5eab3b0">current_attempt</a>=current_attempt;
<a name="l00989"></a>00989         ds.<a class="code" href="structnebstruct__statechange__struct.html#a05de19ac29368804db5599d9e8b2e2fb">max_attempts</a>=max_attempts;
<a name="l00990"></a>00990 
<a name="l00991"></a>00991         <span class="comment">/* make callbacks */</span>
<a name="l00992"></a>00992         <a class="code" href="nebmods_8h.html#aab5dac1790d1116a54a8ea0b4bb4a78c">neb_make_callbacks</a>(<a class="code" href="nebcallbacks_8h.html#a268af5bf9795ccf8664bcdd9cd4c238f">NEBCALLBACK_STATE_CHANGE_DATA</a>,(<span class="keywordtype">void</span> *)&amp;ds);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994         <span class="keywordflow">return</span>;
<a name="l00995"></a>00995         }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 <span class="comment">/******************************************************************/</span>
<a name="l01000"></a>01000 <span class="comment">/************************ UTILITY FUNCTIONS ***********************/</span>
<a name="l01001"></a>01001 <span class="comment">/******************************************************************/</span>
<a name="l01002"></a>01002 
<a name="l01003"></a>01003 <span class="comment">/* gets timestamp for use by broker */</span>
<a name="l01004"></a>01004 <span class="keyword">struct </span>timeval <a class="code" href="broker_8h.html#a6d4e6585694983d47530e3ce3b011ad3">get_broker_timestamp</a>(struct timeval *timestamp){
<a name="l01005"></a>01005         <span class="keyword">struct </span>timeval tv;
<a name="l01006"></a>01006 
<a name="l01007"></a>01007         <span class="keywordflow">if</span>(timestamp==NULL)
<a name="l01008"></a>01008                 gettimeofday(&amp;tv,NULL);
<a name="l01009"></a>01009         <span class="keywordflow">else</span>
<a name="l01010"></a>01010                 tv=*timestamp;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="keywordflow">return</span> tv;
<a name="l01013"></a>01013         }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 
<a name="l01016"></a>01016 
<a name="l01017"></a>01017 <span class="preprocessor">#endif</span>
<a name="l01018"></a>01018 <span class="preprocessor"></span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="broker_8c.html">broker.c</a>      </li>
      <li class="footer">Generated on Tue May 3 2011 22:33:38 for Icinga-core by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
