<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Icinga-core: common/snprintf.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icinga_logo4-300x109.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Icinga-core&#160;<span id="projectnumber">1.4.0</span></div>
   <div id="projectbrief">next gen monitoring</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('snprintf_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">common/snprintf.c</div>  </div>
</div>
<div class="contents">
<a href="snprintf_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * NOTE: If you change this file, please merge it into rsync, samba, etc.</span>
<a name="l00003"></a>00003 <span class="comment"> */</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">/*</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright Patrick Powell 1995</span>
<a name="l00007"></a>00007 <span class="comment"> * This code is based on code written by Patrick Powell (papowell@astart.com)</span>
<a name="l00008"></a>00008 <span class="comment"> * It may be used for any purpose as long as this notice remains intact</span>
<a name="l00009"></a>00009 <span class="comment"> * on all source code distributions</span>
<a name="l00010"></a>00010 <span class="comment"> */</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment">/**************************************************************</span>
<a name="l00013"></a>00013 <span class="comment"> * Original:</span>
<a name="l00014"></a>00014 <span class="comment"> * Patrick Powell Tue Apr 11 09:48:21 PDT 1995</span>
<a name="l00015"></a>00015 <span class="comment"> * A bombproof version of doprnt (dopr) included.</span>
<a name="l00016"></a>00016 <span class="comment"> * Sigh.  This sort of thing is always nasty do deal with.  Note that</span>
<a name="l00017"></a>00017 <span class="comment"> * the version here does not include floating point...</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * snprintf() is used instead of sprintf() as it does limit checks</span>
<a name="l00020"></a>00020 <span class="comment"> * for string length.  This covers a nasty loophole.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * The other functions are there to prevent NULL pointers from</span>
<a name="l00023"></a>00023 <span class="comment"> * causing nast effects.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * More Recently:</span>
<a name="l00026"></a>00026 <span class="comment"> *  Brandon Long &lt;blong@fiction.net&gt; 9/15/96 for mutt 0.43</span>
<a name="l00027"></a>00027 <span class="comment"> *  This was ugly.  It is still ugly.  I opted out of floating point</span>
<a name="l00028"></a>00028 <span class="comment"> *  numbers, but the formatter understands just about everything</span>
<a name="l00029"></a>00029 <span class="comment"> *  from the normal C string format, at least as far as I can tell from</span>
<a name="l00030"></a>00030 <span class="comment"> *  the Solaris 2.5 printf(3S) man page.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> *  Brandon Long &lt;blong@fiction.net&gt; 10/22/97 for mutt 0.87.1</span>
<a name="l00033"></a>00033 <span class="comment"> *    Ok, added some minimal floating point support, which means this</span>
<a name="l00034"></a>00034 <span class="comment"> *    probably requires libm on most operating systems.  Don&#39;t yet</span>
<a name="l00035"></a>00035 <span class="comment"> *    support the exponent (e,E) and sigfig (g,G).  Also, fmtint()</span>
<a name="l00036"></a>00036 <span class="comment"> *    was pretty badly broken, it just wasn&#39;t being exercised in ways</span>
<a name="l00037"></a>00037 <span class="comment"> *    which showed it, so that&#39;s been fixed.  Also, formated the code</span>
<a name="l00038"></a>00038 <span class="comment"> *    to mutt conventions, and removed dead code left over from the</span>
<a name="l00039"></a>00039 <span class="comment"> *    original.  Also, there is now a builtin-test, just compile with:</span>
<a name="l00040"></a>00040 <span class="comment"> *           gcc -DTEST_SNPRINTF -o snprintf snprintf.c -lm</span>
<a name="l00041"></a>00041 <span class="comment"> *    and run snprintf for results.</span>
<a name="l00042"></a>00042 <span class="comment"> * </span>
<a name="l00043"></a>00043 <span class="comment"> *  Thomas Roessler &lt;roessler@guug.de&gt; 01/27/98 for mutt 0.89i</span>
<a name="l00044"></a>00044 <span class="comment"> *    The PGP code was using unsigned hexadecimal formats. </span>
<a name="l00045"></a>00045 <span class="comment"> *    Unfortunately, unsigned formats simply didn&#39;t work.</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment"> *  Michael Elkins &lt;me@cs.hmc.edu&gt; 03/05/98 for mutt 0.90.8</span>
<a name="l00048"></a>00048 <span class="comment"> *    The original code assumed that both snprintf() and vsnprintf() were</span>
<a name="l00049"></a>00049 <span class="comment"> *    missing.  Some systems only have snprintf() but not vsnprintf(), so</span>
<a name="l00050"></a>00050 <span class="comment"> *    the code is now broken down under HAVE_SNPRINTF and HAVE_VSNPRINTF.</span>
<a name="l00051"></a>00051 <span class="comment"> *</span>
<a name="l00052"></a>00052 <span class="comment"> *  Andrew Tridgell (tridge@samba.org) Oct 1998</span>
<a name="l00053"></a>00053 <span class="comment"> *    fixed handling of %.0f</span>
<a name="l00054"></a>00054 <span class="comment"> *    added test for HAVE_LONG_DOUBLE</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> * tridge@samba.org, idra@samba.org, April 2001</span>
<a name="l00057"></a>00057 <span class="comment"> *    got rid of fcvt code (twas buggy and made testing harder)</span>
<a name="l00058"></a>00058 <span class="comment"> *    added C99 semantics</span>
<a name="l00059"></a>00059 <span class="comment"> *</span>
<a name="l00060"></a>00060 <span class="comment"> * date: 2002/12/19 19:56:31;  author: herb;  state: Exp;  lines: +2 -0</span>
<a name="l00061"></a>00061 <span class="comment"> * actually print args for %g and %e</span>
<a name="l00062"></a>00062 <span class="comment"> * </span>
<a name="l00063"></a>00063 <span class="comment"> * date: 2002/06/03 13:37:52;  author: jmcd;  state: Exp;  lines: +8 -0</span>
<a name="l00064"></a>00064 <span class="comment"> * Since includes.h isn&#39;t included here, VA_COPY has to be defined here.  I don&#39;t</span>
<a name="l00065"></a>00065 <span class="comment"> * see any include file that is guaranteed to be here, so I&#39;m defining it</span>
<a name="l00066"></a>00066 <span class="comment"> * locally.  Fixes AIX and Solaris builds.</span>
<a name="l00067"></a>00067 <span class="comment"> * </span>
<a name="l00068"></a>00068 <span class="comment"> * date: 2002/06/03 03:07:24;  author: tridge;  state: Exp;  lines: +5 -13</span>
<a name="l00069"></a>00069 <span class="comment"> * put the ifdef for HAVE_VA_COPY in one place rather than in lots of</span>
<a name="l00070"></a>00070 <span class="comment"> * functions</span>
<a name="l00071"></a>00071 <span class="comment"> * </span>
<a name="l00072"></a>00072 <span class="comment"> * date: 2002/05/17 14:51:22;  author: jmcd;  state: Exp;  lines: +21 -4</span>
<a name="l00073"></a>00073 <span class="comment"> * Fix usage of va_list passed as an arg.  Use __va_copy before using it</span>
<a name="l00074"></a>00074 <span class="comment"> * when it exists.</span>
<a name="l00075"></a>00075 <span class="comment"> * </span>
<a name="l00076"></a>00076 <span class="comment"> * date: 2002/04/16 22:38:04;  author: idra;  state: Exp;  lines: +20 -14</span>
<a name="l00077"></a>00077 <span class="comment"> * Fix incorrect zpadlen handling in fmtfp.</span>
<a name="l00078"></a>00078 <span class="comment"> * Thanks to Ollie Oldham &lt;ollie.oldham@metro-optix.com&gt; for spotting it.</span>
<a name="l00079"></a>00079 <span class="comment"> * few mods to make it easier to compile the tests.</span>
<a name="l00080"></a>00080 <span class="comment"> * addedd the &quot;Ollie&quot; test to the floating point ones.</span>
<a name="l00081"></a>00081 <span class="comment"> *</span>
<a name="l00082"></a>00082 <span class="comment"> * Martin Pool (mbp@samba.org) April 2003</span>
<a name="l00083"></a>00083 <span class="comment"> *    Remove NO_CONFIG_H so that the test case can be built within a source</span>
<a name="l00084"></a>00084 <span class="comment"> *    tree with less trouble.</span>
<a name="l00085"></a>00085 <span class="comment"> *    Remove unnecessary SAFE_FREE() definition.</span>
<a name="l00086"></a>00086 <span class="comment"> *</span>
<a name="l00087"></a>00087 <span class="comment"> * Martin Pool (mbp@samba.org) May 2003</span>
<a name="l00088"></a>00088 <span class="comment"> *    Put in a prototype for dummy_snprintf() to quiet compiler warnings.</span>
<a name="l00089"></a>00089 <span class="comment"> *</span>
<a name="l00090"></a>00090 <span class="comment"> *    Move #endif to make sure VA_COPY, LDOUBLE, etc are defined even</span>
<a name="l00091"></a>00091 <span class="comment"> *    if the C library has some snprintf functions already.</span>
<a name="l00092"></a>00092 <span class="comment"> *</span>
<a name="l00093"></a>00093 <span class="comment"> * Darren Tucker (dtucker@zip.com.au) 2005</span>
<a name="l00094"></a>00094 <span class="comment"> *    Fix bug allowing read overruns of the source string with &quot;%.*s&quot;</span>
<a name="l00095"></a>00095 <span class="comment"> *    Usually harmless unless the read runs outside the process&#39; allocation</span>
<a name="l00096"></a>00096 <span class="comment"> *    (eg if your malloc does guard pages) in which case it will segfault.</span>
<a name="l00097"></a>00097 <span class="comment"> *    From OpenSSH.  Also added test for same.</span>
<a name="l00098"></a>00098 <span class="comment"> *</span>
<a name="l00099"></a>00099 <span class="comment"> * Simo Sorce (idra@samba.org) Jan 2006</span>
<a name="l00100"></a>00100 <span class="comment"> * </span>
<a name="l00101"></a>00101 <span class="comment"> *    Add support for position independent parameters </span>
<a name="l00102"></a>00102 <span class="comment"> *    fix fmtstr now it conforms to sprintf wrt min.max</span>
<a name="l00103"></a>00103 <span class="comment"> *</span>
<a name="l00104"></a>00104 <span class="comment"> **************************************************************/</span>
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="preprocessor">#ifndef NO_CONFIG_H</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span><span class="comment">/* 02/28/2006 EG changed path to config.h to match Icinga distro */</span>
<a name="l00108"></a>00108 <span class="preprocessor">#include &quot;../include/config.h&quot;</span>
<a name="l00109"></a>00109 <span class="preprocessor">#else</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">#define NULL 0</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#endif </span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>
<a name="l00113"></a>00113 <span class="preprocessor">#ifdef TEST_SNPRINTF </span><span class="comment">/* need math library headers for testing */</span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">/* In test mode, we pretend that this system doesn&#39;t have any snprintf</span>
<a name="l00116"></a>00116 <span class="comment"> * functions, regardless of what config.h says. */</span>
<a name="l00117"></a>00117 <span class="preprocessor">#  undef HAVE_SNPRINTF</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span><span class="preprocessor">#  undef HAVE_VSNPRINTF</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span><span class="preprocessor">#  undef HAVE_C99_VSNPRINTF</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span><span class="preprocessor">#  undef HAVE_ASPRINTF</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span><span class="preprocessor">#  undef HAVE_VASPRINTF</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;math.h&gt;</span>
<a name="l00123"></a>00123 <span class="preprocessor">#endif </span><span class="comment">/* TEST_SNPRINTF */</span>
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="preprocessor">#ifdef HAVE_STRING_H</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00127"></a>00127 <span class="preprocessor">#endif</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129 <span class="preprocessor">#ifdef HAVE_STRINGS_H</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span><span class="preprocessor">#include &lt;strings.h&gt;</span>
<a name="l00131"></a>00131 <span class="preprocessor">#endif</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_CTYPE_H</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span><span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00134"></a>00134 <span class="preprocessor">#endif</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00136"></a>00136 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00137"></a>00137 <span class="preprocessor">#ifdef HAVE_STDLIB_H</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#endif</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span>
<a name="l00141"></a>00141 <span class="preprocessor">#if defined(HAVE_SNPRINTF) &amp;&amp; defined(HAVE_VSNPRINTF) &amp;&amp; defined(HAVE_C99_VSNPRINTF)</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span><span class="comment">/* only include stdio.h if we are not re-defining snprintf or vsnprintf */</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00144"></a>00144  <span class="comment">/* make the compiler happy with an empty file */</span>
<a name="l00145"></a>00145  <span class="keywordtype">void</span> dummy_snprintf(<span class="keywordtype">void</span>);
<a name="l00146"></a>00146  <span class="keywordtype">void</span> dummy_snprintf(<span class="keywordtype">void</span>) {} 
<a name="l00147"></a>00147 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_SNPRINTF, etc */</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="preprocessor">#ifdef HAVE_LONG_DOUBLE</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span><span class="preprocessor">#define LDOUBLE long double</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00152"></a><a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">00152</a> <span class="preprocessor"></span><span class="preprocessor">#define LDOUBLE double</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>
<a name="l00155"></a>00155 <span class="preprocessor">#ifdef HAVE_LONG_LONG</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span><span class="preprocessor">#define LLONG long long</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00158"></a><a class="code" href="snprintf_8c.html#ae006f2462b4e9d250265e5cf8e439e0e">00158</a> <span class="preprocessor"></span><span class="preprocessor">#define LLONG long</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>
<a name="l00161"></a>00161 <span class="preprocessor">#ifndef VA_COPY</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_VA_COPY</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span><span class="preprocessor">#define VA_COPY(dest, src) va_copy(dest, src)</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE___VA_COPY</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span><span class="preprocessor">#define VA_COPY(dest, src) __va_copy(dest, src)</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00168"></a><a class="code" href="snprintf_8c.html#ad56bddf802506a91f745d7db8854f1a1">00168</a> <span class="preprocessor"></span><span class="preprocessor">#define VA_COPY(dest, src) (dest) = (src)</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>
<a name="l00172"></a>00172 <span class="comment">/*</span>
<a name="l00173"></a>00173 <span class="comment"> * dopr(): poor man&#39;s version of doprintf</span>
<a name="l00174"></a>00174 <span class="comment"> */</span>
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">/* format read states */</span>
<a name="l00177"></a><a class="code" href="snprintf_8c.html#a06f85126be2ac5e9b465c28aa49bbb4c">00177</a> <span class="preprocessor">#define DP_S_DEFAULT 0</span>
<a name="l00178"></a><a class="code" href="snprintf_8c.html#ab0ae5dad6ecbd90488c2bae77cec37f9">00178</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_S_FLAGS   1</span>
<a name="l00179"></a><a class="code" href="snprintf_8c.html#a851b29df23d15e1814dd681a5e8f64dc">00179</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_S_MIN     2</span>
<a name="l00180"></a><a class="code" href="snprintf_8c.html#a3970524d14cfd777f17798787126876f">00180</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_S_DOT     3</span>
<a name="l00181"></a><a class="code" href="snprintf_8c.html#a9c64e841a0f064eb1c31d175e5f80dbe">00181</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_S_MAX     4</span>
<a name="l00182"></a><a class="code" href="snprintf_8c.html#aac24cc0f4e9991cfc38adc999b54656f">00182</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_S_MOD     5</span>
<a name="l00183"></a><a class="code" href="snprintf_8c.html#a5c5cb13c4e2e7cc7e6c24e7983f33f0d">00183</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_S_CONV    6</span>
<a name="l00184"></a><a class="code" href="snprintf_8c.html#aab820119243e5a85595852bc02adbfff">00184</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_S_DONE    7</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>
<a name="l00186"></a>00186 <span class="comment">/* format flags - Bits */</span>
<a name="l00187"></a><a class="code" href="snprintf_8c.html#a4fd01adc98f6d334be078955f37f71bc">00187</a> <span class="preprocessor">#define DP_F_MINUS      (1 &lt;&lt; 0)</span>
<a name="l00188"></a><a class="code" href="snprintf_8c.html#a73d477ab19689194a5099be5258e18b5">00188</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_F_PLUS       (1 &lt;&lt; 1)</span>
<a name="l00189"></a><a class="code" href="snprintf_8c.html#a7a5d2b21cb1b1a05bf30789675ad6dee">00189</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_F_SPACE      (1 &lt;&lt; 2)</span>
<a name="l00190"></a><a class="code" href="snprintf_8c.html#aeed886db70d17e515dc07d5f3bbdee0b">00190</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_F_NUM        (1 &lt;&lt; 3)</span>
<a name="l00191"></a><a class="code" href="snprintf_8c.html#ada4f2c34e03ad39b57c1b443c0f56bbd">00191</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_F_ZERO       (1 &lt;&lt; 4)</span>
<a name="l00192"></a><a class="code" href="snprintf_8c.html#ade0ac028a34862464bc3f6df8c3e1655">00192</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_F_UP         (1 &lt;&lt; 5)</span>
<a name="l00193"></a><a class="code" href="snprintf_8c.html#a5bba823d29a1fa78f0af99247ed7ce4b">00193</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_F_UNSIGNED   (1 &lt;&lt; 6)</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>
<a name="l00195"></a>00195 <span class="comment">/* Conversion Flags */</span>
<a name="l00196"></a><a class="code" href="snprintf_8c.html#aa8520b359619d83e679acae970101f0c">00196</a> <span class="preprocessor">#define DP_C_CHAR    1</span>
<a name="l00197"></a><a class="code" href="snprintf_8c.html#a9ca61e4b3744be23de3649e82bba6832">00197</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_C_SHORT   2</span>
<a name="l00198"></a><a class="code" href="snprintf_8c.html#ad63b7444b754b2553d116c5549e52c1f">00198</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_C_LONG    3</span>
<a name="l00199"></a><a class="code" href="snprintf_8c.html#a10f614c6bf9e83aa875f2532a8ec3b72">00199</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_C_LDOUBLE 4</span>
<a name="l00200"></a><a class="code" href="snprintf_8c.html#a1bea80b78e4b4c33ecd6118eec4ef5c4">00200</a> <span class="preprocessor"></span><span class="preprocessor">#define DP_C_LLONG   5</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>
<a name="l00202"></a>00202 <span class="comment">/* Chunk types */</span>
<a name="l00203"></a><a class="code" href="snprintf_8c.html#adde92565b3ad073250f3331f3d18cfd8">00203</a> <span class="preprocessor">#define CNK_FMT_STR 0</span>
<a name="l00204"></a><a class="code" href="snprintf_8c.html#a2c3e2e1acbf0c35cdd1b29ac83c7e780">00204</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_INT     1</span>
<a name="l00205"></a><a class="code" href="snprintf_8c.html#ae027eff2e9cf808a617b2005da51b0d7">00205</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_OCTAL   2</span>
<a name="l00206"></a><a class="code" href="snprintf_8c.html#a5b707bb1eb93a3d1c6de9b8d09d19f9a">00206</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_UINT    3</span>
<a name="l00207"></a><a class="code" href="snprintf_8c.html#aee489577f0d600798efb7a29f9be9af4">00207</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_HEX     4</span>
<a name="l00208"></a><a class="code" href="snprintf_8c.html#a56fe6bed46ffce0270a4879f093ce7b1">00208</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_FLOAT   5</span>
<a name="l00209"></a><a class="code" href="snprintf_8c.html#a91f7f4da6fdfe9f3ec3b83ed0392e65e">00209</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_CHAR    6</span>
<a name="l00210"></a><a class="code" href="snprintf_8c.html#aa064eec79890f8b4882d8a9211c49e6a">00210</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_STRING  7</span>
<a name="l00211"></a><a class="code" href="snprintf_8c.html#a13e796f538b676ce50d3836cdcdc8bfb">00211</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_PTR     8</span>
<a name="l00212"></a><a class="code" href="snprintf_8c.html#a2e967eb28d85072b3b8c6d670e0febe9">00212</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_NUM     9</span>
<a name="l00213"></a><a class="code" href="snprintf_8c.html#a328ae7d867d206b64cd453f2e44028d5">00213</a> <span class="preprocessor"></span><span class="preprocessor">#define CNK_PRCNT   10</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span>
<a name="l00215"></a><a class="code" href="snprintf_8c.html#ab3c406147243a9838b169ea8832fd947">00215</a> <span class="preprocessor">#define char_to_int(p) ((p)- &#39;0&#39;)</span>
<a name="l00216"></a>00216 <span class="preprocessor"></span><span class="preprocessor">#ifndef MAX</span>
<a name="l00217"></a><a class="code" href="snprintf_8c.html#a496190eeefc692949639de03f8f18e59">00217</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX(p,q) (((p) &gt;= (q)) ? (p) : (q))</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00219"></a>00219 <span class="preprocessor"></span>
<a name="l00220"></a>00220 <span class="comment">/* yes this really must be a ||. Don&#39;t muck with this (tridge) */</span>
<a name="l00221"></a>00221 <span class="preprocessor">#if !defined(HAVE_VSNPRINTF) || !defined(HAVE_C99_VSNPRINTF)</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>
<a name="l00223"></a><a class="code" href="structpr__chunk.html">00223</a> <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> {
<a name="l00224"></a><a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">00224</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a>; <span class="comment">/* chunk type */</span>
<a name="l00225"></a><a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">00225</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a>; <span class="comment">/* parameter number */</span>
<a name="l00226"></a><a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">00226</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a>; 
<a name="l00227"></a><a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">00227</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a>;
<a name="l00228"></a><a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">00228</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>;
<a name="l00229"></a><a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">00229</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a>;
<a name="l00230"></a><a class="code" href="structpr__chunk.html#a2356e51541dbe18e18c588fb076a95cb">00230</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a2356e51541dbe18e18c588fb076a95cb">start</a>;
<a name="l00231"></a><a class="code" href="structpr__chunk.html#a201fd59e460bbf3b72d68eb232f6d003">00231</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a201fd59e460bbf3b72d68eb232f6d003">len</a>;
<a name="l00232"></a><a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">00232</a>         <a class="code" href="snprintf_8c.html#ae006f2462b4e9d250265e5cf8e439e0e">LLONG</a> <a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>;
<a name="l00233"></a><a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">00233</a>         <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> <a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a>;
<a name="l00234"></a><a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">00234</a>         <span class="keywordtype">char</span> *<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a>;
<a name="l00235"></a><a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">00235</a>         <span class="keywordtype">void</span> *<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>;
<a name="l00236"></a><a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">00236</a>         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>;
<a name="l00237"></a><a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">00237</a>         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>;
<a name="l00238"></a><a class="code" href="structpr__chunk.html#a913fae0bb85df118e9b1b738810d8225">00238</a>         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *<a class="code" href="structpr__chunk.html#a913fae0bb85df118e9b1b738810d8225">next</a>;
<a name="l00239"></a>00239 };
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="structpr__chunk__x.html">00241</a> <span class="keyword">struct </span><a class="code" href="structpr__chunk__x.html">pr_chunk_x</a> {
<a name="l00242"></a><a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">00242</a>         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> **<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>;
<a name="l00243"></a><a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">00243</a>         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>;
<a name="l00244"></a>00244 };
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="keyword">static</span> <span class="keywordtype">size_t</span> dopr(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, 
<a name="l00247"></a>00247                    va_list args_in);
<a name="l00248"></a>00248 <span class="keyword">static</span> <span class="keywordtype">void</span> fmtstr(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen,
<a name="l00249"></a>00249                     <span class="keywordtype">char</span> *<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>, <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>, <span class="keywordtype">int</span> <a class="code" href="avail_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <span class="keywordtype">int</span> <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>);
<a name="l00250"></a>00250 <span class="keyword">static</span> <span class="keywordtype">void</span> fmtint(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen,
<a name="l00251"></a>00251                     <span class="keywordtype">long</span> <a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>, <span class="keywordtype">int</span> base, <span class="keywordtype">int</span> <a class="code" href="avail_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <span class="keywordtype">int</span> <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>);
<a name="l00252"></a>00252 <span class="keyword">static</span> <span class="keywordtype">void</span> fmtfp(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen,
<a name="l00253"></a>00253                    <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> <a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a>, <span class="keywordtype">int</span> <a class="code" href="avail_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <span class="keywordtype">int</span> <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>);
<a name="l00254"></a>00254 <span class="keyword">static</span> <span class="keywordtype">void</span> dopr_outch(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen, <span class="keywordtype">char</span> c);
<a name="l00255"></a>00255 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *new_chunk(<span class="keywordtype">void</span>);
<a name="l00256"></a>00256 <span class="keyword">static</span> <span class="keywordtype">int</span> add_cnk_list_entry(<span class="keyword">struct</span> <a class="code" href="structpr__chunk__x.html">pr_chunk_x</a> **list,
<a name="l00257"></a>00257                                 <span class="keywordtype">int</span> max_num, <span class="keyword">struct</span> <a class="code" href="structpr__chunk.html">pr_chunk</a> *chunk);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="keyword">static</span> <span class="keywordtype">size_t</span> dopr(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, va_list args_in)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261         <span class="keywordtype">char</span> ch;
<a name="l00262"></a>00262         <span class="keywordtype">int</span> state;
<a name="l00263"></a>00263         <span class="keywordtype">int</span> pflag;
<a name="l00264"></a>00264         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>;
<a name="l00265"></a>00265         <span class="keywordtype">int</span> pfirst;
<a name="l00266"></a>00266         <span class="keywordtype">size_t</span> currlen;
<a name="l00267"></a>00267         va_list args;
<a name="l00268"></a>00268         <span class="keyword">const</span> <span class="keywordtype">char</span> *base;
<a name="l00269"></a>00269         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *chunks = NULL;
<a name="l00270"></a>00270         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *cnk = NULL;
<a name="l00271"></a>00271         <span class="keyword">struct </span><a class="code" href="structpr__chunk__x.html">pr_chunk_x</a> *clist = NULL;
<a name="l00272"></a>00272         <span class="keywordtype">int</span> max_pos;
<a name="l00273"></a>00273         <span class="keywordtype">size_t</span> ret = -1;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <a class="code" href="snprintf_8c.html#ad56bddf802506a91f745d7db8854f1a1">VA_COPY</a>(args, args_in);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         state = <a class="code" href="snprintf_8c.html#a06f85126be2ac5e9b465c28aa49bbb4c">DP_S_DEFAULT</a>;
<a name="l00278"></a>00278         pfirst = 1;
<a name="l00279"></a>00279         pflag = 0;
<a name="l00280"></a>00280         pnum = 0;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         max_pos = 0;
<a name="l00283"></a>00283         base = format;
<a name="l00284"></a>00284         ch = *format++;
<a name="l00285"></a>00285         
<a name="l00286"></a>00286         <span class="comment">/* retrieve the string structure as chunks */</span>
<a name="l00287"></a>00287         <span class="keywordflow">while</span> (state != <a class="code" href="snprintf_8c.html#aab820119243e5a85595852bc02adbfff">DP_S_DONE</a>) {
<a name="l00288"></a>00288                 <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;\0&#39;</span>) 
<a name="l00289"></a>00289                         state = <a class="code" href="snprintf_8c.html#aab820119243e5a85595852bc02adbfff">DP_S_DONE</a>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291                 <span class="keywordflow">switch</span>(state) {
<a name="l00292"></a>00292                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a06f85126be2ac5e9b465c28aa49bbb4c">DP_S_DEFAULT</a>:
<a name="l00293"></a>00293                         
<a name="l00294"></a>00294                         <span class="keywordflow">if</span> (cnk) {
<a name="l00295"></a>00295                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a913fae0bb85df118e9b1b738810d8225">next</a> = new_chunk();
<a name="l00296"></a>00296                                 cnk = cnk-&gt;<a class="code" href="structpr__chunk.html#a913fae0bb85df118e9b1b738810d8225">next</a>;
<a name="l00297"></a>00297                         } <span class="keywordflow">else</span> {
<a name="l00298"></a>00298                                 cnk = new_chunk();
<a name="l00299"></a>00299                         }
<a name="l00300"></a>00300                         <span class="keywordflow">if</span> (!cnk) <span class="keywordflow">goto</span> done;
<a name="l00301"></a>00301                         <span class="keywordflow">if</span> (!chunks) chunks = cnk;
<a name="l00302"></a>00302                         
<a name="l00303"></a>00303                         <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;%&#39;</span>) {
<a name="l00304"></a>00304                                 state = <a class="code" href="snprintf_8c.html#ab0ae5dad6ecbd90488c2bae77cec37f9">DP_S_FLAGS</a>;
<a name="l00305"></a>00305                                 ch = *format++;
<a name="l00306"></a>00306                         } <span class="keywordflow">else</span> {
<a name="l00307"></a>00307                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#adde92565b3ad073250f3331f3d18cfd8">CNK_FMT_STR</a>;
<a name="l00308"></a>00308                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a2356e51541dbe18e18c588fb076a95cb">start</a> = format - base -1;
<a name="l00309"></a>00309                                 <span class="keywordflow">while</span> ((ch != <span class="charliteral">&#39;\0&#39;</span>) &amp;&amp; (ch != <span class="charliteral">&#39;%&#39;</span>)) ch = *format++;
<a name="l00310"></a>00310                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a201fd59e460bbf3b72d68eb232f6d003">len</a> = format - base - cnk-&gt;<a class="code" href="structpr__chunk.html#a2356e51541dbe18e18c588fb076a95cb">start</a> -1;
<a name="l00311"></a>00311                         }
<a name="l00312"></a>00312                         <span class="keywordflow">break</span>;
<a name="l00313"></a>00313                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#ab0ae5dad6ecbd90488c2bae77cec37f9">DP_S_FLAGS</a>:
<a name="l00314"></a>00314                         <span class="keywordflow">switch</span> (ch) {
<a name="l00315"></a>00315                         <span class="keywordflow">case</span> <span class="charliteral">&#39;-&#39;</span>:
<a name="l00316"></a>00316                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#a4fd01adc98f6d334be078955f37f71bc">DP_F_MINUS</a>;
<a name="l00317"></a>00317                                 ch = *format++;
<a name="l00318"></a>00318                                 <span class="keywordflow">break</span>;
<a name="l00319"></a>00319                         <span class="keywordflow">case</span> <span class="charliteral">&#39;+&#39;</span>:
<a name="l00320"></a>00320                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#a73d477ab19689194a5099be5258e18b5">DP_F_PLUS</a>;
<a name="l00321"></a>00321                                 ch = *format++;
<a name="l00322"></a>00322                                 <span class="keywordflow">break</span>;
<a name="l00323"></a>00323                         <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>:
<a name="l00324"></a>00324                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#a7a5d2b21cb1b1a05bf30789675ad6dee">DP_F_SPACE</a>;
<a name="l00325"></a>00325                                 ch = *format++;
<a name="l00326"></a>00326                                 <span class="keywordflow">break</span>;
<a name="l00327"></a>00327                         <span class="keywordflow">case</span> <span class="charliteral">&#39;#&#39;</span>:
<a name="l00328"></a>00328                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#aeed886db70d17e515dc07d5f3bbdee0b">DP_F_NUM</a>;
<a name="l00329"></a>00329                                 ch = *format++;
<a name="l00330"></a>00330                                 <span class="keywordflow">break</span>;
<a name="l00331"></a>00331                         <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>:
<a name="l00332"></a>00332                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#ada4f2c34e03ad39b57c1b443c0f56bbd">DP_F_ZERO</a>;
<a name="l00333"></a>00333                                 ch = *format++;
<a name="l00334"></a>00334                                 <span class="keywordflow">break</span>;
<a name="l00335"></a>00335                         <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:
<a name="l00336"></a>00336                                 <span class="comment">/* internationalization not supported yet */</span>
<a name="l00337"></a>00337                                 ch = *format++;
<a name="l00338"></a>00338                                 <span class="keywordflow">break</span>;
<a name="l00339"></a>00339                         <span class="keywordflow">default</span>:
<a name="l00340"></a>00340                                 state = <a class="code" href="snprintf_8c.html#a851b29df23d15e1814dd681a5e8f64dc">DP_S_MIN</a>;
<a name="l00341"></a>00341                                 <span class="keywordflow">break</span>;
<a name="l00342"></a>00342                         }
<a name="l00343"></a>00343                         <span class="keywordflow">break</span>;
<a name="l00344"></a>00344                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a851b29df23d15e1814dd681a5e8f64dc">DP_S_MIN</a>:
<a name="l00345"></a>00345                         <span class="keywordflow">if</span> (isdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ch)) {
<a name="l00346"></a>00346                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a> = 10 * cnk-&gt;<a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a> + <a class="code" href="snprintf_8c.html#ab3c406147243a9838b169ea8832fd947">char_to_int</a> (ch);
<a name="l00347"></a>00347                                 ch = *format++;
<a name="l00348"></a>00348                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;$&#39;</span>) {
<a name="l00349"></a>00349                                 <span class="keywordflow">if</span> (!pfirst &amp;&amp; !pflag) {
<a name="l00350"></a>00350                                         <span class="comment">/* parameters must be all positioned or none */</span>
<a name="l00351"></a>00351                                         <span class="keywordflow">goto</span> done;
<a name="l00352"></a>00352                                 }
<a name="l00353"></a>00353                                 <span class="keywordflow">if</span> (pfirst) {
<a name="l00354"></a>00354                                         pfirst = 0;
<a name="l00355"></a>00355                                         pflag = 1;
<a name="l00356"></a>00356                                 }
<a name="l00357"></a>00357                                 <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a> == 0) <span class="comment">/* what ?? */</span>
<a name="l00358"></a>00358                                         <span class="keywordflow">goto</span> done;
<a name="l00359"></a>00359                                 cnk-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a>;
<a name="l00360"></a>00360                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a> = 0;
<a name="l00361"></a>00361                                 ch = *format++;
<a name="l00362"></a>00362                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;*&#39;</span>) {
<a name="l00363"></a>00363                                 <span class="keywordflow">if</span> (pfirst) pfirst = 0;
<a name="l00364"></a>00364                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a> = new_chunk();
<a name="l00365"></a>00365                                 <span class="keywordflow">if</span> (!cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>) <span class="comment">/* out of memory :-( */</span>
<a name="l00366"></a>00366                                         <span class="keywordflow">goto</span> done;
<a name="l00367"></a>00367                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a2c3e2e1acbf0c35cdd1b29ac83c7e780">CNK_INT</a>;
<a name="l00368"></a>00368                                 <span class="keywordflow">if</span> (pflag) {
<a name="l00369"></a>00369                                         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>;
<a name="l00370"></a>00370                                         ch = *format++;
<a name="l00371"></a>00371                                         <span class="keywordflow">if</span> (!isdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ch)) {
<a name="l00372"></a>00372                                                 <span class="comment">/* parameters must be all positioned or none */</span>
<a name="l00373"></a>00373                                                 <span class="keywordflow">goto</span> done;
<a name="l00374"></a>00374                                         }
<a name="l00375"></a>00375                                         <span class="keywordflow">for</span> (num = 0; isdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ch); ch = *format++) {
<a name="l00376"></a>00376                                                 num = 10 * num + <a class="code" href="snprintf_8c.html#ab3c406147243a9838b169ea8832fd947">char_to_int</a>(ch);
<a name="l00377"></a>00377                                         }
<a name="l00378"></a>00378                                         cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = <a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>;
<a name="l00379"></a>00379                                         <span class="keywordflow">if</span> (ch != <span class="charliteral">&#39;$&#39;</span>) <span class="comment">/* what ?? */</span>
<a name="l00380"></a>00380                                                 <span class="keywordflow">goto</span> done;
<a name="l00381"></a>00381                                 } <span class="keywordflow">else</span> {
<a name="l00382"></a>00382                                         cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = ++pnum;
<a name="l00383"></a>00383                                 }
<a name="l00384"></a>00384                                 max_pos = add_cnk_list_entry(&amp;clist, max_pos, cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>);
<a name="l00385"></a>00385                                 <span class="keywordflow">if</span> (max_pos == 0) <span class="comment">/* out of memory :-( */</span>
<a name="l00386"></a>00386                                         <span class="keywordflow">goto</span> done;
<a name="l00387"></a>00387                                 ch = *format++;
<a name="l00388"></a>00388                                 state = <a class="code" href="snprintf_8c.html#a3970524d14cfd777f17798787126876f">DP_S_DOT</a>;
<a name="l00389"></a>00389                         } <span class="keywordflow">else</span> {
<a name="l00390"></a>00390                                 <span class="keywordflow">if</span> (pfirst) pfirst = 0;
<a name="l00391"></a>00391                                 state = <a class="code" href="snprintf_8c.html#a3970524d14cfd777f17798787126876f">DP_S_DOT</a>;
<a name="l00392"></a>00392                         }
<a name="l00393"></a>00393                         <span class="keywordflow">break</span>;
<a name="l00394"></a>00394                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a3970524d14cfd777f17798787126876f">DP_S_DOT</a>:
<a name="l00395"></a>00395                         <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;.&#39;</span>) {
<a name="l00396"></a>00396                                 state = <a class="code" href="snprintf_8c.html#a9c64e841a0f064eb1c31d175e5f80dbe">DP_S_MAX</a>;
<a name="l00397"></a>00397                                 ch = *format++;
<a name="l00398"></a>00398                         } <span class="keywordflow">else</span> { 
<a name="l00399"></a>00399                                 state = <a class="code" href="snprintf_8c.html#aac24cc0f4e9991cfc38adc999b54656f">DP_S_MOD</a>;
<a name="l00400"></a>00400                         }
<a name="l00401"></a>00401                         <span class="keywordflow">break</span>;
<a name="l00402"></a>00402                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a9c64e841a0f064eb1c31d175e5f80dbe">DP_S_MAX</a>:
<a name="l00403"></a>00403                         <span class="keywordflow">if</span> (isdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ch)) {
<a name="l00404"></a>00404                                 <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a> &lt; 0)
<a name="l00405"></a>00405                                         cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a> = 0;
<a name="l00406"></a>00406                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a> = 10 * cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a> + <a class="code" href="snprintf_8c.html#ab3c406147243a9838b169ea8832fd947">char_to_int</a> (ch);
<a name="l00407"></a>00407                                 ch = *format++;
<a name="l00408"></a>00408                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;$&#39;</span>) {
<a name="l00409"></a>00409                                 <span class="keywordflow">if</span> (!pfirst &amp;&amp; !pflag) {
<a name="l00410"></a>00410                                         <span class="comment">/* parameters must be all positioned or none */</span>
<a name="l00411"></a>00411                                         <span class="keywordflow">goto</span> done;
<a name="l00412"></a>00412                                 }
<a name="l00413"></a>00413                                 <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a> &lt;= 0) <span class="comment">/* what ?? */</span>
<a name="l00414"></a>00414                                         <span class="keywordflow">goto</span> done;
<a name="l00415"></a>00415                                 cnk-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a>;
<a name="l00416"></a>00416                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a> = -1;
<a name="l00417"></a>00417                                 ch = *format++;
<a name="l00418"></a>00418                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;*&#39;</span>) {
<a name="l00419"></a>00419                                 cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a> = new_chunk();
<a name="l00420"></a>00420                                 <span class="keywordflow">if</span> (!cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>) <span class="comment">/* out of memory :-( */</span>
<a name="l00421"></a>00421                                         <span class="keywordflow">goto</span> done;
<a name="l00422"></a>00422                                 cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a2c3e2e1acbf0c35cdd1b29ac83c7e780">CNK_INT</a>;
<a name="l00423"></a>00423                                 <span class="keywordflow">if</span> (pflag) {
<a name="l00424"></a>00424                                         <span class="keywordtype">int</span> <a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>;
<a name="l00425"></a>00425                                         ch = *format++;
<a name="l00426"></a>00426                                         <span class="keywordflow">if</span> (!isdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ch)) {
<a name="l00427"></a>00427                                                 <span class="comment">/* parameters must be all positioned or none */</span>
<a name="l00428"></a>00428                                                 <span class="keywordflow">goto</span> done;
<a name="l00429"></a>00429                                         }
<a name="l00430"></a>00430                                         <span class="keywordflow">for</span> (num = 0; isdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ch); ch = *format++) {
<a name="l00431"></a>00431                                                 num = 10 * num + <a class="code" href="snprintf_8c.html#ab3c406147243a9838b169ea8832fd947">char_to_int</a>(ch);
<a name="l00432"></a>00432                                         }
<a name="l00433"></a>00433                                         cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = <a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>;
<a name="l00434"></a>00434                                         <span class="keywordflow">if</span> (ch != <span class="charliteral">&#39;$&#39;</span>) <span class="comment">/* what ?? */</span>
<a name="l00435"></a>00435                                                 <span class="keywordflow">goto</span> done;
<a name="l00436"></a>00436                                 } <span class="keywordflow">else</span> {
<a name="l00437"></a>00437                                         cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = ++pnum;
<a name="l00438"></a>00438                                 }
<a name="l00439"></a>00439                                 max_pos = add_cnk_list_entry(&amp;clist, max_pos, cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>);
<a name="l00440"></a>00440                                 <span class="keywordflow">if</span> (max_pos == 0) <span class="comment">/* out of memory :-( */</span>
<a name="l00441"></a>00441                                         <span class="keywordflow">goto</span> done;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                                 ch = *format++;
<a name="l00444"></a>00444                                 state = <a class="code" href="snprintf_8c.html#aac24cc0f4e9991cfc38adc999b54656f">DP_S_MOD</a>;
<a name="l00445"></a>00445                         } <span class="keywordflow">else</span> {
<a name="l00446"></a>00446                                 state = <a class="code" href="snprintf_8c.html#aac24cc0f4e9991cfc38adc999b54656f">DP_S_MOD</a>;
<a name="l00447"></a>00447                         }
<a name="l00448"></a>00448                         <span class="keywordflow">break</span>;
<a name="l00449"></a>00449                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#aac24cc0f4e9991cfc38adc999b54656f">DP_S_MOD</a>:
<a name="l00450"></a>00450                         <span class="keywordflow">switch</span> (ch) {
<a name="l00451"></a>00451                         <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:
<a name="l00452"></a>00452                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> = <a class="code" href="snprintf_8c.html#a9ca61e4b3744be23de3649e82bba6832">DP_C_SHORT</a>;
<a name="l00453"></a>00453                                 ch = *format++;
<a name="l00454"></a>00454                                 <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;h&#39;</span>) {
<a name="l00455"></a>00455                                         cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> = <a class="code" href="snprintf_8c.html#aa8520b359619d83e679acae970101f0c">DP_C_CHAR</a>;
<a name="l00456"></a>00456                                         ch = *format++;
<a name="l00457"></a>00457                                 }
<a name="l00458"></a>00458                                 <span class="keywordflow">break</span>;
<a name="l00459"></a>00459                         <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:
<a name="l00460"></a>00460                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> = <a class="code" href="snprintf_8c.html#ad63b7444b754b2553d116c5549e52c1f">DP_C_LONG</a>;
<a name="l00461"></a>00461                                 ch = *format++;
<a name="l00462"></a>00462                                 <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;l&#39;</span>) {        <span class="comment">/* It&#39;s a long long */</span>
<a name="l00463"></a>00463                                         cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> = <a class="code" href="snprintf_8c.html#a1bea80b78e4b4c33ecd6118eec4ef5c4">DP_C_LLONG</a>;
<a name="l00464"></a>00464                                         ch = *format++;
<a name="l00465"></a>00465                                 }
<a name="l00466"></a>00466                                 <span class="keywordflow">break</span>;
<a name="l00467"></a>00467                         <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:
<a name="l00468"></a>00468                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> = <a class="code" href="snprintf_8c.html#a10f614c6bf9e83aa875f2532a8ec3b72">DP_C_LDOUBLE</a>;
<a name="l00469"></a>00469                                 ch = *format++;
<a name="l00470"></a>00470                                 <span class="keywordflow">break</span>;
<a name="l00471"></a>00471                         <span class="keywordflow">default</span>:
<a name="l00472"></a>00472                                 <span class="keywordflow">break</span>;
<a name="l00473"></a>00473                         }
<a name="l00474"></a>00474                         state = <a class="code" href="snprintf_8c.html#a5c5cb13c4e2e7cc7e6c24e7983f33f0d">DP_S_CONV</a>;
<a name="l00475"></a>00475                         <span class="keywordflow">break</span>;
<a name="l00476"></a>00476                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a5c5cb13c4e2e7cc7e6c24e7983f33f0d">DP_S_CONV</a>:
<a name="l00477"></a>00477                         <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> == 0) cnk-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = ++pnum;
<a name="l00478"></a>00478                         max_pos = add_cnk_list_entry(&amp;clist, max_pos, cnk);
<a name="l00479"></a>00479                         <span class="keywordflow">if</span> (max_pos == 0) <span class="comment">/* out of memory :-( */</span>
<a name="l00480"></a>00480                                 <span class="keywordflow">goto</span> done;
<a name="l00481"></a>00481                         
<a name="l00482"></a>00482                         <span class="keywordflow">switch</span> (ch) {
<a name="l00483"></a>00483                         <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:
<a name="l00484"></a>00484                         <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
<a name="l00485"></a>00485                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a2c3e2e1acbf0c35cdd1b29ac83c7e780">CNK_INT</a>;
<a name="l00486"></a>00486                                 <span class="keywordflow">break</span>;
<a name="l00487"></a>00487                         <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:
<a name="l00488"></a>00488                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#ae027eff2e9cf808a617b2005da51b0d7">CNK_OCTAL</a>;
<a name="l00489"></a>00489                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#a5bba823d29a1fa78f0af99247ed7ce4b">DP_F_UNSIGNED</a>;
<a name="l00490"></a>00490                                 <span class="keywordflow">break</span>;
<a name="l00491"></a>00491                         <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:
<a name="l00492"></a>00492                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a5b707bb1eb93a3d1c6de9b8d09d19f9a">CNK_UINT</a>;
<a name="l00493"></a>00493                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#a5bba823d29a1fa78f0af99247ed7ce4b">DP_F_UNSIGNED</a>;
<a name="l00494"></a>00494                                 <span class="keywordflow">break</span>;
<a name="l00495"></a>00495                         <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:
<a name="l00496"></a>00496                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#ade0ac028a34862464bc3f6df8c3e1655">DP_F_UP</a>;
<a name="l00497"></a>00497                         <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:
<a name="l00498"></a>00498                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#aee489577f0d600798efb7a29f9be9af4">CNK_HEX</a>;
<a name="l00499"></a>00499                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#a5bba823d29a1fa78f0af99247ed7ce4b">DP_F_UNSIGNED</a>;
<a name="l00500"></a>00500                                 <span class="keywordflow">break</span>;
<a name="l00501"></a>00501                         <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:
<a name="l00502"></a>00502                                 <span class="comment">/* hex float not supported yet */</span>
<a name="l00503"></a>00503                         <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:
<a name="l00504"></a>00504                         <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>:
<a name="l00505"></a>00505                         <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>:
<a name="l00506"></a>00506                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> |= <a class="code" href="snprintf_8c.html#ade0ac028a34862464bc3f6df8c3e1655">DP_F_UP</a>;
<a name="l00507"></a>00507                         <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:
<a name="l00508"></a>00508                                 <span class="comment">/* hex float not supported yet */</span>
<a name="l00509"></a>00509                         <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:
<a name="l00510"></a>00510                         <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:
<a name="l00511"></a>00511                         <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:
<a name="l00512"></a>00512                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a56fe6bed46ffce0270a4879f093ce7b1">CNK_FLOAT</a>;
<a name="l00513"></a>00513                                 <span class="keywordflow">break</span>;
<a name="l00514"></a>00514                         <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l00515"></a>00515                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a91f7f4da6fdfe9f3ec3b83ed0392e65e">CNK_CHAR</a>;
<a name="l00516"></a>00516                                 <span class="keywordflow">break</span>;
<a name="l00517"></a>00517                         <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:
<a name="l00518"></a>00518                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#aa064eec79890f8b4882d8a9211c49e6a">CNK_STRING</a>;
<a name="l00519"></a>00519                                 <span class="keywordflow">break</span>;
<a name="l00520"></a>00520                         <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:
<a name="l00521"></a>00521                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a13e796f538b676ce50d3836cdcdc8bfb">CNK_PTR</a>;
<a name="l00522"></a>00522                                 <span class="keywordflow">break</span>;
<a name="l00523"></a>00523                         <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:
<a name="l00524"></a>00524                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a2e967eb28d85072b3b8c6d670e0febe9">CNK_NUM</a>;
<a name="l00525"></a>00525                                 <span class="keywordflow">break</span>;
<a name="l00526"></a>00526                         <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>:
<a name="l00527"></a>00527                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = <a class="code" href="snprintf_8c.html#a328ae7d867d206b64cd453f2e44028d5">CNK_PRCNT</a>;
<a name="l00528"></a>00528                                 <span class="keywordflow">break</span>;
<a name="l00529"></a>00529                         <span class="keywordflow">default</span>:
<a name="l00530"></a>00530                                 <span class="comment">/* Unknown, bail out*/</span>
<a name="l00531"></a>00531                                 <span class="keywordflow">goto</span> done;
<a name="l00532"></a>00532                         }
<a name="l00533"></a>00533                         ch = *format++;
<a name="l00534"></a>00534                         state = <a class="code" href="snprintf_8c.html#a06f85126be2ac5e9b465c28aa49bbb4c">DP_S_DEFAULT</a>;
<a name="l00535"></a>00535                         <span class="keywordflow">break</span>;
<a name="l00536"></a>00536                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#aab820119243e5a85595852bc02adbfff">DP_S_DONE</a>:
<a name="l00537"></a>00537                         <span class="keywordflow">break</span>;
<a name="l00538"></a>00538                 <span class="keywordflow">default</span>:
<a name="l00539"></a>00539                         <span class="comment">/* hmm? */</span>
<a name="l00540"></a>00540                         <span class="keywordflow">break</span>; <span class="comment">/* some picky compilers need this */</span>
<a name="l00541"></a>00541                 }
<a name="l00542"></a>00542         }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <span class="comment">/* retieve the format arguments */</span>
<a name="l00545"></a>00545         <span class="keywordflow">for</span> (pnum = 0; pnum &lt; max_pos; pnum++) {
<a name="l00546"></a>00546                 <span class="keywordtype">int</span> i;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548                 <span class="keywordflow">if</span> (clist[pnum].num == 0) {
<a name="l00549"></a>00549                         <span class="comment">/* ignoring a parameter should not be permitted</span>
<a name="l00550"></a>00550 <span class="comment">                         * all parameters must be matched at least once</span>
<a name="l00551"></a>00551 <span class="comment">                         * BUT seem some system ignore this rule ...</span>
<a name="l00552"></a>00552 <span class="comment">                         * at least my glibc based system does --SSS</span>
<a name="l00553"></a>00553 <span class="comment">                         */</span>
<a name="l00554"></a>00554 <span class="preprocessor">#ifdef DEBUG_SNPRINTF</span>
<a name="l00555"></a>00555 <span class="preprocessor"></span>                        printf(<span class="stringliteral">&quot;parameter at position %d not used\n&quot;</span>, pnum+1);
<a name="l00556"></a>00556 <span class="preprocessor">#endif</span>
<a name="l00557"></a>00557 <span class="preprocessor"></span>                        <span class="comment">/* eat the parameter */</span>
<a name="l00558"></a>00558                         va_arg (args, <span class="keywordtype">int</span>);
<a name="l00559"></a>00559                         <span class="keywordflow">continue</span>;
<a name="l00560"></a>00560                 }
<a name="l00561"></a>00561                 <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00562"></a>00562                         <span class="keywordflow">if</span> (clist[pnum].chunks[0]-&gt;type != clist[pnum].chunks[i]-&gt;type) {
<a name="l00563"></a>00563                                 <span class="comment">/* nooo noo no!</span>
<a name="l00564"></a>00564 <span class="comment">                                 * all the references to a parameter</span>
<a name="l00565"></a>00565 <span class="comment">                                 * must be of the same type</span>
<a name="l00566"></a>00566 <span class="comment">                                 */</span>
<a name="l00567"></a>00567                                 <span class="keywordflow">goto</span> done;
<a name="l00568"></a>00568                         }
<a name="l00569"></a>00569                 }
<a name="l00570"></a>00570                 cnk = clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[0];
<a name="l00571"></a>00571                 <span class="keywordflow">switch</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a>) {
<a name="l00572"></a>00572                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a2c3e2e1acbf0c35cdd1b29ac83c7e780">CNK_INT</a>:
<a name="l00573"></a>00573                         <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a9ca61e4b3744be23de3649e82bba6832">DP_C_SHORT</a>) 
<a name="l00574"></a>00574                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = va_arg (args, <span class="keywordtype">int</span>);
<a name="l00575"></a>00575                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#ad63b7444b754b2553d116c5549e52c1f">DP_C_LONG</a>)
<a name="l00576"></a>00576                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = va_arg (args, <span class="keywordtype">long</span> <span class="keywordtype">int</span>);
<a name="l00577"></a>00577                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a1bea80b78e4b4c33ecd6118eec4ef5c4">DP_C_LLONG</a>)
<a name="l00578"></a>00578                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = va_arg (args, <a class="code" href="snprintf_8c.html#ae006f2462b4e9d250265e5cf8e439e0e">LLONG</a>);
<a name="l00579"></a>00579                         <span class="keywordflow">else</span>
<a name="l00580"></a>00580                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = va_arg (args, <span class="keywordtype">int</span>);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582                         <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00583"></a>00583                                 clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[i]-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>;
<a name="l00584"></a>00584                         }
<a name="l00585"></a>00585                         <span class="keywordflow">break</span>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#ae027eff2e9cf808a617b2005da51b0d7">CNK_OCTAL</a>:
<a name="l00588"></a>00588                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a5b707bb1eb93a3d1c6de9b8d09d19f9a">CNK_UINT</a>:
<a name="l00589"></a>00589                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#aee489577f0d600798efb7a29f9be9af4">CNK_HEX</a>:
<a name="l00590"></a>00590                         <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a9ca61e4b3744be23de3649e82bba6832">DP_C_SHORT</a>)
<a name="l00591"></a>00591                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = va_arg (args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
<a name="l00592"></a>00592                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#ad63b7444b754b2553d116c5549e52c1f">DP_C_LONG</a>)
<a name="l00593"></a>00593                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = (long)va_arg (args, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>);
<a name="l00594"></a>00594                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a1bea80b78e4b4c33ecd6118eec4ef5c4">DP_C_LLONG</a>)
<a name="l00595"></a>00595                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = (<a class="code" href="snprintf_8c.html#ae006f2462b4e9d250265e5cf8e439e0e">LLONG</a>)va_arg (args, <span class="keywordtype">unsigned</span> <a class="code" href="snprintf_8c.html#ae006f2462b4e9d250265e5cf8e439e0e">LLONG</a>);
<a name="l00596"></a>00596                         <span class="keywordflow">else</span>
<a name="l00597"></a>00597                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = (long)va_arg (args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599                         <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00600"></a>00600                                 clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[i]-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>;
<a name="l00601"></a>00601                         }
<a name="l00602"></a>00602                         <span class="keywordflow">break</span>;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a56fe6bed46ffce0270a4879f093ce7b1">CNK_FLOAT</a>:
<a name="l00605"></a>00605                         <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a10f614c6bf9e83aa875f2532a8ec3b72">DP_C_LDOUBLE</a>)
<a name="l00606"></a>00606                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a> = va_arg (args, <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a>);
<a name="l00607"></a>00607                         <span class="keywordflow">else</span>
<a name="l00608"></a>00608                                 cnk-&gt;<a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a> = va_arg (args, <span class="keywordtype">double</span>);
<a name="l00609"></a>00609 
<a name="l00610"></a>00610                         <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00611"></a>00611                                 clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[i]-&gt;<a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a>;
<a name="l00612"></a>00612                         }
<a name="l00613"></a>00613                         <span class="keywordflow">break</span>;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a91f7f4da6fdfe9f3ec3b83ed0392e65e">CNK_CHAR</a>:
<a name="l00616"></a>00616                         cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = va_arg (args, <span class="keywordtype">int</span>);
<a name="l00617"></a>00617 
<a name="l00618"></a>00618                         <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00619"></a>00619                                 clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[i]-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>;
<a name="l00620"></a>00620                         }
<a name="l00621"></a>00621                         <span class="keywordflow">break</span>;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#aa064eec79890f8b4882d8a9211c49e6a">CNK_STRING</a>:
<a name="l00624"></a>00624                         cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a> = va_arg (args, <span class="keywordtype">char</span> *);
<a name="l00625"></a>00625                         <span class="keywordflow">if</span> (!cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a>) cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a> = <span class="stringliteral">&quot;(NULL)&quot;</span>;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627                         <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00628"></a>00628                                 clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[i]-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a>;
<a name="l00629"></a>00629                         }
<a name="l00630"></a>00630                         <span class="keywordflow">break</span>;
<a name="l00631"></a>00631 
<a name="l00632"></a>00632                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a13e796f538b676ce50d3836cdcdc8bfb">CNK_PTR</a>:
<a name="l00633"></a>00633                         cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a> = va_arg (args, <span class="keywordtype">void</span> *);
<a name="l00634"></a>00634                         <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00635"></a>00635                                 clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[i]-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a>;
<a name="l00636"></a>00636                         }
<a name="l00637"></a>00637                         <span class="keywordflow">break</span>;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a2e967eb28d85072b3b8c6d670e0febe9">CNK_NUM</a>:
<a name="l00640"></a>00640                         <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#aa8520b359619d83e679acae970101f0c">DP_C_CHAR</a>)
<a name="l00641"></a>00641                                 cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a> = va_arg (args, <span class="keywordtype">char</span> *);
<a name="l00642"></a>00642                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a9ca61e4b3744be23de3649e82bba6832">DP_C_SHORT</a>)
<a name="l00643"></a>00643                                 cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a> = va_arg (args, <span class="keywordtype">short</span> <span class="keywordtype">int</span> *);
<a name="l00644"></a>00644                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#ad63b7444b754b2553d116c5549e52c1f">DP_C_LONG</a>)
<a name="l00645"></a>00645                                 cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a> = va_arg (args, <span class="keywordtype">long</span> <span class="keywordtype">int</span> *);
<a name="l00646"></a>00646                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a1bea80b78e4b4c33ecd6118eec4ef5c4">DP_C_LLONG</a>)
<a name="l00647"></a>00647                                 cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a> = va_arg (args, LLONG *);
<a name="l00648"></a>00648                         <span class="keywordflow">else</span>
<a name="l00649"></a>00649                                 cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a> = va_arg (args, <span class="keywordtype">int</span> *);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651                         <span class="keywordflow">for</span> (i = 1; i &lt; clist[pnum].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>; i++) {
<a name="l00652"></a>00652                                 clist[pnum].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>[i]-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a> = cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>;
<a name="l00653"></a>00653                         }
<a name="l00654"></a>00654                         <span class="keywordflow">break</span>;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a328ae7d867d206b64cd453f2e44028d5">CNK_PRCNT</a>:
<a name="l00657"></a>00657                         <span class="keywordflow">break</span>;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659                 <span class="keywordflow">default</span>:
<a name="l00660"></a>00660                         <span class="comment">/* what ?? */</span>
<a name="l00661"></a>00661                         <span class="keywordflow">goto</span> done;
<a name="l00662"></a>00662                 }
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664         <span class="comment">/* print out the actual string from chunks */</span>
<a name="l00665"></a>00665         currlen = 0;
<a name="l00666"></a>00666         cnk = <a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a>;
<a name="l00667"></a>00667         <span class="keywordflow">while</span> (cnk) {
<a name="l00668"></a>00668                 <span class="keywordtype">int</span> len, <a class="code" href="avail_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670                 <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>) min = cnk-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a>-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>;
<a name="l00671"></a>00671                 <span class="keywordflow">else</span> min = cnk-&gt;<a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a>;
<a name="l00672"></a>00672                 <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>) max = cnk-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a>-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>;
<a name="l00673"></a>00673                 <span class="keywordflow">else</span> max = cnk-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a>;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675                 <span class="keywordflow">switch</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a>) {
<a name="l00676"></a>00676 
<a name="l00677"></a>00677                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#adde92565b3ad073250f3331f3d18cfd8">CNK_FMT_STR</a>:
<a name="l00678"></a>00678                         <span class="keywordflow">if</span> (maxlen != 0 &amp;&amp; maxlen &gt; currlen) {
<a name="l00679"></a>00679                                 <span class="keywordflow">if</span> (maxlen &gt; (currlen + cnk-&gt;<a class="code" href="structpr__chunk.html#a201fd59e460bbf3b72d68eb232f6d003">len</a>)) len = cnk-&gt;<a class="code" href="structpr__chunk.html#a201fd59e460bbf3b72d68eb232f6d003">len</a>;
<a name="l00680"></a>00680                                 <span class="keywordflow">else</span> len = maxlen - currlen;
<a name="l00681"></a>00681 
<a name="l00682"></a>00682                                 memcpy(&amp;(buffer[currlen]), &amp;(base[cnk-&gt;<a class="code" href="structpr__chunk.html#a2356e51541dbe18e18c588fb076a95cb">start</a>]), len);
<a name="l00683"></a>00683                         }
<a name="l00684"></a>00684                         currlen += cnk-&gt;<a class="code" href="structpr__chunk.html#a201fd59e460bbf3b72d68eb232f6d003">len</a>;
<a name="l00685"></a>00685                                 
<a name="l00686"></a>00686                         <span class="keywordflow">break</span>;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a2c3e2e1acbf0c35cdd1b29ac83c7e780">CNK_INT</a>:
<a name="l00689"></a>00689                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a5b707bb1eb93a3d1c6de9b8d09d19f9a">CNK_UINT</a>:
<a name="l00690"></a>00690                         fmtint (buffer, &amp;currlen, maxlen, cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>, 10, min, max, cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>);
<a name="l00691"></a>00691                         <span class="keywordflow">break</span>;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#ae027eff2e9cf808a617b2005da51b0d7">CNK_OCTAL</a>:
<a name="l00694"></a>00694                         fmtint (buffer, &amp;currlen, maxlen, cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>, 8, min, max, cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>);
<a name="l00695"></a>00695                         <span class="keywordflow">break</span>;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#aee489577f0d600798efb7a29f9be9af4">CNK_HEX</a>:
<a name="l00698"></a>00698                         fmtint (buffer, &amp;currlen, maxlen, cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>, 16, min, max, cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>);
<a name="l00699"></a>00699                         <span class="keywordflow">break</span>;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a56fe6bed46ffce0270a4879f093ce7b1">CNK_FLOAT</a>:
<a name="l00702"></a>00702                         fmtfp (buffer, &amp;currlen, maxlen, cnk-&gt;<a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a>, min, max, cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>);
<a name="l00703"></a>00703                         <span class="keywordflow">break</span>;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a91f7f4da6fdfe9f3ec3b83ed0392e65e">CNK_CHAR</a>:
<a name="l00706"></a>00706                         dopr_outch (buffer, &amp;currlen, maxlen, cnk-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a>);
<a name="l00707"></a>00707                         <span class="keywordflow">break</span>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#aa064eec79890f8b4882d8a9211c49e6a">CNK_STRING</a>:
<a name="l00710"></a>00710                         <span class="keywordflow">if</span> (max == -1) {
<a name="l00711"></a>00711                                 max = strlen(cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a>);
<a name="l00712"></a>00712                         }
<a name="l00713"></a>00713                         fmtstr (buffer, &amp;currlen, maxlen, cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a>, cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>, min, max);
<a name="l00714"></a>00714                         <span class="keywordflow">break</span>;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a13e796f538b676ce50d3836cdcdc8bfb">CNK_PTR</a>:
<a name="l00717"></a>00717                         fmtint (buffer, &amp;currlen, maxlen, (<span class="keywordtype">long</span>)(cnk-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a>), 16, min, max, cnk-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a>);
<a name="l00718"></a>00718                         <span class="keywordflow">break</span>;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a2e967eb28d85072b3b8c6d670e0febe9">CNK_NUM</a>:
<a name="l00721"></a>00721                         <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#aa8520b359619d83e679acae970101f0c">DP_C_CHAR</a>)
<a name="l00722"></a>00722                                 *((<span class="keywordtype">char</span> *)(cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>)) = (<span class="keywordtype">char</span>)currlen;
<a name="l00723"></a>00723                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a9ca61e4b3744be23de3649e82bba6832">DP_C_SHORT</a>)
<a name="l00724"></a>00724                                 *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *)(cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>)) = (<span class="keywordtype">short</span> <span class="keywordtype">int</span>)currlen;
<a name="l00725"></a>00725                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#ad63b7444b754b2553d116c5549e52c1f">DP_C_LONG</a>)
<a name="l00726"></a>00726                                 *((<span class="keywordtype">long</span> <span class="keywordtype">int</span> *)(cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>)) = (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)currlen;
<a name="l00727"></a>00727                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cnk-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> == <a class="code" href="snprintf_8c.html#a1bea80b78e4b4c33ecd6118eec4ef5c4">DP_C_LLONG</a>)
<a name="l00728"></a>00728                                 *((LLONG *)(cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>)) = (LLONG)currlen;
<a name="l00729"></a>00729                         <span class="keywordflow">else</span>
<a name="l00730"></a>00730                                 *((<span class="keywordtype">int</span> *)(cnk-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a>)) = (<span class="keywordtype">int</span>)currlen;
<a name="l00731"></a>00731                         <span class="keywordflow">break</span>;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733                 <span class="keywordflow">case</span> <a class="code" href="snprintf_8c.html#a328ae7d867d206b64cd453f2e44028d5">CNK_PRCNT</a>:
<a name="l00734"></a>00734                         dopr_outch (buffer, &amp;currlen, maxlen, <span class="charliteral">&#39;%&#39;</span>);
<a name="l00735"></a>00735                         <span class="keywordflow">break</span>;
<a name="l00736"></a>00736 
<a name="l00737"></a>00737                 <span class="keywordflow">default</span>:
<a name="l00738"></a>00738                         <span class="comment">/* what ?? */</span>
<a name="l00739"></a>00739                         <span class="keywordflow">goto</span> done;
<a name="l00740"></a>00740                 }
<a name="l00741"></a>00741                 cnk = cnk-&gt;<a class="code" href="structpr__chunk.html#a913fae0bb85df118e9b1b738810d8225">next</a>;
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743         <span class="keywordflow">if</span> (maxlen != 0) {
<a name="l00744"></a>00744                 <span class="keywordflow">if</span> (currlen &lt; maxlen - 1) 
<a name="l00745"></a>00745                         buffer[currlen] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00746"></a>00746                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxlen &gt; 0) 
<a name="l00747"></a>00747                         buffer[maxlen - 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00748"></a>00748         }
<a name="l00749"></a>00749         ret = currlen;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 done:
<a name="l00752"></a>00752         <span class="keywordflow">while</span> (chunks) {
<a name="l00753"></a>00753                 cnk = chunks-&gt;<a class="code" href="structpr__chunk.html#a913fae0bb85df118e9b1b738810d8225">next</a>;
<a name="l00754"></a>00754                 free(chunks);
<a name="l00755"></a>00755                 chunks = cnk;
<a name="l00756"></a>00756         }
<a name="l00757"></a>00757         <span class="keywordflow">if</span> (clist) {
<a name="l00758"></a>00758                 <span class="keywordflow">for</span> (pnum = 0; pnum &lt; max_pos; pnum++) {
<a name="l00759"></a>00759                         <span class="keywordflow">if</span> (clist[pnum].chunks) free(clist[pnum].chunks);
<a name="l00760"></a>00760                 }
<a name="l00761"></a>00761                 free(clist);
<a name="l00762"></a>00762         }
<a name="l00763"></a>00763         <span class="keywordflow">return</span> ret;
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 <span class="keyword">static</span> <span class="keywordtype">void</span> fmtstr(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen,
<a name="l00767"></a>00767                     <span class="keywordtype">char</span> *value, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> min, <span class="keywordtype">int</span> max)
<a name="l00768"></a>00768 {
<a name="l00769"></a>00769         <span class="keywordtype">int</span> padlen, strln;     <span class="comment">/* amount to pad */</span>
<a name="l00770"></a>00770         <span class="keywordtype">int</span> cnt = 0;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="preprocessor">#ifdef DEBUG_SNPRINTF</span>
<a name="l00773"></a>00773 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;fmtstr min=%d max=%d s=[%s]\n&quot;</span>, min, max, value);
<a name="l00774"></a>00774 <span class="preprocessor">#endif</span>
<a name="l00775"></a>00775 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (value == 0) {
<a name="l00776"></a>00776                 value = <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>;
<a name="l00777"></a>00777         }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         <span class="keywordflow">for</span> (strln = 0; strln &lt; max &amp;&amp; value[strln]; ++strln); <span class="comment">/* strlen */</span>
<a name="l00780"></a>00780         padlen = min - strln;
<a name="l00781"></a>00781         <span class="keywordflow">if</span> (padlen &lt; 0) 
<a name="l00782"></a>00782                 padlen = 0;
<a name="l00783"></a>00783         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="snprintf_8c.html#a4fd01adc98f6d334be078955f37f71bc">DP_F_MINUS</a>) 
<a name="l00784"></a>00784                 padlen = -padlen; <span class="comment">/* Left Justify */</span>
<a name="l00785"></a>00785         
<a name="l00786"></a>00786         <span class="keywordflow">while</span> (padlen &gt; 0) {
<a name="l00787"></a>00787                 dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39; &#39;</span>);
<a name="l00788"></a>00788                 --padlen;
<a name="l00789"></a>00789         }
<a name="l00790"></a>00790         <span class="keywordflow">while</span> (*value &amp;&amp; (cnt &lt; max)) {
<a name="l00791"></a>00791                 dopr_outch (buffer, currlen, maxlen, *value++);
<a name="l00792"></a>00792                 ++cnt;
<a name="l00793"></a>00793         }
<a name="l00794"></a>00794         <span class="keywordflow">while</span> (padlen &lt; 0) {
<a name="l00795"></a>00795                 dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39; &#39;</span>);
<a name="l00796"></a>00796                 ++padlen;
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 <span class="comment">/* Have to handle DP_F_NUM (ie 0x and 0 alternates) */</span>
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 <span class="keyword">static</span> <span class="keywordtype">void</span> fmtint(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen,
<a name="l00803"></a>00803                     <span class="keywordtype">long</span> value, <span class="keywordtype">int</span> base, <span class="keywordtype">int</span> min, <span class="keywordtype">int</span> max, <span class="keywordtype">int</span> flags)
<a name="l00804"></a>00804 {
<a name="l00805"></a>00805         <span class="keywordtype">int</span> signvalue = 0;
<a name="l00806"></a>00806         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> uvalue;
<a name="l00807"></a>00807         <span class="keywordtype">char</span> convert[20];
<a name="l00808"></a>00808         <span class="keywordtype">int</span> place = 0;
<a name="l00809"></a>00809         <span class="keywordtype">int</span> spadlen = 0; <span class="comment">/* amount to space pad */</span>
<a name="l00810"></a>00810         <span class="keywordtype">int</span> zpadlen = 0; <span class="comment">/* amount to zero pad */</span>
<a name="l00811"></a>00811         <span class="keywordtype">int</span> caps = 0;
<a name="l00812"></a>00812         
<a name="l00813"></a>00813         <span class="keywordflow">if</span> (max &lt; 0)
<a name="l00814"></a>00814                 max = 0;
<a name="l00815"></a>00815         
<a name="l00816"></a>00816         uvalue = value;
<a name="l00817"></a>00817         
<a name="l00818"></a>00818         <span class="keywordflow">if</span>(!(flags &amp; <a class="code" href="snprintf_8c.html#a5bba823d29a1fa78f0af99247ed7ce4b">DP_F_UNSIGNED</a>)) {
<a name="l00819"></a>00819                 <span class="keywordflow">if</span>( value &lt; 0 ) {
<a name="l00820"></a>00820                         signvalue = <span class="charliteral">&#39;-&#39;</span>;
<a name="l00821"></a>00821                         uvalue = -value;
<a name="l00822"></a>00822                 } <span class="keywordflow">else</span> {
<a name="l00823"></a>00823                         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="snprintf_8c.html#a73d477ab19689194a5099be5258e18b5">DP_F_PLUS</a>)  <span class="comment">/* Do a sign (+/i) */</span>
<a name="l00824"></a>00824                                 signvalue = <span class="charliteral">&#39;+&#39;</span>;
<a name="l00825"></a>00825                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="snprintf_8c.html#a7a5d2b21cb1b1a05bf30789675ad6dee">DP_F_SPACE</a>)
<a name="l00826"></a>00826                                 signvalue = <span class="charliteral">&#39; &#39;</span>;
<a name="l00827"></a>00827                 }
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829   
<a name="l00830"></a>00830         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="snprintf_8c.html#ade0ac028a34862464bc3f6df8c3e1655">DP_F_UP</a>) caps = 1; <span class="comment">/* Should characters be upper case? */</span>
<a name="l00831"></a>00831 
<a name="l00832"></a>00832         <span class="keywordflow">do</span> {
<a name="l00833"></a>00833                 convert[place++] =
<a name="l00834"></a>00834                         (caps? <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>:<span class="stringliteral">&quot;0123456789abcdef&quot;</span>)
<a name="l00835"></a>00835                         [uvalue % (<span class="keywordtype">unsigned</span>)base  ];
<a name="l00836"></a>00836                 uvalue = (uvalue / (unsigned)base );
<a name="l00837"></a>00837         } <span class="keywordflow">while</span>(uvalue &amp;&amp; (place &lt; 20));
<a name="l00838"></a>00838         <span class="keywordflow">if</span> (place == 20) place--;
<a name="l00839"></a>00839         convert[place] = 0;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841         zpadlen = max - place;
<a name="l00842"></a>00842         spadlen = min - <a class="code" href="snprintf_8c.html#a496190eeefc692949639de03f8f18e59">MAX</a> (max, place) - (signvalue ? 1 : 0);
<a name="l00843"></a>00843         <span class="keywordflow">if</span> (zpadlen &lt; 0) zpadlen = 0;
<a name="l00844"></a>00844         <span class="keywordflow">if</span> (spadlen &lt; 0) spadlen = 0;
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="snprintf_8c.html#ada4f2c34e03ad39b57c1b443c0f56bbd">DP_F_ZERO</a>) {
<a name="l00846"></a>00846                 zpadlen = <a class="code" href="snprintf_8c.html#a496190eeefc692949639de03f8f18e59">MAX</a>(zpadlen, spadlen);
<a name="l00847"></a>00847                 spadlen = 0;
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849         <span class="keywordflow">if</span> (flags &amp; DP_F_MINUS) 
<a name="l00850"></a>00850                 spadlen = -spadlen; <span class="comment">/* Left Justifty */</span>
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 <span class="preprocessor">#ifdef DEBUG_SNPRINTF</span>
<a name="l00853"></a>00853 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;zpad: %d, spad: %d, min: %d, max: %d, place: %d\n&quot;</span>,
<a name="l00854"></a>00854                zpadlen, spadlen, min, max, place);
<a name="l00855"></a>00855 <span class="preprocessor">#endif</span>
<a name="l00856"></a>00856 <span class="preprocessor"></span>
<a name="l00857"></a>00857         <span class="comment">/* Spaces */</span>
<a name="l00858"></a>00858         <span class="keywordflow">while</span> (spadlen &gt; 0) {
<a name="l00859"></a>00859                 dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39; &#39;</span>);
<a name="l00860"></a>00860                 --spadlen;
<a name="l00861"></a>00861         }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863         <span class="comment">/* Sign */</span>
<a name="l00864"></a>00864         <span class="keywordflow">if</span> (signvalue) 
<a name="l00865"></a>00865                 dopr_outch (buffer, currlen, maxlen, signvalue);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867         <span class="comment">/* Zeros */</span>
<a name="l00868"></a>00868         <span class="keywordflow">if</span> (zpadlen &gt; 0) {
<a name="l00869"></a>00869                 <span class="keywordflow">while</span> (zpadlen &gt; 0) {
<a name="l00870"></a>00870                         dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00871"></a>00871                         --zpadlen;
<a name="l00872"></a>00872                 }
<a name="l00873"></a>00873         }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="comment">/* Digits */</span>
<a name="l00876"></a>00876         <span class="keywordflow">while</span> (place &gt; 0) 
<a name="l00877"></a>00877                 dopr_outch (buffer, currlen, maxlen, convert[--place]);
<a name="l00878"></a>00878   
<a name="l00879"></a>00879         <span class="comment">/* Left Justified spaces */</span>
<a name="l00880"></a>00880         <span class="keywordflow">while</span> (spadlen &lt; 0) {
<a name="l00881"></a>00881                 dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39; &#39;</span>);
<a name="l00882"></a>00882                 ++spadlen;
<a name="l00883"></a>00883         }
<a name="l00884"></a>00884 }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 <span class="keyword">static</span> <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> abs_val(<a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> value)
<a name="l00887"></a>00887 {
<a name="l00888"></a>00888         <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> result = value;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890         <span class="keywordflow">if</span> (value &lt; 0)
<a name="l00891"></a>00891                 result = -value;
<a name="l00892"></a>00892         
<a name="l00893"></a>00893         <span class="keywordflow">return</span> result;
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="keyword">static</span> <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> POW10(<span class="keywordtype">int</span> exp)
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898         <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> result = 1;
<a name="l00899"></a>00899         
<a name="l00900"></a>00900         <span class="keywordflow">while</span> (exp) {
<a name="l00901"></a>00901                 result *= 10;
<a name="l00902"></a>00902                 exp--;
<a name="l00903"></a>00903         }
<a name="l00904"></a>00904   
<a name="l00905"></a>00905         <span class="keywordflow">return</span> result;
<a name="l00906"></a>00906 }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908 <span class="keyword">static</span> LLONG ROUND(<a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> value)
<a name="l00909"></a>00909 {
<a name="l00910"></a>00910         LLONG intpart;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         intpart = (<a class="code" href="snprintf_8c.html#ae006f2462b4e9d250265e5cf8e439e0e">LLONG</a>)value;
<a name="l00913"></a>00913         value = value - intpart;
<a name="l00914"></a>00914         <span class="keywordflow">if</span> (value &gt;= 0.5) intpart++;
<a name="l00915"></a>00915         
<a name="l00916"></a>00916         <span class="keywordflow">return</span> intpart;
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 <span class="comment">/* a replacement for modf that doesn&#39;t need the math library. Should</span>
<a name="l00920"></a>00920 <span class="comment">   be portable, but slow */</span>
<a name="l00921"></a>00921 <span class="keyword">static</span> <span class="keywordtype">double</span> my_modf(<span class="keywordtype">double</span> x0, <span class="keywordtype">double</span> *iptr)
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923         <span class="keywordtype">int</span> i;
<a name="l00924"></a>00924         <span class="keywordtype">long</span> l;
<a name="l00925"></a>00925         <span class="keywordtype">double</span> x = x0;
<a name="l00926"></a>00926         <span class="keywordtype">double</span> f = 1.0;
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         <span class="keywordflow">for</span> (i=0;i&lt;100;i++) {
<a name="l00929"></a>00929                 l = (long)x;
<a name="l00930"></a>00930                 <span class="keywordflow">if</span> (l &lt;= (x+1) &amp;&amp; l &gt;= (x-1)) <span class="keywordflow">break</span>;
<a name="l00931"></a>00931                 x *= 0.1;
<a name="l00932"></a>00932                 f *= 10.0;
<a name="l00933"></a>00933         }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935         <span class="keywordflow">if</span> (i == 100) {
<a name="l00936"></a>00936                 <span class="comment">/* yikes! the number is beyond what we can handle. What do we do? */</span>
<a name="l00937"></a>00937                 (*iptr) = 0;
<a name="l00938"></a>00938                 <span class="keywordflow">return</span> 0;
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         <span class="keywordflow">if</span> (i != 0) {
<a name="l00942"></a>00942                 <span class="keywordtype">double</span> i2;
<a name="l00943"></a>00943                 <span class="keywordtype">double</span> ret;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945                 ret = my_modf(x0-l*f, &amp;i2);
<a name="l00946"></a>00946                 (*iptr) = l*f + i2;
<a name="l00947"></a>00947                 <span class="keywordflow">return</span> ret;
<a name="l00948"></a>00948         } 
<a name="l00949"></a>00949 
<a name="l00950"></a>00950         (*iptr) = l;
<a name="l00951"></a>00951         <span class="keywordflow">return</span> x - (*iptr);
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 <span class="keyword">static</span> <span class="keywordtype">void</span> fmtfp (<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen,
<a name="l00956"></a>00956                    <a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a> fvalue, <span class="keywordtype">int</span> min, <span class="keywordtype">int</span> max, <span class="keywordtype">int</span> flags)
<a name="l00957"></a>00957 {
<a name="l00958"></a>00958         <span class="keywordtype">int</span> signvalue = 0;
<a name="l00959"></a>00959         <span class="keywordtype">double</span> ufvalue;
<a name="l00960"></a>00960         <span class="keywordtype">char</span> iconvert[311];
<a name="l00961"></a>00961         <span class="keywordtype">char</span> fconvert[311];
<a name="l00962"></a>00962         <span class="keywordtype">int</span> iplace = 0;
<a name="l00963"></a>00963         <span class="keywordtype">int</span> fplace = 0;
<a name="l00964"></a>00964         <span class="keywordtype">int</span> padlen = 0; <span class="comment">/* amount to pad */</span>
<a name="l00965"></a>00965         <span class="keywordtype">int</span> zpadlen = 0; 
<a name="l00966"></a>00966         <span class="keywordtype">int</span> caps = 0;
<a name="l00967"></a>00967         <span class="keywordtype">int</span> idx;
<a name="l00968"></a>00968         <span class="keywordtype">double</span> intpart;
<a name="l00969"></a>00969         <span class="keywordtype">double</span> fracpart;
<a name="l00970"></a>00970         <span class="keywordtype">double</span> temp;
<a name="l00971"></a>00971   
<a name="l00972"></a>00972         <span class="comment">/* </span>
<a name="l00973"></a>00973 <span class="comment">         * AIX manpage says the default is 0, but Solaris says the default</span>
<a name="l00974"></a>00974 <span class="comment">         * is 6, and sprintf on AIX defaults to 6</span>
<a name="l00975"></a>00975 <span class="comment">         */</span>
<a name="l00976"></a>00976         <span class="keywordflow">if</span> (max &lt; 0)
<a name="l00977"></a>00977                 max = 6;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979         ufvalue = abs_val (fvalue);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981         <span class="keywordflow">if</span> (fvalue &lt; 0) {
<a name="l00982"></a>00982                 signvalue = <span class="charliteral">&#39;-&#39;</span>;
<a name="l00983"></a>00983         } <span class="keywordflow">else</span> {
<a name="l00984"></a>00984                 <span class="keywordflow">if</span> (flags &amp; <a class="code" href="snprintf_8c.html#a73d477ab19689194a5099be5258e18b5">DP_F_PLUS</a>) { <span class="comment">/* Do a sign (+/i) */</span>
<a name="l00985"></a>00985                         signvalue = <span class="charliteral">&#39;+&#39;</span>;
<a name="l00986"></a>00986                 } <span class="keywordflow">else</span> {
<a name="l00987"></a>00987                         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="snprintf_8c.html#a7a5d2b21cb1b1a05bf30789675ad6dee">DP_F_SPACE</a>)
<a name="l00988"></a>00988                                 signvalue = <span class="charliteral">&#39; &#39;</span>;
<a name="l00989"></a>00989                 }
<a name="l00990"></a>00990         }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992 <span class="preprocessor">#if 0</span>
<a name="l00993"></a>00993 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (flags &amp; DP_F_UP) caps = 1; <span class="comment">/* Should characters be upper case? */</span>
<a name="l00994"></a>00994 <span class="preprocessor">#endif</span>
<a name="l00995"></a>00995 <span class="preprocessor"></span>
<a name="l00996"></a>00996 <span class="preprocessor">#if 0</span>
<a name="l00997"></a>00997 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (max == 0) ufvalue += 0.5; <span class="comment">/* if max = 0 we must round */</span>
<a name="l00998"></a>00998 <span class="preprocessor">#endif</span>
<a name="l00999"></a>00999 <span class="preprocessor"></span>
<a name="l01000"></a>01000         <span class="comment">/* </span>
<a name="l01001"></a>01001 <span class="comment">         * Sorry, we only support 9 digits past the decimal because of our </span>
<a name="l01002"></a>01002 <span class="comment">         * conversion method</span>
<a name="l01003"></a>01003 <span class="comment">         */</span>
<a name="l01004"></a>01004         <span class="keywordflow">if</span> (max &gt; 9)
<a name="l01005"></a>01005                 max = 9;
<a name="l01006"></a>01006 
<a name="l01007"></a>01007         <span class="comment">/* We &quot;cheat&quot; by converting the fractional part to integer by</span>
<a name="l01008"></a>01008 <span class="comment">         * multiplying by a factor of 10</span>
<a name="l01009"></a>01009 <span class="comment">         */</span>
<a name="l01010"></a>01010 
<a name="l01011"></a>01011         temp = ufvalue;
<a name="l01012"></a>01012         my_modf(temp, &amp;intpart);
<a name="l01013"></a>01013 
<a name="l01014"></a>01014         fracpart = ROUND((POW10(max)) * (ufvalue - intpart));
<a name="l01015"></a>01015         
<a name="l01016"></a>01016         <span class="keywordflow">if</span> (fracpart &gt;= POW10(max)) {
<a name="l01017"></a>01017                 intpart++;
<a name="l01018"></a>01018                 fracpart -= POW10(max);
<a name="l01019"></a>01019         }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 
<a name="l01022"></a>01022         <span class="comment">/* Convert integer part */</span>
<a name="l01023"></a>01023         <span class="keywordflow">do</span> {
<a name="l01024"></a>01024                 temp = intpart*0.1;
<a name="l01025"></a>01025                 my_modf(temp, &amp;intpart);
<a name="l01026"></a>01026                 idx = (int) ((temp -intpart +0.05)* 10.0);
<a name="l01027"></a>01027                 <span class="comment">/* idx = (int) (((double)(temp*0.1) -intpart +0.05) *10.0); */</span>
<a name="l01028"></a>01028                 <span class="comment">/* printf (&quot;%llf, %f, %x\n&quot;, temp, intpart, idx); */</span>
<a name="l01029"></a>01029                 iconvert[iplace++] =
<a name="l01030"></a>01030                         (caps? <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>:<span class="stringliteral">&quot;0123456789abcdef&quot;</span>)[idx];
<a name="l01031"></a>01031         } <span class="keywordflow">while</span> (intpart &amp;&amp; (iplace &lt; 311));
<a name="l01032"></a>01032         <span class="keywordflow">if</span> (iplace == 311) iplace--;
<a name="l01033"></a>01033         iconvert[iplace] = 0;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035         <span class="comment">/* Convert fractional part */</span>
<a name="l01036"></a>01036         <span class="keywordflow">if</span> (fracpart)
<a name="l01037"></a>01037         {
<a name="l01038"></a>01038                 <span class="keywordflow">do</span> {
<a name="l01039"></a>01039                         temp = fracpart*0.1;
<a name="l01040"></a>01040                         my_modf(temp, &amp;fracpart);
<a name="l01041"></a>01041                         idx = (int) ((temp -fracpart +0.05)* 10.0);
<a name="l01042"></a>01042                         <span class="comment">/* idx = (int) ((((temp/10) -fracpart) +0.05) *10); */</span>
<a name="l01043"></a>01043                         <span class="comment">/* printf (&quot;%lf, %lf, %ld\n&quot;, temp, fracpart, idx ); */</span>
<a name="l01044"></a>01044                         fconvert[fplace++] =
<a name="l01045"></a>01045                         (caps? <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>:<span class="stringliteral">&quot;0123456789abcdef&quot;</span>)[idx];
<a name="l01046"></a>01046                 } <span class="keywordflow">while</span>(fracpart &amp;&amp; (fplace &lt; 311));
<a name="l01047"></a>01047                 <span class="keywordflow">if</span> (fplace == 311) fplace--;
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049         fconvert[fplace] = 0;
<a name="l01050"></a>01050   
<a name="l01051"></a>01051         <span class="comment">/* -1 for decimal point, another -1 if we are printing a sign */</span>
<a name="l01052"></a>01052         padlen = min - iplace - max - 1 - ((signvalue) ? 1 : 0); 
<a name="l01053"></a>01053         zpadlen = max - fplace;
<a name="l01054"></a>01054         <span class="keywordflow">if</span> (zpadlen &lt; 0) zpadlen = 0;
<a name="l01055"></a>01055         <span class="keywordflow">if</span> (padlen &lt; 0) 
<a name="l01056"></a>01056                 padlen = 0;
<a name="l01057"></a>01057         <span class="keywordflow">if</span> (flags &amp; DP_F_MINUS) 
<a name="l01058"></a>01058                 padlen = -padlen; <span class="comment">/* Left Justifty */</span>
<a name="l01059"></a>01059         
<a name="l01060"></a>01060         <span class="keywordflow">if</span> ((flags &amp; DP_F_ZERO) &amp;&amp; (padlen &gt; 0)) {
<a name="l01061"></a>01061                 <span class="keywordflow">if</span> (signvalue) {
<a name="l01062"></a>01062                         dopr_outch (buffer, currlen, maxlen, signvalue);
<a name="l01063"></a>01063                         --padlen;
<a name="l01064"></a>01064                         signvalue = 0;
<a name="l01065"></a>01065                 }
<a name="l01066"></a>01066                 <span class="keywordflow">while</span> (padlen &gt; 0) {
<a name="l01067"></a>01067                         dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39;0&#39;</span>);
<a name="l01068"></a>01068                         --padlen;
<a name="l01069"></a>01069                 }
<a name="l01070"></a>01070         }
<a name="l01071"></a>01071         <span class="keywordflow">while</span> (padlen &gt; 0) {
<a name="l01072"></a>01072                 dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39; &#39;</span>);
<a name="l01073"></a>01073                 --padlen;
<a name="l01074"></a>01074         }
<a name="l01075"></a>01075         <span class="keywordflow">if</span> (signvalue) 
<a name="l01076"></a>01076                 dopr_outch (buffer, currlen, maxlen, signvalue);
<a name="l01077"></a>01077         
<a name="l01078"></a>01078         <span class="keywordflow">while</span> (iplace &gt; 0) 
<a name="l01079"></a>01079                 dopr_outch (buffer, currlen, maxlen, iconvert[--iplace]);
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="preprocessor">#ifdef DEBUG_SNPRINTF</span>
<a name="l01082"></a>01082 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;fmtfp: fplace=%d zpadlen=%d\n&quot;</span>, fplace, zpadlen);
<a name="l01083"></a>01083 <span class="preprocessor">#endif</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span>
<a name="l01085"></a>01085         <span class="comment">/*</span>
<a name="l01086"></a>01086 <span class="comment">         * Decimal point.  This should probably use locale to find the correct</span>
<a name="l01087"></a>01087 <span class="comment">         * char to print out.</span>
<a name="l01088"></a>01088 <span class="comment">         */</span>
<a name="l01089"></a>01089         <span class="keywordflow">if</span> (max &gt; 0) {
<a name="l01090"></a>01090                 dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39;.&#39;</span>);
<a name="l01091"></a>01091                 
<a name="l01092"></a>01092                 <span class="keywordflow">while</span> (zpadlen &gt; 0) {
<a name="l01093"></a>01093                         dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39;0&#39;</span>);
<a name="l01094"></a>01094                         --zpadlen;
<a name="l01095"></a>01095                 }
<a name="l01096"></a>01096 
<a name="l01097"></a>01097                 <span class="keywordflow">while</span> (fplace &gt; 0) 
<a name="l01098"></a>01098                         dopr_outch (buffer, currlen, maxlen, fconvert[--fplace]);
<a name="l01099"></a>01099         }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101         <span class="keywordflow">while</span> (padlen &lt; 0) {
<a name="l01102"></a>01102                 dopr_outch (buffer, currlen, maxlen, <span class="charliteral">&#39; &#39;</span>);
<a name="l01103"></a>01103                 ++padlen;
<a name="l01104"></a>01104         }
<a name="l01105"></a>01105 }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107 <span class="keyword">static</span> <span class="keywordtype">void</span> dopr_outch(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> *currlen, <span class="keywordtype">size_t</span> maxlen, <span class="keywordtype">char</span> c)
<a name="l01108"></a>01108 {
<a name="l01109"></a>01109         <span class="keywordflow">if</span> (*currlen &lt; maxlen) {
<a name="l01110"></a>01110                 buffer[(*currlen)] = c;
<a name="l01111"></a>01111         }
<a name="l01112"></a>01112         (*currlen)++;
<a name="l01113"></a>01113 }
<a name="l01114"></a>01114 
<a name="l01115"></a>01115 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *new_chunk(<span class="keywordtype">void</span>) {
<a name="l01116"></a>01116         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *new_c = (<span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structpr__chunk.html">pr_chunk</a>));
<a name="l01117"></a>01117 
<a name="l01118"></a>01118         <span class="keywordflow">if</span> ( !new_c ) 
<a name="l01119"></a>01119                 <span class="keywordflow">return</span> NULL;
<a name="l01120"></a>01120 
<a name="l01121"></a>01121         new_c-&gt;<a class="code" href="structpr__chunk.html#a14d35cb1c606307c32d308e844715f1c">type</a> = 0;
<a name="l01122"></a>01122         new_c-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = 0;
<a name="l01123"></a>01123         new_c-&gt;<a class="code" href="structpr__chunk.html#a3de1af9cbc7de88200de395306a7ebb1">min</a> = 0;
<a name="l01124"></a>01124         new_c-&gt;<a class="code" href="structpr__chunk.html#a71ac7f27ef653f1c4546a1132f27aed7">min_star</a> = NULL;
<a name="l01125"></a>01125         new_c-&gt;<a class="code" href="structpr__chunk.html#a090b389c36a9d0ddb83ab9d6b77fb563">max</a> = -1;
<a name="l01126"></a>01126         new_c-&gt;<a class="code" href="structpr__chunk.html#aedfca630ef0a2f6024504d9548e316be">max_star</a> = NULL;
<a name="l01127"></a>01127         new_c-&gt;<a class="code" href="structpr__chunk.html#a4e880a2b6ae0be34013da3466e86ed6d">flags</a> = 0;
<a name="l01128"></a>01128         new_c-&gt;<a class="code" href="structpr__chunk.html#a41bb9e52c8a38c0da806b90df58540ec">cflags</a> = 0;
<a name="l01129"></a>01129         new_c-&gt;<a class="code" href="structpr__chunk.html#a2356e51541dbe18e18c588fb076a95cb">start</a> = 0;
<a name="l01130"></a>01130         new_c-&gt;<a class="code" href="structpr__chunk.html#a201fd59e460bbf3b72d68eb232f6d003">len</a> = 0;
<a name="l01131"></a>01131         new_c-&gt;<a class="code" href="structpr__chunk.html#a82f672fe71f2a311c744f517999772db">value</a> = 0;
<a name="l01132"></a>01132         new_c-&gt;<a class="code" href="structpr__chunk.html#a47d0e31468b165964ed999689840edce">fvalue</a> = 0;
<a name="l01133"></a>01133         new_c-&gt;<a class="code" href="structpr__chunk.html#a4fbd309f1c5ce00ebd9a475ee75585c7">strvalue</a> = NULL;
<a name="l01134"></a>01134         new_c-&gt;<a class="code" href="structpr__chunk.html#af50c837254cf04946e1b617404e78ea3">pnum</a> = NULL;
<a name="l01135"></a>01135         new_c-&gt;<a class="code" href="structpr__chunk.html#a913fae0bb85df118e9b1b738810d8225">next</a> = NULL;
<a name="l01136"></a>01136 
<a name="l01137"></a>01137         <span class="keywordflow">return</span> new_c;
<a name="l01138"></a>01138 }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 <span class="keyword">static</span> <span class="keywordtype">int</span> add_cnk_list_entry(<span class="keyword">struct</span> <a class="code" href="structpr__chunk__x.html">pr_chunk_x</a> **list,
<a name="l01141"></a>01141                                 <span class="keywordtype">int</span> max_num, <span class="keyword">struct</span> <a class="code" href="structpr__chunk.html">pr_chunk</a> *chunk) {
<a name="l01142"></a>01142         <span class="keyword">struct </span><a class="code" href="structpr__chunk__x.html">pr_chunk_x</a> *l;
<a name="l01143"></a>01143         <span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> **c;
<a name="l01144"></a>01144         <span class="keywordtype">int</span> <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l01145"></a>01145         <span class="keywordtype">int</span> cnum;
<a name="l01146"></a>01146         <span class="keywordtype">int</span> i, pos;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148         <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> &gt; max_num) {
<a name="l01149"></a>01149                 max = chunk-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a>;
<a name="l01150"></a>01150         
<a name="l01151"></a>01151                 <span class="keywordflow">if</span> (*list == NULL) {
<a name="l01152"></a>01152                         l = (<span class="keyword">struct </span><a class="code" href="structpr__chunk__x.html">pr_chunk_x</a> *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structpr__chunk__x.html">pr_chunk_x</a>) * <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>);
<a name="l01153"></a>01153                         pos = 0;
<a name="l01154"></a>01154                 } <span class="keywordflow">else</span> {
<a name="l01155"></a>01155                         l = (<span class="keyword">struct </span><a class="code" href="structpr__chunk__x.html">pr_chunk_x</a> *)realloc(*list, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structpr__chunk__x.html">pr_chunk_x</a>) * <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>);
<a name="l01156"></a>01156                         pos = max_num;
<a name="l01157"></a>01157                 }
<a name="l01158"></a>01158                 <span class="keywordflow">if</span> (l == NULL) {
<a name="l01159"></a>01159                         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>; i++) {
<a name="l01160"></a>01160                                 <span class="keywordflow">if</span> ((*list)[i].chunks) free((*list)[i].chunks);
<a name="l01161"></a>01161                         }
<a name="l01162"></a>01162                         <span class="keywordflow">return</span> 0;
<a name="l01163"></a>01163                 }
<a name="l01164"></a>01164                 <span class="keywordflow">for</span> (i = pos; i &lt; <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>; i++) {
<a name="l01165"></a>01165                         l[i].<a class="code" href="structpr__chunk__x.html#a1ba7fce2f61b04d801d902c4160ea7f4">chunks</a> = NULL;
<a name="l01166"></a>01166                         l[i].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a> = 0;
<a name="l01167"></a>01167                 }
<a name="l01168"></a>01168         } <span class="keywordflow">else</span> {
<a name="l01169"></a>01169                 l = *list;
<a name="l01170"></a>01170                 max = max_num;
<a name="l01171"></a>01171         }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173         i = chunk-&gt;<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> - 1;
<a name="l01174"></a>01174         cnum = l[i].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a> + 1;
<a name="l01175"></a>01175         <span class="keywordflow">if</span> (l[i].chunks == NULL) {
<a name="l01176"></a>01176                 c = (<span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> **)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structpr__chunk.html">pr_chunk</a> *) * cnum); 
<a name="l01177"></a>01177         } <span class="keywordflow">else</span> {
<a name="l01178"></a>01178                 c = (<span class="keyword">struct </span><a class="code" href="structpr__chunk.html">pr_chunk</a> **)realloc(l[i].chunks, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structpr__chunk.html">pr_chunk</a> *) * cnum);
<a name="l01179"></a>01179         }
<a name="l01180"></a>01180         <span class="keywordflow">if</span> (c == NULL) {
<a name="l01181"></a>01181                 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>; i++) {
<a name="l01182"></a>01182                         <span class="keywordflow">if</span> (l[i].chunks) free(l[i].chunks);
<a name="l01183"></a>01183                 }
<a name="l01184"></a>01184                 <span class="keywordflow">return</span> 0;
<a name="l01185"></a>01185         }
<a name="l01186"></a>01186         c[l[i].<a class="code" href="structpr__chunk__x.html#a632d18b9fcc3352a4d09e705482255bd">num</a>] = chunk;
<a name="l01187"></a>01187         l[i].chunks = c;
<a name="l01188"></a>01188         l[i].<a class="code" href="structpr__chunk.html#af7fc02765e5aff08b8e7910db7e6b2d2">num</a> = cnum;
<a name="l01189"></a>01189 
<a name="l01190"></a>01190         *list = l;
<a name="l01191"></a>01191         <span class="keywordflow">return</span> <a class="code" href="avail_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l01192"></a>01192 }
<a name="l01193"></a>01193 
<a name="l01194"></a><a class="code" href="snprintf_8c.html#a225bc0afa8e6f123e7a06b28338d6993">01194</a>  <span class="keywordtype">int</span> <a class="code" href="snprintf_8c.html#a225bc0afa8e6f123e7a06b28338d6993">smb_vsnprintf</a> (<span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> count, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, va_list args)
<a name="l01195"></a>01195 {
<a name="l01196"></a>01196         <span class="keywordflow">return</span> dopr(str, count, fmt, args);
<a name="l01197"></a>01197 }
<a name="l01198"></a><a class="code" href="snprintf_8c.html#a00ba2ca988495904efc418acbf0627d7">01198</a> <span class="preprocessor">#define vsnprintf smb_vsnprintf</span>
<a name="l01199"></a>01199 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01200"></a>01200 <span class="preprocessor"></span>
<a name="l01201"></a>01201 <span class="comment">/* yes this really must be a ||. Don&#39;t muck with this (tridge)</span>
<a name="l01202"></a>01202 <span class="comment"> *</span>
<a name="l01203"></a>01203 <span class="comment"> * The logic for these two is that we need our own definition if the</span>
<a name="l01204"></a>01204 <span class="comment"> * OS *either* has no definition of *sprintf, or if it does have one</span>
<a name="l01205"></a>01205 <span class="comment"> * that doesn&#39;t work properly according to the autoconf test.</span>
<a name="l01206"></a>01206 <span class="comment"> */</span>
<a name="l01207"></a>01207 <span class="preprocessor">#if !defined(HAVE_SNPRINTF) || !defined(HAVE_C99_VSNPRINTF)</span>
<a name="l01208"></a><a class="code" href="snprintf_8c.html#aab5577e19ab00c9a537af35c321d1ba8">01208</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="snprintf_8c.html#aab5577e19ab00c9a537af35c321d1ba8">smb_snprintf</a>(<span class="keywordtype">char</span> *str,<span class="keywordtype">size_t</span> count,<span class="keyword">const</span> <span class="keywordtype">char</span> *fmt,...)
<a name="l01209"></a>01209 {
<a name="l01210"></a>01210         <span class="keywordtype">size_t</span> ret;
<a name="l01211"></a>01211         va_list ap;
<a name="l01212"></a>01212     
<a name="l01213"></a>01213         va_start(ap, fmt);
<a name="l01214"></a>01214         ret = <a class="code" href="snprintf_8c.html#a00ba2ca988495904efc418acbf0627d7">vsnprintf</a>(str, count, fmt, ap);
<a name="l01215"></a>01215         va_end(ap);
<a name="l01216"></a>01216         <span class="keywordflow">return</span> ret;
<a name="l01217"></a>01217 }
<a name="l01218"></a><a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">01218</a> <span class="preprocessor">#define snprintf smb_snprintf</span>
<a name="l01219"></a>01219 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01220"></a>01220 <span class="preprocessor"></span>
<a name="l01221"></a>01221 <span class="preprocessor">#endif </span>
<a name="l01222"></a>01222 <span class="preprocessor"></span>
<a name="l01223"></a>01223 <span class="preprocessor">#ifndef HAVE_VASPRINTF</span>
<a name="l01224"></a><a class="code" href="snprintf_8c.html#a4e85b35525311e653744c2bfd3e9971e">01224</a> <span class="preprocessor"></span> <span class="keywordtype">int</span> <a class="code" href="snprintf_8c.html#a4e85b35525311e653744c2bfd3e9971e">vasprintf</a>(<span class="keywordtype">char</span> **ptr, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, va_list ap)
<a name="l01225"></a>01225 {
<a name="l01226"></a>01226         <span class="keywordtype">int</span> ret;
<a name="l01227"></a>01227         va_list ap2;
<a name="l01228"></a>01228 
<a name="l01229"></a>01229         <a class="code" href="snprintf_8c.html#ad56bddf802506a91f745d7db8854f1a1">VA_COPY</a>(ap2, ap);
<a name="l01230"></a>01230         
<a name="l01231"></a>01231         ret = <a class="code" href="snprintf_8c.html#a00ba2ca988495904efc418acbf0627d7">vsnprintf</a>(NULL, 0, format, ap2);
<a name="l01232"></a>01232         <span class="keywordflow">if</span> (ret &lt;= 0) <span class="keywordflow">return</span> ret;
<a name="l01233"></a>01233 
<a name="l01234"></a>01234         (*ptr) = (<span class="keywordtype">char</span> *)malloc(ret+1);
<a name="l01235"></a>01235         <span class="keywordflow">if</span> (!*ptr) <span class="keywordflow">return</span> -1;
<a name="l01236"></a>01236 
<a name="l01237"></a>01237         <a class="code" href="snprintf_8c.html#ad56bddf802506a91f745d7db8854f1a1">VA_COPY</a>(ap2, ap);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239         ret = <a class="code" href="snprintf_8c.html#a00ba2ca988495904efc418acbf0627d7">vsnprintf</a>(*ptr, ret+1, format, ap2);
<a name="l01240"></a>01240 
<a name="l01241"></a>01241         <span class="keywordflow">return</span> ret;
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 <span class="preprocessor">#endif</span>
<a name="l01244"></a>01244 <span class="preprocessor"></span>
<a name="l01245"></a>01245 
<a name="l01246"></a>01246 <span class="preprocessor">#ifndef HAVE_ASPRINTF</span>
<a name="l01247"></a><a class="code" href="snprintf_8c.html#a28a648dd20504ebc0c03623a28d82c93">01247</a> <span class="preprocessor"></span> <span class="keywordtype">int</span> <a class="code" href="snprintf_8c.html#a28a648dd20504ebc0c03623a28d82c93">asprintf</a>(<span class="keywordtype">char</span> **ptr, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
<a name="l01248"></a>01248 {
<a name="l01249"></a>01249         va_list ap;
<a name="l01250"></a>01250         <span class="keywordtype">int</span> ret;
<a name="l01251"></a>01251         
<a name="l01252"></a>01252         *ptr = NULL;
<a name="l01253"></a>01253         va_start(ap, format);
<a name="l01254"></a>01254         ret = <a class="code" href="snprintf_8c.html#a4e85b35525311e653744c2bfd3e9971e">vasprintf</a>(ptr, format, ap);
<a name="l01255"></a>01255         va_end(ap);
<a name="l01256"></a>01256 
<a name="l01257"></a>01257         <span class="keywordflow">return</span> ret;
<a name="l01258"></a>01258 }
<a name="l01259"></a>01259 <span class="preprocessor">#endif</span>
<a name="l01260"></a>01260 <span class="preprocessor"></span>
<a name="l01261"></a>01261 <span class="preprocessor">#ifdef TEST_SNPRINTF</span>
<a name="l01262"></a>01262 <span class="preprocessor"></span>
<a name="l01263"></a>01263  <span class="keywordtype">int</span> sprintf(<span class="keywordtype">char</span> *str,<span class="keyword">const</span> <span class="keywordtype">char</span> *fmt,...);
<a name="l01264"></a>01264 
<a name="l01265"></a>01265  <span class="keywordtype">int</span> <a class="code" href="icinga_8c.html#a7b26396c9888d66d997b0007e8ff1e60">main</a> (<span class="keywordtype">void</span>)
<a name="l01266"></a>01266 {
<a name="l01267"></a>01267         <span class="keywordtype">char</span> buf1[1024];
<a name="l01268"></a>01268         <span class="keywordtype">char</span> buf2[1024];
<a name="l01269"></a>01269         <span class="keywordtype">char</span> *buf3;
<a name="l01270"></a>01270         <span class="keywordtype">char</span> *fp_fmt[] = {
<a name="l01271"></a>01271                 <span class="stringliteral">&quot;%1.1f&quot;</span>,
<a name="l01272"></a>01272                 <span class="stringliteral">&quot;%-1.5f&quot;</span>,
<a name="l01273"></a>01273                 <span class="stringliteral">&quot;%1.5f&quot;</span>,
<a name="l01274"></a>01274                 <span class="stringliteral">&quot;%123.9f&quot;</span>,
<a name="l01275"></a>01275                 <span class="stringliteral">&quot;%10.5f&quot;</span>,
<a name="l01276"></a>01276                 <span class="stringliteral">&quot;% 10.5f&quot;</span>,
<a name="l01277"></a>01277                 <span class="stringliteral">&quot;%+22.9f&quot;</span>,
<a name="l01278"></a>01278                 <span class="stringliteral">&quot;%+4.9f&quot;</span>,
<a name="l01279"></a>01279                 <span class="stringliteral">&quot;%01.3f&quot;</span>,
<a name="l01280"></a>01280                 <span class="stringliteral">&quot;%4f&quot;</span>,
<a name="l01281"></a>01281                 <span class="stringliteral">&quot;%3.1f&quot;</span>,
<a name="l01282"></a>01282                 <span class="stringliteral">&quot;%3.2f&quot;</span>,
<a name="l01283"></a>01283                 <span class="stringliteral">&quot;%.0f&quot;</span>,
<a name="l01284"></a>01284                 <span class="stringliteral">&quot;%f&quot;</span>,
<a name="l01285"></a>01285                 <span class="stringliteral">&quot;%-8.8f&quot;</span>,
<a name="l01286"></a>01286                 <span class="stringliteral">&quot;%-9.9f&quot;</span>,
<a name="l01287"></a>01287                 NULL
<a name="l01288"></a>01288         };
<a name="l01289"></a>01289         <span class="keywordtype">double</span> fp_nums[] = { 6442452944.1234, -1.5, 134.21, 91340.2, 341.1234, 203.9, 0.96, 0.996, 
<a name="l01290"></a>01290                              0.9996, 1.996, 4.136, 5.030201, 0.00205,
<a name="l01291"></a>01291                              <span class="comment">/* END LIST */</span> 0};
<a name="l01292"></a>01292         <span class="keywordtype">char</span> *int_fmt[] = {
<a name="l01293"></a>01293                 <span class="stringliteral">&quot;%-1.5d&quot;</span>,
<a name="l01294"></a>01294                 <span class="stringliteral">&quot;%1.5d&quot;</span>,
<a name="l01295"></a>01295                 <span class="stringliteral">&quot;%123.9d&quot;</span>,
<a name="l01296"></a>01296                 <span class="stringliteral">&quot;%5.5d&quot;</span>,
<a name="l01297"></a>01297                 <span class="stringliteral">&quot;%10.5d&quot;</span>,
<a name="l01298"></a>01298                 <span class="stringliteral">&quot;% 10.5d&quot;</span>,
<a name="l01299"></a>01299                 <span class="stringliteral">&quot;%+22.33d&quot;</span>,
<a name="l01300"></a>01300                 <span class="stringliteral">&quot;%01.3d&quot;</span>,
<a name="l01301"></a>01301                 <span class="stringliteral">&quot;%4d&quot;</span>,
<a name="l01302"></a>01302                 <span class="stringliteral">&quot;%d&quot;</span>,
<a name="l01303"></a>01303                 NULL
<a name="l01304"></a>01304         };
<a name="l01305"></a>01305         <span class="keywordtype">long</span> int_nums[] = { -1, 134, 91340, 341, 0203, 0, 1234567890};
<a name="l01306"></a>01306         <span class="keywordtype">char</span> *str_fmt[] = {
<a name="l01307"></a>01307                 <span class="stringliteral">&quot;%10.5s&quot;</span>,
<a name="l01308"></a>01308                 <span class="stringliteral">&quot;%-10.5s&quot;</span>,
<a name="l01309"></a>01309                 <span class="stringliteral">&quot;%5.10s&quot;</span>,
<a name="l01310"></a>01310                 <span class="stringliteral">&quot;%-5.10s&quot;</span>,
<a name="l01311"></a>01311                 <span class="stringliteral">&quot;%10.1s&quot;</span>,
<a name="l01312"></a>01312                 <span class="stringliteral">&quot;%0.10s&quot;</span>,
<a name="l01313"></a>01313                 <span class="stringliteral">&quot;%10.0s&quot;</span>,
<a name="l01314"></a>01314                 <span class="stringliteral">&quot;%1.10s&quot;</span>,
<a name="l01315"></a>01315                 <span class="stringliteral">&quot;%s&quot;</span>,
<a name="l01316"></a>01316                 <span class="stringliteral">&quot;%.1s&quot;</span>,
<a name="l01317"></a>01317                 <span class="stringliteral">&quot;%.10s&quot;</span>,
<a name="l01318"></a>01318                 <span class="stringliteral">&quot;%10s&quot;</span>,
<a name="l01319"></a>01319                 NULL
<a name="l01320"></a>01320         };
<a name="l01321"></a>01321         <span class="keywordtype">char</span> *str_vals[] = {<span class="stringliteral">&quot;hello&quot;</span>, <span class="stringliteral">&quot;a&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;a longer string&quot;</span>, NULL};
<a name="l01322"></a>01322         <span class="keywordtype">int</span> x, y;
<a name="l01323"></a>01323         <span class="keywordtype">int</span> fail = 0;
<a name="l01324"></a>01324         <span class="keywordtype">int</span> num = 0;
<a name="l01325"></a>01325         <span class="keywordtype">int</span> l1, l2;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327         printf (<span class="stringliteral">&quot;Testing snprintf format codes against system sprintf...\n&quot;</span>);
<a name="l01328"></a>01328 
<a name="l01329"></a>01329         <span class="keywordflow">for</span> (x = 0; fp_fmt[x] ; x++) {
<a name="l01330"></a>01330                 <span class="keywordflow">for</span> (y = 0; fp_nums[y] != 0 ; y++) {
<a name="l01331"></a>01331                         buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01332"></a>01332                         l1 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(NULL, 0, fp_fmt[x], fp_nums[y]);
<a name="l01333"></a>01333                         l2 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), fp_fmt[x], fp_nums[y]);
<a name="l01334"></a>01334                         sprintf (buf2, fp_fmt[x], fp_nums[y]);
<a name="l01335"></a>01335                         buf1[1023] = buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01336"></a>01336                         <span class="keywordflow">if</span> (strcmp (buf1, buf2) || (l1 != l2)) {
<a name="l01337"></a>01337                                 printf(<span class="stringliteral">&quot;snprintf doesn&#39;t match Format: %s\n\tsnprintf(%d) = [%s]\n\t sprintf(%d) = [%s]\n&quot;</span>, 
<a name="l01338"></a>01338                                        fp_fmt[x], l1, buf1, l2, buf2);
<a name="l01339"></a>01339                                 fail++;
<a name="l01340"></a>01340                         }
<a name="l01341"></a>01341                         num++;
<a name="l01342"></a>01342                 }
<a name="l01343"></a>01343         }
<a name="l01344"></a>01344 
<a name="l01345"></a>01345         <span class="keywordflow">for</span> (x = 0; int_fmt[x] ; x++) {
<a name="l01346"></a>01346                 <span class="keywordflow">for</span> (y = 0; int_nums[y] != 0 ; y++) {
<a name="l01347"></a>01347                         buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01348"></a>01348                         l1 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(NULL, 0, int_fmt[x], int_nums[y]);
<a name="l01349"></a>01349                         l2 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), int_fmt[x], int_nums[y]);
<a name="l01350"></a>01350                         sprintf (buf2, int_fmt[x], int_nums[y]);
<a name="l01351"></a>01351                         buf1[1023] = buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01352"></a>01352                         <span class="keywordflow">if</span> (strcmp (buf1, buf2) || (l1 != l2)) {
<a name="l01353"></a>01353                                 printf(<span class="stringliteral">&quot;snprintf doesn&#39;t match Format: %s\n\tsnprintf(%d) = [%s]\n\t sprintf(%d) = [%s]\n&quot;</span>, 
<a name="l01354"></a>01354                                        int_fmt[x], l1, buf1, l2, buf2);
<a name="l01355"></a>01355                                 fail++;
<a name="l01356"></a>01356                         }
<a name="l01357"></a>01357                         num++;
<a name="l01358"></a>01358                 }
<a name="l01359"></a>01359         }
<a name="l01360"></a>01360 
<a name="l01361"></a>01361         <span class="keywordflow">for</span> (x = 0; str_fmt[x] ; x++) {
<a name="l01362"></a>01362                 <span class="keywordflow">for</span> (y = 0; str_vals[y] != 0 ; y++) {
<a name="l01363"></a>01363                         buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01364"></a>01364                         l1 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(NULL, 0, str_fmt[x], str_vals[y]);
<a name="l01365"></a>01365                         l2 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), str_fmt[x], str_vals[y]);
<a name="l01366"></a>01366                         sprintf (buf2, str_fmt[x], str_vals[y]);
<a name="l01367"></a>01367                         buf1[1023] = buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01368"></a>01368                         <span class="keywordflow">if</span> (strcmp (buf1, buf2) || (l1 != l2)) {
<a name="l01369"></a>01369                                 printf(<span class="stringliteral">&quot;snprintf doesn&#39;t match Format: %s\n\tsnprintf(%d) = [%s]\n\t sprintf(%d) = [%s]\n&quot;</span>, 
<a name="l01370"></a>01370                                        str_fmt[x], l1, buf1, l2, buf2);
<a name="l01371"></a>01371                                 fail++;
<a name="l01372"></a>01372                         }
<a name="l01373"></a>01373                         num++;
<a name="l01374"></a>01374                 }
<a name="l01375"></a>01375         }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377 <span class="preprocessor">#define BUFSZ 2048</span>
<a name="l01378"></a>01378 <span class="preprocessor"></span>
<a name="l01379"></a>01379         buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01380"></a>01380         <span class="keywordflow">if</span> ((buf3 = malloc(BUFSZ)) == NULL) {
<a name="l01381"></a>01381                 fail++;
<a name="l01382"></a>01382         } <span class="keywordflow">else</span> {
<a name="l01383"></a>01383                 num++;
<a name="l01384"></a>01384                 memset(buf3, <span class="charliteral">&#39;a&#39;</span>, BUFSZ);
<a name="l01385"></a>01385                 <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), <span class="stringliteral">&quot;%.*s&quot;</span>, 1, buf3);
<a name="l01386"></a>01386                 buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01387"></a>01387                 <span class="keywordflow">if</span> (strcmp(buf1, <span class="stringliteral">&quot;a&quot;</span>) != 0) {
<a name="l01388"></a>01388                         printf(<span class="stringliteral">&quot;length limit buf1 &#39;%s&#39; expected &#39;a&#39;\n&quot;</span>, buf1);
<a name="l01389"></a>01389                         fail++;
<a name="l01390"></a>01390                 }
<a name="l01391"></a>01391         }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393         buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01394"></a>01394         l1 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), <span class="stringliteral">&quot;%4$*1$d %2$s %3$*1$.*1$f&quot;</span>, 3, <span class="stringliteral">&quot;pos test&quot;</span>, 12.3456, 9);
<a name="l01395"></a>01395         l2 = sprintf(buf2, <span class="stringliteral">&quot;%4$*1$d %2$s %3$*1$.*1$f&quot;</span>, 3, <span class="stringliteral">&quot;pos test&quot;</span>, 12.3456, 9);
<a name="l01396"></a>01396         buf1[1023] = buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01397"></a>01397         <span class="keywordflow">if</span> (strcmp(buf1, buf2) || (l1 != l2)) {
<a name="l01398"></a>01398                 printf(<span class="stringliteral">&quot;snprintf doesn&#39;t match Format: %s\n\tsnprintf(%d) = [%s]\n\t sprintf(%d) = [%s]\n&quot;</span>,
<a name="l01399"></a>01399                                 <span class="stringliteral">&quot;%4$*1$d %2$s %3$*1$.*1$f&quot;</span>, l1, buf1, l2, buf2);
<a name="l01400"></a>01400                 fail++;
<a name="l01401"></a>01401         }
<a name="l01402"></a>01402 
<a name="l01403"></a>01403         buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01404"></a>01404         l1 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), <span class="stringliteral">&quot;%4$*4$d %2$s %3$*4$.*4$f&quot;</span>, 3, <span class="stringliteral">&quot;pos test&quot;</span>, 12.3456, 9);
<a name="l01405"></a>01405         l2 = sprintf(buf2, <span class="stringliteral">&quot;%4$*4$d %2$s %3$*4$.*4$f&quot;</span>, 3, <span class="stringliteral">&quot;pos test&quot;</span>, 12.3456, 9);
<a name="l01406"></a>01406         buf1[1023] = buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01407"></a>01407         <span class="keywordflow">if</span> (strcmp(buf1, buf2)) {
<a name="l01408"></a>01408                 printf(<span class="stringliteral">&quot;snprintf doesn&#39;t match Format: %s\n\tsnprintf(%d) = [%s]\n\t sprintf(%d) = [%s]\n&quot;</span>,
<a name="l01409"></a>01409                                 <span class="stringliteral">&quot;%4$*1$d %2$s %3$*1$.*1$f&quot;</span>, l1, buf1, l2, buf2);
<a name="l01410"></a>01410                 fail++;
<a name="l01411"></a>01411         }
<a name="l01412"></a>01412 <span class="preprocessor">#if 0</span>
<a name="l01413"></a>01413 <span class="preprocessor"></span>        buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01414"></a>01414         l1 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), <span class="stringliteral">&quot;%lld&quot;</span>, (LLONG)1234567890);
<a name="l01415"></a>01415         l2 = sprintf(buf2, <span class="stringliteral">&quot;%lld&quot;</span>, (LLONG)1234567890);
<a name="l01416"></a>01416         buf1[1023] = buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01417"></a>01417         <span class="keywordflow">if</span> (strcmp(buf1, buf2)) {
<a name="l01418"></a>01418                 printf(<span class="stringliteral">&quot;snprintf doesn&#39;t match Format: %s\n\tsnprintf(%d) = [%s]\n\t sprintf(%d) = [%s]\n&quot;</span>,
<a name="l01419"></a>01419                                 <span class="stringliteral">&quot;%lld&quot;</span>, l1, buf1, l2, buf2);
<a name="l01420"></a>01420                 fail++;
<a name="l01421"></a>01421         }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423         buf1[0] = buf2[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01424"></a>01424         l1 = <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), <span class="stringliteral">&quot;%Lf&quot;</span>, (<a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a>)890.1234567890123);
<a name="l01425"></a>01425         l2 = sprintf(buf2, <span class="stringliteral">&quot;%Lf&quot;</span>, (<a class="code" href="snprintf_8c.html#a767cc3a7d365685dc2cdd94a79df99a4">LDOUBLE</a>)890.1234567890123);
<a name="l01426"></a>01426         buf1[1023] = buf1[1023] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01427"></a>01427         <span class="keywordflow">if</span> (strcmp(buf1, buf2)) {
<a name="l01428"></a>01428                 printf(<span class="stringliteral">&quot;snprintf doesn&#39;t match Format: %s\n\tsnprintf(%d) = [%s]\n\t sprintf(%d) = [%s]\n&quot;</span>,
<a name="l01429"></a>01429                                 <span class="stringliteral">&quot;%Lf&quot;</span>, l1, buf1, l2, buf2);
<a name="l01430"></a>01430                 fail++;
<a name="l01431"></a>01431         }
<a name="l01432"></a>01432 <span class="preprocessor">#endif</span>
<a name="l01433"></a>01433 <span class="preprocessor"></span>        printf (<span class="stringliteral">&quot;%d tests failed out of %d.\n&quot;</span>, fail, num);
<a name="l01434"></a>01434 
<a name="l01435"></a>01435         printf(<span class="stringliteral">&quot;seeing how many digits we support\n&quot;</span>);
<a name="l01436"></a>01436         {
<a name="l01437"></a>01437                 <span class="keywordtype">double</span> v0 = 0.12345678901234567890123456789012345678901;
<a name="l01438"></a>01438                 <span class="keywordflow">for</span> (x=0; x&lt;100; x++) {
<a name="l01439"></a>01439                         <span class="keywordtype">double</span> p = pow(10, x); 
<a name="l01440"></a>01440                         <span class="keywordtype">double</span> r = v0*p;
<a name="l01441"></a>01441                         <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf1, <span class="keyword">sizeof</span>(buf1), <span class="stringliteral">&quot;%1.1f&quot;</span>, r);
<a name="l01442"></a>01442                         sprintf(buf2,                <span class="stringliteral">&quot;%1.1f&quot;</span>, r);
<a name="l01443"></a>01443                         <span class="keywordflow">if</span> (strcmp(buf1, buf2)) {
<a name="l01444"></a>01444                                 printf(<span class="stringliteral">&quot;we seem to support %d digits\n&quot;</span>, x-1);
<a name="l01445"></a>01445                                 <span class="keywordflow">break</span>;
<a name="l01446"></a>01446                         }
<a name="l01447"></a>01447                 }
<a name="l01448"></a>01448         }
<a name="l01449"></a>01449 
<a name="l01450"></a>01450         <span class="keywordflow">return</span> 0;
<a name="l01451"></a>01451 }
<a name="l01452"></a>01452 <span class="preprocessor">#endif </span><span class="comment">/* TEST_SNPRINTF */</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="snprintf_8c.html">snprintf.c</a>      </li>
      <li class="footer">Generated on Tue May 3 2011 22:33:40 for Icinga-core by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
